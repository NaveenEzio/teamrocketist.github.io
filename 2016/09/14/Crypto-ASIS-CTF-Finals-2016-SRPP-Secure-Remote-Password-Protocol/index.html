<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  <title>[Crypto] ASIS CTF Finals 2016 - SRPP [Secure Remote Password Protocol] | TeamRocketIST - Portuguese CTF Team</title>
  <meta name="description" content="Average: 2.83Rating Count: 12You Rated: Not ratedPoints231Solves35CategoryCryptoDescription    Try to crack our super safe cryptography system and find the flag.    nc srpp.asis-ctf.ir 22778http://asi">
<meta name="keywords" content="crypto,login">
<meta property="og:type" content="article">
<meta property="og:title" content="[Crypto] ASIS CTF Finals 2016 - SRPP [Secure Remote Password Protocol]">
<meta property="og:url" content="https://teamrocketist.github.io/2016/09/14/Crypto-ASIS-CTF-Finals-2016-SRPP-Secure-Remote-Password-Protocol/index.html">
<meta property="og:site_name" content="TEAMROCKETIST">
<meta property="og:description" content="Average: 2.83Rating Count: 12You Rated: Not ratedPoints231Solves35CategoryCryptoDescription    Try to crack our super safe cryptography system and find the flag.    nc srpp.asis-ctf.ir 22778http://asi">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-08-10T02:59:35.385Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Crypto] ASIS CTF Finals 2016 - SRPP [Secure Remote Password Protocol]">
<meta name="twitter:description" content="Average: 2.83Rating Count: 12You Rated: Not ratedPoints231Solves35CategoryCryptoDescription    Try to crack our super safe cryptography system and find the flag.    nc srpp.asis-ctf.ir 22778http://asi">
  
    <link rel="alternate" href="/atom.xml" title="TEAMROCKETIST" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/avatar.png" type="image/x-icon">
  
  <!-- font-awesome CSS -->
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
</head>


<body class="main-center">
  <section class="mainside">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/teamrocketist" target="_blank">
          <img class="thumb-xl img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">TeamRocketIST</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">CTF Team</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="fa fa-map-marker"></i> Lisbon, Portugal</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat"><i class="fa fa-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
            <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            <!-- <span class="ins-close ins-selectable"><i class="fa fa-times"></i></span> -->
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>

</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav main-nav">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="fa fa-fw fa-home"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="fa fa-fw fa-archive"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="fa fa-fw fa-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="fa fa-fw fa-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="fa fa-fw fa-code"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="fa fa-fw fa-gg"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="fa fa-fw fa-coffee"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      <div class="footer">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/teamrocketist" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="fa fa-github"></i></a></li>
        
        <li><a href="https://twitter.com/teamrocketist" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="fa fa-twitter"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="fa fa-rss"></i></a></li>
        
    </ul>
    
    <div class="copyright">
        &copy; 2017 TEAMROCKETIST
        <div class="publishby">
        	<!-- Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. -->
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</div>
    </nav>
  </div>
</section>

  
    <section class="sidebar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            
            <div class="content">
                <p>PC MASTER RACE!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Crypto/">Crypto</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Forensics/">Forensics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reverse/">Reverse</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">7</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LTE/">LTE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Misc/">Misc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/">RSA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/X-Forwarded-For/">X-Forwarded-For</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/base64/">base64</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bruteforce/">bruteforce</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crypto/">crypto</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filterbypass/">filterbypass</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/forensics/">forensics</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdb/">gdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hash/">hash</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/login/">login</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/md5/">md5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/noSql/">noSql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pcap/">pcap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perl/">perl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/png/">png</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/regex/">regex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/">reverse</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shellshock/">shellshock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqli/">sqli</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/usb/">usb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wireshark/">wireshark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xor/">xor</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/LTE/" style="font-size: 13px;">LTE</a> <a href="/tags/Misc/" style="font-size: 13px;">Misc</a> <a href="/tags/RSA/" style="font-size: 13px;">RSA</a> <a href="/tags/X-Forwarded-For/" style="font-size: 13px;">X-Forwarded-For</a> <a href="/tags/base64/" style="font-size: 13px;">base64</a> <a href="/tags/bruteforce/" style="font-size: 13.33px;">bruteforce</a> <a href="/tags/crypto/" style="font-size: 13.67px;">crypto</a> <a href="/tags/filterbypass/" style="font-size: 13px;">filterbypass</a> <a href="/tags/forensics/" style="font-size: 13px;">forensics</a> <a href="/tags/gdb/" style="font-size: 13px;">gdb</a> <a href="/tags/hash/" style="font-size: 13px;">hash</a> <a href="/tags/java/" style="font-size: 13px;">java</a> <a href="/tags/login/" style="font-size: 13px;">login</a> <a href="/tags/md5/" style="font-size: 13.33px;">md5</a> <a href="/tags/mongodb/" style="font-size: 13px;">mongodb</a> <a href="/tags/network/" style="font-size: 13px;">network</a> <a href="/tags/noSql/" style="font-size: 13px;">noSql</a> <a href="/tags/pcap/" style="font-size: 13px;">pcap</a> <a href="/tags/perl/" style="font-size: 13px;">perl</a> <a href="/tags/png/" style="font-size: 13px;">png</a> <a href="/tags/python/" style="font-size: 13px;">python</a> <a href="/tags/regex/" style="font-size: 13px;">regex</a> <a href="/tags/reverse/" style="font-size: 13.67px;">reverse</a> <a href="/tags/shellshock/" style="font-size: 13px;">shellshock</a> <a href="/tags/sql/" style="font-size: 13px;">sql</a> <a href="/tags/sqli/" style="font-size: 13px;">sqli</a> <a href="/tags/usb/" style="font-size: 13px;">usb</a> <a href="/tags/web/" style="font-size: 14px;">web</a> <a href="/tags/wireshark/" style="font-size: 13px;">wireshark</a> <a href="/tags/xor/" style="font-size: 13px;">xor</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Network/">Network</a>
              </p>
              <p class="item-title">
                <a href="/2017/08/07/Network-Sha2017-Abuse-Mail-300/" class="title">[Network] Sha2017 - Abuse Mail [300]</a>
              </p>
              <p class="item-date">
                <time datetime="2017-08-07T12:52:21.000Z" itemprop="datePublished">2017-08-07</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Web/">Web</a>
              </p>
              <p class="item-title">
                <a href="/2017/08/02/Web-Bugs-Bunny-CTF-LQI-X-140/" class="title">[Web] Bugs Bunny CTF - LQI_X 140</a>
              </p>
              <p class="item-date">
                <time datetime="2017-08-02T10:29:58.000Z" itemprop="datePublished">2017-08-02</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Reverse/">Reverse</a>
              </p>
              <p class="item-title">
                <a href="/2017/08/01/Reverse-BugsBunny-CTF-Rev75/" class="title">[Reverse] BugsBunny CTF - Rev75</a>
              </p>
              <p class="item-date">
                <time datetime="2017-08-01T08:03:50.000Z" itemprop="datePublished">2017-08-01</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Reverse/">Reverse</a>
              </p>
              <p class="item-title">
                <a href="/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev100/" class="title">[Reverse] Bugs Bunny CTF - Rev100</a>
              </p>
              <p class="item-date">
                <time datetime="2017-07-31T15:14:17.000Z" itemprop="datePublished">2017-07-31</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Reverse/">Reverse</a>
              </p>
              <p class="item-title">
                <a href="/2017/07/31/Reverse-Bugs-Bunny-CTF-Rev-50/" class="title">[Reverse] - Bugs Bunny CTF - Rev 50</a>
              </p>
              <p class="item-date">
                <time datetime="2017-07-31T14:16:03.000Z" itemprop="datePublished">2017-07-31</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</section>

  
  <section class="main">
  <div class="content">
  <article id="post-Crypto-ASIS-CTF-Finals-2016-SRPP-Secure-Remote-Password-Protocol" class="article article-type-post" itemscope itemprop="blogPost">
    
    <header class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      [Crypto] ASIS CTF Finals 2016 - SRPP [Secure Remote Password Protocol]
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="fa fa-calendar-check-o"></i>
	<a href="/2016/09/14/Crypto-ASIS-CTF-Finals-2016-SRPP-Secure-Remote-Password-Protocol/" class="article-date">
	  <time datetime="2016-09-14T03:12:59.000Z" itemprop="datePublished">2016-09-14</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Crypto/">Crypto</a>
  </span>

        
  <span class="article-tag">
    <i class="fa fa-tag"></i>
	<a class="article-tag-link" href="/tags/crypto/">crypto</a>, <a class="article-tag-link" href="/tags/login/">login</a>
  </span>


        

		
		
	
		<span class="post-wordcount hidden-xs">Word Count: 1,173 (words)</span>
	
	
		<span class="post-readcount hidden-xs">Read Time: 7 (min)</span>
	

      </div>
    </header>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote><br>Average: 2.83<br>Rating Count: 12<br>You Rated: Not rated<br>Points<br>231<br>Solves<br>35<br>Category<br>Crypto<br><br>Description<br><br>    Try to crack our super safe cryptography system and find the flag.<br><br>    nc srpp.asis-ctf.ir 22778<br><br><a href="http://asis-ctf.ir/tasks/srpp.txz_baa9ec300fd3488a8417fc849a07c2aaf5a26224" target="_blank" rel="external">http://asis-ctf.ir/tasks/srpp.txz_baa9ec300fd3488a8417fc849a07c2aaf5a26224</a><br></blockquote>

<p>Server.py (given by the challenge)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> socket</div><div class="line"><span class="keyword">import</span> time </div><div class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> thread <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> password, flag</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">_port = int(sys.argv[<span class="number">1</span>])</div><div class="line">_timeout = <span class="number">3</span> </div><div class="line">_host = <span class="string">''</span></div><div class="line">_bufsize = <span class="number">4096</span></div><div class="line"></div><div class="line">_logfile = open(str(sys.argv[<span class="number">0</span>]) + <span class="string">'.log'</span>, <span class="string">'a'</span>)</div><div class="line"></div><div class="line">_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</div><div class="line">_socket.bind((_host, _port))</div><div class="line">_socket.listen(_bufsize)</div><div class="line">_taskname = <span class="string">'SRPP'</span></div><div class="line">_hash = <span class="string">'sha512'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hash</span><span class="params">(*args)</span>:</span></div><div class="line">    a = <span class="string">':'</span>.join(str(a) <span class="keyword">for</span> a <span class="keyword">in</span> args)</div><div class="line">    <span class="keyword">return</span> int(sha256(a).hexdigest(), <span class="number">16</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getParams</span><span class="params">(nbit)</span>:</span></div><div class="line">    N = getPrime(nbit)</div><div class="line">    g = <span class="number">2</span></div><div class="line">    k = Hash(N, g)</div><div class="line">    <span class="keyword">return</span>(N, g, k)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">clientThread</span><span class="params">(client)</span>:</span></div><div class="line">    client.send(<span class="string">'Bot detection: Are you ready?'</span> + <span class="string">'\n'</span>)</div><div class="line">    A = <span class="string">''</span>.join([choice(printable[:<span class="number">62</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">26</span>)])</div><div class="line">    <span class="keyword">print</span> A[:<span class="number">4</span>]</div><div class="line">    msg = <span class="string">'ASIS needs proof of work to start the '</span> + _taskname + <span class="string">' challenge.\n'</span> + _hash.upper() + <span class="string">'(X + "%s").hexdigest() = "%s...",\nX is an alphanumeric string and |X| = 4\nEnter X: '</span> % (A[<span class="number">4</span>:], sha512(A).hexdigest()[:<span class="number">32</span>])</div><div class="line">    client.send(msg)</div><div class="line">    X = client.recv(_bufsize).strip()</div><div class="line">    <span class="keyword">if</span> sha256(X + A[<span class="number">4</span>:]).hexdigest() == sha256(A).hexdigest():</div><div class="line">        client.settimeout(_timeout)</div><div class="line">        client.send(<span class="string">'Good work, Let\'s Go!'</span> + <span class="string">'\n'</span>)</div><div class="line">        nbit = <span class="number">1024</span></div><div class="line">        params = getParams(nbit)</div><div class="line">        N, g, k = params</div><div class="line">        email = <span class="string">'admin@asis-ctf.ir'</span></div><div class="line">        client.send(<span class="string">'Please login as "admin@asis-ctf.ir" and get the flag:'</span> + <span class="string">'\n'</span>)</div><div class="line">        client.send(<span class="string">'Sever is generating the parameters ...'</span> + <span class="string">'\n'</span>)</div><div class="line">        client.send(<span class="string">'params = (N, g, k) = '</span> + str(params) + <span class="string">'\n'</span>)</div><div class="line">        </div><div class="line">        salt = urandom(<span class="number">32</span>)</div><div class="line">        </div><div class="line">        N, g, _ = params</div><div class="line">        x = Hash(salt, email, password)</div><div class="line">        verifier = pow(g, x, N)</div><div class="line">                </div><div class="line">    	<span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                client.send(<span class="string">'Send the email address and the public random positive value A seperated by "," as "email, A": '</span> + <span class="string">'\n'</span>)</div><div class="line">                ans = client.recv(_bufsize).strip()</div><div class="line">                <span class="keyword">print</span> ans</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    email, A = ans.split(<span class="string">','</span>)</div><div class="line">                    A = int(A)</div><div class="line">                    <span class="keyword">assert</span> (A != <span class="number">0</span> <span class="keyword">and</span> A != N), client.send(<span class="string">'Are you kidding me?! :P'</span> + <span class="string">'\n'</span>)</div><div class="line">                    <span class="keyword">assert</span> email == <span class="string">'admin@asis-ctf.ir'</span>, client.send(<span class="string">'You should login as admin@asis-ctf.ir'</span> + <span class="string">'\n'</span>)</div><div class="line">                    b = getRandomRange(<span class="number">1</span>, N)</div><div class="line">                    B = (k * verifier + pow(g, b, N)) % N</div><div class="line">                </div><div class="line">                    client.send(<span class="string">'(salt,  public_ephemeral) = (%s, %d) \n'</span> % (salt.encode(<span class="string">'base64'</span>)[:<span class="number">-1</span>], B))</div><div class="line">                    <span class="keyword">print</span> gmpy.invert(B)</div><div class="line">                    u = Hash(A, B)</div><div class="line">                                        </div><div class="line">                    client.send(<span class="string">'Send the session key: '</span> + <span class="string">'\n'</span>)</div><div class="line">                    K_client = client.recv(_bufsize).strip()                    </div><div class="line">                    <span class="keyword">assert</span> K_client.isdigit(), client.send(<span class="string">'Please send a valid positive integer as session key.'</span> + <span class="string">'\n'</span>)</div><div class="line">                    K_client = int(K_client)</div><div class="line">                    </div><div class="line">                    S_s = pow(A * pow(verifier, u, N), b, N)</div><div class="line">                    K_server = Hash(S_s)        </div><div class="line">                    </div><div class="line">                    client.send(<span class="string">'Send a POC of session key: '</span> + <span class="string">'\n'</span>)</div><div class="line">                    M_client = client.recv(_bufsize).strip()</div><div class="line">                    </div><div class="line">                    </div><div class="line">                    <span class="keyword">assert</span> M_client.isdigit(), client.send(<span class="string">'Please send valid positive integer as POC.'</span> + <span class="string">'\n'</span>)</div><div class="line">                    M_client = int(M_client)</div><div class="line">                    </div><div class="line">                    <span class="keyword">assert</span> (K_server == K_client), client.send(<span class="string">'The session key is not correct!'</span> + <span class="string">'\n'</span>)    </div><div class="line">                    <span class="keyword">assert</span> (M_client == Hash(Hash(N) ^ Hash(g), Hash(email), salt, A, B, K_client)), client.send(<span class="string">'The POC is not correct!'</span> + <span class="string">'\n'</span>)</div><div class="line">                   </div><div class="line">                    M_server = Hash(A, M_client, K_server) <span class="comment"># <span class="doctag">TODO:</span> check server POC in clinet side</span></div><div class="line"></div><div class="line">                    client.send(<span class="string">'Great, you got the flag: '</span> + flag + <span class="string">'\n'</span>)</div><div class="line">                    client.close()</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                                        </div><div class="line">                <span class="keyword">except</span>:</div><div class="line">                    client.send(<span class="string">'Provided input is not valid.'</span> + <span class="string">'\n'</span>)</div><div class="line">                    client.send(<span class="string">'Quiting ...'</span> + <span class="string">'\n'</span>)</div><div class="line">                    client.close()</div><div class="line">                    <span class="keyword">break</span></div><div class="line"> </div><div class="line">            <span class="keyword">except</span> socket.timeout:</div><div class="line">                client.send(<span class="string">'Timeout! Plase send faster ... \n'</span>)</div><div class="line">                client.close()</div><div class="line">                <span class="keyword">break</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        client.send(<span class="string">'Sorry, Bad proof of work! \n'</span>)</div><div class="line">        client.close()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    client, addr = _socket.accept()</div><div class="line">    start_new_thread(clientThread ,(client,))</div><div class="line">s.close()</div></pre></td></tr></table></figure>
<p>To solve this you needed to realise that A = 2N ≡ 0 (mod N). The web server was checking only for values like A = 0 or A = N. To beat the system you only need to set the A to A = 2N and set the session key to 0 and hash it:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> string <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</div><div class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</div><div class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hash</span><span class="params">(*args)</span>:</span></div><div class="line">    a = <span class="string">':'</span>.join(str(a) <span class="keyword">for</span> a <span class="keyword">in</span> args)</div><div class="line">    <span class="keyword">return</span> int(sha256(a).hexdigest(), <span class="number">16</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_solution</span><span class="params">(s, sol)</span>:</span></div><div class="line">    <span class="keyword">return</span> sol == sha512(s).hexdigest()[:<span class="number">32</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(s)</span>:</span></div><div class="line">    <span class="comment">#m = re.search('\"[a-zA-Z0-9]*\"', s)</span></div><div class="line">    m = re.findall(<span class="string">r'\"[a-zA-Z0-9.]*\"'</span>, s)</div><div class="line">    salt = m[<span class="number">0</span>][<span class="number">1</span>:<span class="number">-1</span>]</div><div class="line">    first16bytes = m[<span class="number">1</span>][<span class="number">1</span>:<span class="number">-4</span>]</div><div class="line">    <span class="keyword">return</span> salt, first16bytes</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">regex_parse</span><span class="params">(regex, s)</span>:</span></div><div class="line">    m = re.findall(regex, s)</div><div class="line">    <span class="keyword">return</span> m</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bot_system</span><span class="params">(junk)</span>:</span></div><div class="line">    salt, sol = parse(junk)</div><div class="line">    chars = digits + ascii_uppercase + ascii_lowercase</div><div class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">4</span>, <span class="number">4</span> + <span class="number">1</span>):</div><div class="line">        <span class="keyword">for</span> comb <span class="keyword">in</span> product(chars, repeat=n):</div><div class="line">            x = <span class="string">''</span>.join(comb)</div><div class="line">            <span class="keyword">if</span> is_solution(x.rstrip() + salt.rstrip(), sol):</div><div class="line">                r.sendline(x)</div><div class="line">                <span class="keyword">return</span> r.recvuntil(<span class="string">"Send the email address and the public random positive value A seperated by \",\" as \"email, A\":"</span>)</div><div class="line">    r.sendline(<span class="string">"2ewq"</span>)</div><div class="line">    <span class="keyword">return</span> r.recvline()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    email = <span class="string">'admin@asis-ctf.ir'</span></div><div class="line">    context(arch=<span class="string">'i386'</span>, os=<span class="string">'linux'</span>)</div><div class="line">    r = remote(<span class="string">'srpp.asis-ctf.ir'</span>, <span class="number">22778</span>)</div><div class="line">    junk = r.recvuntil(<span class="string">'Enter X:'</span>)</div><div class="line">    <span class="keyword">print</span> junk</div><div class="line">    junk = bot_system(junk)</div><div class="line">    <span class="keyword">print</span> junk</div><div class="line">    N, g, k = regex_parse(<span class="string">r"[0-9]+"</span>, junk)</div><div class="line">    A = <span class="number">2</span> * long(N)</div><div class="line">    r.sendline(<span class="string">'%s,%d'</span> % (email, A))</div><div class="line">    junk = r.recvuntil(<span class="string">"Send the session key:"</span>)</div><div class="line">    <span class="keyword">print</span> junk</div><div class="line">    salt, B = regex_parse(</div><div class="line">        <span class="string">r'(?:[A-Za-z0-9+/]&#123;4&#125;)&#123;2,&#125;(?:[A-Za-z0-9+/]&#123;2&#125;[AEIMQUYcgkosw048]=|[A-Za-z0-9+/][AQgw]==|[0-9]+)'</span>, junk)</div><div class="line">    x = Hash(salt.decode(<span class="string">'base64'</span>), email, <span class="string">'x'</span>)</div><div class="line">    u = Hash(A, B)</div><div class="line">    K_client = str(Hash(<span class="number">0</span>))</div><div class="line">    r.sendline(K_client)</div><div class="line">    junk = r.recvuntil(<span class="string">"Send a POC of session key:"</span>)</div><div class="line">    <span class="keyword">print</span> junk</div><div class="line">    M_client = Hash(Hash(long(N)) ^ Hash(long(g)), Hash(email),</div><div class="line">                    salt.decode(<span class="string">'base64'</span>), long(A), long(B), K_client)</div><div class="line">    r.sendline(str(M_client))</div><div class="line">    junk = r.recvall(timeout=<span class="number">3</span>)</div><div class="line">    <span class="keyword">print</span> junk</div><div class="line"></div><div class="line">    <span class="comment"># r.sendline(321)</span></div><div class="line">    <span class="comment"># print r.recvall(timeout=2)</span></div></pre></td></tr></table></figure>
<p>Requirements to run the code above:</p>
<p>capstone==3.0.4<br>cffi==1.8.2<br>cryptography==1.5<br>enum34==1.1.6<br>idna==2.1<br>ipaddress==1.0.17<br>Mako==1.0.4<br>MarkupSafe==0.23<br>paramiko==2.0.2<br>pluggy==0.3.1<br>psutil==4.3.1<br>pwn==1.0<br>pwntools==3.0.2<br>py==1.4.31<br>pyasn1==0.1.9<br>pycparser==2.14<br>pycrypto==2.6.1<br>pyelftools==0.24<br>Pygments==2.1.3<br>pyserial==3.1.1<br>PySocks==1.5.7<br>python-dateutil==2.5.3<br>requests==2.11.1<br>ROPGadget==5.4<br>six==1.10.0<br>tox==2.3.1<br>virtualenv==15.0.3</p>
<p>Running it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(env)kinyabitch@Debian ~/h/c/a/c/SRPP&gt; python srpp.py</div><div class="line">[+] Opening connection to srpp.asis-ctf.ir on port 22778: Done</div><div class="line">Bot detection: Are you ready?</div><div class="line">ASIS needs proof of work to start the SRPP challenge.</div><div class="line">SHA512(X + <span class="string">"Qdir2gMmUNfQTEWws7TiiC"</span>).hexdigest() = <span class="string">"6ab9e49f8f1666eedbfcd245641494b5..."</span>,</div><div class="line">X is an alphanumeric string and |X| = 4</div><div class="line">Enter X:</div><div class="line"> Good work, Let<span class="string">'s Go!</span></div><div class="line"><span class="string">Please login as "admin@asis-ctf.ir" and get the flag:</span></div><div class="line"><span class="string">Sever is generating the parameters ...</span></div><div class="line"><span class="string">params = (N, g, k) = (150264492626393812114930741471401106498656623083068639913262819178319899775751847281352721734537734815860211276875675213404746620022806433472801532459549667439961097968054640742518648454976403201201715934962422442028556067288440471827328146158430586959765296795581920036648128166307787893201848761850772213819L, 2, 24575437478632421856161724587288271515505936432761108412190739330057705715583L)</span></div><div class="line"><span class="string">Send the email address and the public random positive value A seperated by "," as "email, A":</span></div><div class="line"><span class="string"> </span></div><div class="line"><span class="string">(salt,  public_ephemeral) = (xqP2u8/GnuOlvvwzqQyDSCzKdub3VSlC7hqSVgViCn0=, 58941979940718432698750128575222177241044268927849539714742170613086773456642367825722147824342183209059606531876412131592206870210224884096962602048579555044090406168925997732687622279935969221985354817678067387309953487365627666658193178058756987452583249987259227031087509426824835666790488037514334092494) </span></div><div class="line"><span class="string">Send the session key:</span></div><div class="line"><span class="string"> </span></div><div class="line"><span class="string">Send a POC of session key:</span></div><div class="line"><span class="string">[+] Receiving all data: Done (66B)</span></div><div class="line"><span class="string">[*] Closed connection to srpp.asis-ctf.ir port 22778</span></div><div class="line"><span class="string"> </span></div><div class="line"><span class="string">Great, you got the flag: ASIS&#123;7bdb4b540699ef341f4a3b32469cd3f6&#125;</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <blockquote>
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link">
      <strong>Link to this article：</strong>
      <a href="https://teamrocketist.github.io/2016/09/14/Crypto-ASIS-CTF-Finals-2016-SRPP-Secure-Remote-Password-Protocol/" title="[Crypto] ASIS CTF Finals 2016 - SRPP [Secure Remote Password Protocol]" target="_blank" rel="external">https://teamrocketist.github.io/2016/09/14/Crypto-ASIS-CTF-Finals-2016-SRPP-Secure-Remote-Password-Protocol/</a>
    </li>
    
    <!--li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li-->
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/teamrocketist" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/teamrocketist" target="_blank"><span class="text-dark">TeamRocketIST</span><small class="ml-1x">CTF Team</small></a></h3>
        <div>Portuguese Computer Science Students</div>
      </div>
    </figure>
  </div>
</div>


    </footer>
  </article>
  
    
  <div id="comments"></div>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2017/07/31/Web-Bugs-Bunny-Ctf-Web-100/" title="[Web] Bugs Bunny Ctf - Web 100"><i class="fa fa-angle-left" aria-hidden="true"></i>&nbsp;&nbsp;Newer</a>
    </li>
    
    
    <li class="next">
      <a href="/2016/09/14/Forensics-ASIS-CTF-finals-2016-p1ng/" title="[Forensics] ASIS CTF finals 2016 - p1ng">Older&nbsp;&nbsp;<i class="fa fa-angle-right" aria-hidden="true"></i></a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    <div class="share-component" data-sites="facebook,twitter" data-mobile-sites="facebook,twitter"></div>
  </div>
  
</nav>

</section>

  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.js"></script>
<script src="/js/application.js"></script>



  <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>





</body>
</html>